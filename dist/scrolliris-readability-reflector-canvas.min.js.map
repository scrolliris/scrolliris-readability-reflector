{"version":3,"sources":["scrolliris-readability-reflector-canvas.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","_interopRequireDefault","obj","__esModule","default","shadeColor","color","percent","parseInt","slice","p","R","G","B","Math","round","toString","collectElements","article","selectors","q","forEach","d","key","querySelectorAll","fetchResultData","endpointURL","csrfToken","resolveCallback","rejectCallback","credentials","getJSON","url","emptyData","Promise","resolve","reject","xhr","XMLHttpRequest","open","setRequestHeader","responseType","onerror","status","onload","response","replace","JSON","parse","console","error","send","then","data","buildHTML","elements","styles","html","Array","from","map","outerHTML","join","colors0","colors","pIndex","document","importNode","nodeName","isArray","v","String","undefined","style","background","backgroundColor","makeCanvas","width","height","container","getElementById","canvas","createElement","setAttribute","appendChild","drawCanvas","margin","_rasterizehtml2","drawHTML","zoom","dragging","lastY","marginTop","event","addEventListener","evt","cursor","clientY","preventDefault","window","delta","_typeof","Symbol","iterator","constructor","prototype","_rasterizehtml","doc","ctx","config","settings","options","hasOwnProperty","querySelector","elm","documentElement","docWidth","max","body","clientWidth","scrollWidth","docHeight","clientHeight","scrollHeight","draw","canvasHeight","headerHeight","footerHeiht","frameMargin","scale","parent","ScrollirisReadabilityReflector","Context","rasterizehtml","2","root","factory","define","amd","ayepromise","this","once","wasCalled","wrappedFunction","apply","arguments","getThenableIfExists","aThenHandler","onFulfilled","onRejected","defer","doHandlerCall","func","value","setTimeout","returnValue","promise","TypeError","callFulfilled","callRejected","handle","state","FULFILLED","PENDING","REJECTED","outcome","thenHandlers","doSettle","settledState","doFulfill","doReject","registerThenHandler","thenHandler","push","safelyResolveThenable","thenable","onceWrapper","transparentlyResolveThenablesAndSettle","fail","3","Url","protocol","slashes","auth","host","port","hostname","hash","search","query","pathname","path","href","urlParse","parseQueryString","slashesDenoteHost","util","isObject","urlFormat","isString","format","urlResolve","source","relative","urlResolveObject","resolveObject","punycode","protocolPattern","portPattern","simplePathPattern","delims","unwise","concat","autoEscape","nonHostChars","hostEndingChars","hostnameMaxLen","hostnamePartPattern","hostnamePartStart","unsafeProtocol","javascript","javascript:","hostlessProtocol","slashedProtocol","http","https","ftp","gopher","file","http:","https:","ftp:","gopher:","file:","querystring","queryIndex","indexOf","splitter","uSplit","split","slashRegex","rest","trim","simplePath","exec","substr","proto","lowerProto","toLowerCase","match","hostEnd","hec","atSign","lastIndexOf","decodeURIComponent","parseHost","ipv6Hostname","hostparts","part","newpart","j","k","charCodeAt","validParts","notHost","bit","unshift","toASCII","h","ae","esc","encodeURIComponent","escape","qm","Object","keys","stringify","charAt","rel","result","tkeys","tk","tkey","rkeys","rk","rkey","relPath","shift","isSourceAbs","isRelAbs","mustEndAbs","removeAllDots","srcPath","psychotic","pop","isNullOrUndefined","authInHost","isNull","last","hasTrailingSlash","up","splice","isAbsolute","./util","4","arg","5","peg$subclass","child","ctor","SyntaxError","message","expected","found","offset","line","column","name","input","peg$computePosDetails","pos","advance","details","startPos","endPos","ch","seenCR","peg$cachedPos","peg$cachedPosDetails","peg$fail","peg$currPos","peg$maxFailPos","peg$maxFailExpected","peg$buildException","cleanupExpected","sort","b","description","buildMessage","stringEscape","hex","toUpperCase","expectedDesc","foundDesc","expectedDescs","posDetails","peg$parsestart","s0","s1","peg$parsesourceEntries","peg$FAILED","peg$reportedPos","peg$c1","s2","s3","s4","s5","peg$parsesourceEntry","peg$parsewhitespace","peg$c3","peg$silentFails","peg$c4","peg$c5","peg$c2","peg$c6","peg$parseurlEntry","peg$parselocalEntry","peg$parseurl","peg$parseformat","peg$c7","peg$c8","peg$c9","peg$c10","peg$parsevalue","peg$c11","peg$c12","peg$c13","peg$c14","peg$c15","peg$c16","peg$c17","peg$c18","peg$c19","test","peg$c20","peg$c21","peg$c22","peg$c23","peg$result","peg$startRuleFunctions","start","peg$startRuleFunction","type","x","xs","entry","local","chars","extractValue","startRule","../util","6","grammar","fontFaceSourceValue","serialize","parsedFontFaceSources","sourceItem","itemValue","./grammar","7","trimCSSWhitespace","whitespaceRegex","unquoteString","quotedUrl","doubleQuoteRegex","singleQuoteRegex","8","matchQuery","mediaQuery","values","parseQuery","some","inverse","typeMatch","expressionsMatch","expressions","every","expression","feature","modifier","expValue","toPx","toDpi","toDecimal","captures","RE_MEDIA_QUERY","parsed","RE_MQ_EXPRESSION","RE_MQ_FEATURE","ratio","numbers","decimal","Number","resolution","parseFloat","units","RE_RESOLUTION_UNIT","RE_LENGTH_UNIT","9","CSSOM","CSSRule","MatcherList","CSSDocumentRule","matcher","cssRules","defineProperty","get","cssTexts","cssText","matcherText","./CSSRule","./MatcherList","10","CSSStyleDeclaration","CSSFontFaceRule","parentRule","./CSSStyleDeclaration","11","CSSHostRule","12","CSSStyleSheet","MediaList","CSSImportRule","media","styleSheet","mediaText","set","index","character","buffer","./CSSStyleSheet","./MediaList","13","CSSKeyframeRule","keyText","14","CSSKeyframesRule","_vendorPrefix","15","CSSMediaRule","16","parentStyleSheet","UNKNOWN_RULE","STYLE_RULE","CHARSET_RULE","IMPORT_RULE","MEDIA_RULE","FONT_FACE_RULE","PAGE_RULE","KEYFRAMES_RULE","KEYFRAME_RULE","MARGIN_RULE","NAMESPACE_RULE","COUNTER_STYLE_RULE","SUPPORTS_RULE","DOCUMENT_RULE","FONT_FEATURE_VALUES_RULE","VIEWPORT_RULE","REGION_STYLE_RULE","17","_importants","getPropertyValue","setProperty","priority","removeProperty","prevValue","getPropertyCSSValue","getPropertyPriority","getPropertyShorthand","isPropertyImplicit","properties","text","dummyRule","./parse","18","CSSStyleRule","selectorText","rule","ruleText","SIGNIFICANT_WHITESPACE","selector","styleRule","19","StyleSheet","insertRule","RangeError","cssRule","deleteRule","rules","./CSSStyleRule","./StyleSheet","20","CSSValue","_getConstructorName","c","21","CSSValueExpression","token","idx","_token","_idx","info","paren","_parseJSComment","_parseJSRexExp","_parseJSString","ret","nextChar","endIdx","commentEndChar","startIdx","substring","sep","_findMatchedIdx","before","legalRegx","isLegal","reg","NOT_FOUND","matched","nextNewLineIdx","./CSSValue","22","appendMatcher","deleteMatcher","23","appendMedium","medium","deleteMedium","24","25","clone","stylesheet","cloned","RULE_TYPES","rulesLength","ruleClone","styleClone","styleLength","./CSSKeyframeRule","./CSSKeyframesRule","./CSSMediaRule","26","./CSSImportRule","./clone","27","mediaRule","importRule","fontFaceRule","keyframesRule","documentRule","hostRule","valueParenthesisDepth","value-parenthesis","atRule","importRule-begin","atBlock","documentRule-begin","currentScope","atKeyframesRegExp","parseError","lines","lineCount","charCount","__starts","lastIndex","matchKeyframes","__ends","./CSSDocumentRule","./CSSFontFaceRule","./CSSHostRule","./CSSValueExpression","28","cssSupport","extractCssUrl","cssUrl","urlRegex","sliceBackgroundDeclaration","backgroundDeclarationText","outerRepeatedMatch","functionParamRegexS","valueRegexS","simpleSingularBackgroundRegexS","simpleBackgroundRegexS","simpleSingularBackgroundRegex","RegExp","backgroundLayers","getValues","singularBackgroundDeclaration","repeatedMatch","valueRegex","backgroundValues","findBackgroundImageUrlInValues","backgroundValue","backgroundLayerValues","urlMatch","preUrl","postUrl","parsedBackground","backgroundLayer","./cssSupport","29","cssom","rulesForCssTextFromBrowser","styleContent","implementation","createHTMLDocument","styleElement","textContent","sheet","browserHasBackgroundImageUrlIssue","browserHasFontFaceUrlIssue","browserHasBackgroundImageUrlSetIssue","rulesForCssText","cssRulesToText","reduce","exchangeRule","newRuleText","ruleIdx","changeFontFaceRuleSrc","newSrc","30","inlineImage","inlineScript","inlineCss","getUrlBasePath","joinUrl","parameterHashFunction","params","param","baseUrl","memoizeFunctionOnCaching","cache","cacheBucket","memoize","requestExternalsForStylesheet","alreadyLoadedCssUrls","loadCSSImportsForRules","cssImportResult","loadAndInlineCSSResourcesForRules","cssResourcesResult","errors","hasChanges","content","loadAndInlineCssForStyle","processExternals","childNodes","nodeValue","cloneArray","getCssStyleElements","getElementsByTagName","filter","attributes","loadAndInlineStyles","inlineOptions","allErrors","getDocumentBaseUrl","all","substituteLinkWithInlineStyle","oldLinkNode","styleNode","parentNode","ownerDocument","createTextNode","insertBefore","removeChild","requestStylesheetAndInlineResources","ajax","hasChangesFromPathAdjustment","adjustPathsOfCssResources","loadLinkedCSS","link","cssHref","documentBaseUrl","ajaxOptions","processStylesheet","getCssStylesheetLinks","links","loadAndInlineCssLinks","resourceType","msg","loadAndInlineImages","inline","loadAndInlineScript","inlineReferences","inlineFuncs","inlineScripts","./inlineCss","./inlineImage","./inlineScript","31","backgroundValueParser","fontFaceSrcValueParser","updateCssPropertyValue","property","findBackgroundImageRules","findBackgroundDeclarations","backgroundDeclarations","findFontFaceRules","findCSSImportRules","findExternalBackgroundUrls","matchIndices","isDataUri","findExternalFontFaceUrls","sourceIndices","backgroundRules","change","declaration","externalBackgroundIndices","backgroundLayerIndex","relativeUrl","externalFontFaceUrlIndices","fontFaceSrcDeclaration","fontFaceUrlIndex","substituteRule","newCssRules","position","newRule","fulfilledPromise","loadAndInlineCSSImport","cssHrefRelativeToDoc","externalCssRules","rulesToInline","moreErrors","loadAndInlineBackgroundImages","externalBackgroundLayerIndices","collectAndReportErrors","getDataURIForImageURL","dataURI","iterateOverRulesAndInlineBackgroundImages","cssHasChanges","loadAndInlineFontFace","srcDeclarationValue","urlIndex","fontSrc","binaryAjax","base64Content","btoa","iterateOverRulesAndInlineFontFace","./backgroundValueParser","css-font-face-src","32","encodeImageAsDataURI","image","hasAttribute","getAttribute","hasAttributeNS","getAttributeNS","documentBase","filterExternalImages","images","filterInputsForImageType","inputs","toArray","arrayLike","svgImages","imageInputs","externalImages","src","33","loadLinkedScript","script","escapeClosingTags","substituteExternalScriptWithInline","scriptNode","jsCode","removeNamedItem","getScripts","scripts","34","baseURI","object","theClone","nodeList","relUrl","promises","pendingPromiseCount","resolvedValues","lastCacheDate","getUncachableURL","Date","now","augmentedUrl","ajaxRequest","joinedUrl","overrideMimeType","mimeType","binaryContent","fromCharCode","detectMimeType","startsWith","string","uniqueIdList","constantUniqueIdFor","element","hasher","memo","retValue","args","argumentHash","funcHash","35","global","array","fn","mapDomain","parts","regexSeparators","labels","encoded","ucs2decode","extra","output","counter","ucs2encode","stringFromCharCode","basicToDigit","codePoint","base","digitToBasic","digit","flag","adapt","numPoints","firstTime","floor","damp","baseMinusTMin","tMax","skew","decode","out","basic","oldi","w","baseMinusT","inputLength","initialN","bias","initialBias","delimiter","maxInt","tMin","encode","handledCPCount","basicLength","m","currentValue","handledCPCountPlusOne","qMinusT","toUnicode","regexPunycode","regexNonASCII","freeExports","nodeType","freeModule","freeGlobal","self","overflow","not-basic","invalid-input","version","ucs2","36","prop","qs","eq","regexp","maxKeys","len","kstr","vstr","37","res","stringifyPrimitive","isFinite","objectKeys","ks","38","./decode","./encode","39","a0","b1","c2","d3","e4","f5","cssMediaQuery","xmlserializer","sanedomparsererror","inlineresources","getConstantUniqueIdFor","isCanvas","parseOptionalParameters","parameters","proxies","monkeyPatchInstanceMethod","methodName","proxyFunc","originalFunc","baseUrlRespectingXhr","XHRObject","xhrConstructor","originalOpen","method","finishNotifyingXhr","totalXhrCount","doneXhrCount","waitingForPendingToClose","checkAllRequestsFinished","pendingXhrCount","totalCount","_","originalSend","waitForRequestsToFinish","documentUtil","asArray","addClassName","className","addClassNameRecursively","changeCssRule","updateRuleSelector","updatedSelector","styleDefinitions","rewriteStyleContent","addSheetPropertyToSvgStyleElement","svgStyleElement","cssStyleElement","matchingSimpleSelectorsRegex","simpleSelectorList","replaceSimpleSelectorsBy","caseInsensitiveReplaceFunc","selectorRegex","matchingRules","newSelector","prefixMatch","selectorMatch","rewriteCssSelectorWith","oldSelector","lowercaseCssTypeSelectors","matchingTagNames","findHtmlOnlyNodeNames","currentTagName","treeWalker","createTreeWalker","NodeFilter","SHOW_ELEMENT","htmlNodeNames","nonHtmlNodeNames","currentNode","tagName","namespaceURI","nextNode","documentHelper","cascadingAction","active","hover","focus","target","fakeUserAction","action","elem","pseudoClass","fakeActionClass","persistInputValues","textareas","isCheckable","checked","removeAttribute","textarea","rewriteTagNameSelectorsToLowerCase","mediaQueryHelper","hasEmIssue","svgImgBlueByEmMediaQuery","svg","img","firstPixelHasColor","g","context","getContext","drawImage","getImageData","hasEmMediaQueryIssue","needsEmWorkaround","mediaQueryRule","exchangeRuleWithNewContent","serializeExpression","exp","serializeQueryPart","segments","serializeQuery","queryParts","transformEmIntoPx","em","replaceEmValueWithPx","substituteEmWithPx","parsedQuery","rewrittenValue","replaceEmsWithPx","mediaQueryRules","anyRuleHasChanges","rewrittenMediaQuery","workAroundWebKitEmSizeIssue","browser","theWindow","createHiddenElement","visibility","top","left","executeJavascript","iframe","iframeErrorsMessages","timeout","executeJsTimeout","doResolve","contentDocument","waitForJavaScriptToRun","contentWindow","finishNotifyXhrProxy","baseUrlXhrProxy","write","close","createHiddenSandboxedIFrame","sandbox","scrolling","createIframeWithSizeAtZoomLevel1","scaledViewportWidth","scaledViewportHeight","calculateZoomedContentSizeAndRoundUp","actualViewport","requestedWidth","requestedHeight","selectElementOrDescendant","descendant","calculateContentSize","rootElement","originalWidth","originalHeight","rootFontSize","rect","contentSize","actualViewportWidth","actualViewportHeight","getBoundingClientRect","getComputedStyle","fontSize","viewportWidth","viewportHeight","findCorrelatingElement","documentClone","elementToFullHtmlDocument","calculateDocumentContentSize","size","clip","parseHtmlFragment","htmlFragment","innerHTML","firstChild","addHTMLTagAttributes","htmlTagSubstitute","elementSubstitute","attribute","attributeMatch","helperDoc","parseHTML","failOnInvalidSource","failOnParseError","originalError","validateXHTML","xhtml","DOMParser","parseFromString","doDocumentLoad","responseXML","statusText","loadDocument","svg2image","checkForBlobsResult","urlForSvg","useBlobs","URL","createObjectURL","Blob","cleanUpUrl","revokeObjectURL","simpleForeignObjectSvg","supportsReadingObjectFromCanvas","Image","toDataURL","readingBackFromCanvasBenefitsFromOldSchoolDataUris","blobUrl","supportsReadingFromBlobs","supportsBlobBuilding","err","checkBlobSupport","doesBenefit","checkForBlobs","buildImageUrl","renderSvg","resetEventHandlers","cleanUp","imageUrl","document2svg","svgAttributes","zoomFactor","font-size","foreignObjectAttributes","closestScaledWith","closestScaledHeight","offsetX","offsetY","y","workAroundCollapsingMarginsAcrossSVGElementInWebKitLike","workAroundSafariSometimesNotShowingExternalResources","externalResourcesRequired","workAroundChromeShowingScrollbarsUnderLinuxIfHtmlIsOverflowScroll","serializeAttributes","convertElementToSvg","serializeToString","foreignObjectAttrs","getSvgForDocument","needsWorkaround","drawDocumentAsSvg","rasterize","generalDrawError","drawSvgAsImg","drawImageOnCanvas","doDraw","operateJavaScriptOnDocument","executeJs","drawResult","rasterizeHTML","getViewportSize","defaultWidth","defaultHeight","fallbackWidth","fallbackHeight","constructOptions","viewport","drawDocument","optionalArguments","workAroundFirefoxNotLoadingStylesheetStyles","replaceChild","extendedOptions","drawURL","workaround","css-mediaquery","sane-domparser-error","40","innerXML","node","XMLSerializer","getParseError","errorMessagePatterns","extractParseError","errorNode","errorMessage","41","removeInvalidCharacters","serializeAttributeValue","serializeTextContent","serializeAttribute","attr","getTagName","serializeNamespace","isRootNode","nodeHasXmlnsAttr","attrs","serializeChildren","childNode","nodeTreeToXHTML","serializeTag","serializeText","serializeComment","serializeCDATA","rootNode"],"mappings":"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","file":"scrolliris-readability-reflector-canvas.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar _rasterizehtml = require('rasterizehtml');\n\nvar _rasterizehtml2 = _interopRequireDefault(_rasterizehtml);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction shadeColor(color, percent) {\n  var f = parseInt(color.slice(1), 16),\n      t = percent < 0 ? 0 : 255,\n      p = percent < 0 ? percent * -1 : percent;\n  var R = f >> 16,\n      G = f >> 8 & 0x00FF,\n      B = f & 0x0000FF;\n  return '#' + (0x1000000 + (Math.round((t - R) * p) + R) * 0x10000 + (Math.round((t - G) * p) + G) * 0x100 + (Math.round((t - B) * p) + B)).toString(16).slice(1);\n}\n\nfunction collectElements(article, selectors) {\n  var q = '';\n  [// default\n  ['heading', 'h1,h2,h3,h4,h5,h6'], ['paragraph', 'p']\n  //, ['sentence', '']  FIXME: sentence must be nested in p\n  , ['material', 'ul,ol,pre,table,blockquote']].forEach(function (d) {\n    var key = d[0];\n    q += ',' + (selectors[key] || d[1]);\n  });\n  return article.querySelectorAll(q.slice(1));\n}\n\nfunction fetchResultData(endpointURL, csrfToken, resolveCallback, rejectCallback) {\n  var credentials = { csrfToken: csrfToken };\n  if (!credentials.csrfToken) {\n    credentials.csrfToken = '';\n  }\n  var getJSON = function getJSON(url) {\n    var emptyData = { 'p': [] };\n    return new Promise(function (resolve, reject) {\n      var xhr = new XMLHttpRequest();\n      xhr.open('GET', url, true);\n      xhr.setRequestHeader('Accept', 'application/json');\n      xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n      if (credentials.csrfToken !== '') {\n        xhr.setRequestHeader('X-CSRF-Token', credentials.csrfToken);\n      }\n      xhr.responseType = 'text';\n      xhr.onerror = function () {\n        var status = xhr.status;\n        reject(emptyData);\n      };\n      xhr.onload = function () {\n        var status = xhr.status,\n            response = xhr.response;\n        if (status === 200) {\n          response = response.replace(/^\\]\\)\\}while\\(1\\);<\\/x>/, '');\n          resolve(JSON.parse(response));\n        } else {\n          console.error('[ERROR] GET status: ', status);\n          reject(emptyData);\n        }\n      };\n      xhr.send();\n    });\n  };\n  return getJSON(endpointURL).then(function (data) {\n    return resolveCallback(data);\n  }, function (data) {\n    return rejectCallback(data);\n  });\n}\n\nfunction buildHTML(data, elements, styles) {\n  var html = '<html><head>';\n  html += Array.from(styles).map(function (s) {\n    // apply original style(s)\n    return s.outerHTML;\n  }).join('');\n  html += '</head><body>';\n\n  var colors0 = [// heatmap 11\n  '#2d96db', '#4aa8a6', '#64b977', '#99c95d', '#c5d062', '#f6d866', '#fab252', '#fd8e3e', '#fe6f43', '#fd515b', '#fb1b2a'];\n\n  var colors1 = [// pastel 12\n  '#9e0142', '#d0384d', '#ee6445', '#fa9c58', '#fdcd7b', '#fef0a7', '#f3faad', '#d0ec9c', '#98d5a4', '#5cb7a9', '#3582ba', '#5e4fa2'];\n\n  var colors2 = [// monochromic 9\n  '#fafafa', '#f0f0f0', '#d9d9d9', '#bdbdbd', '#969696', '#737373', '#525252', '#252525', '#000000'];\n\n  var colors = colors0 // heatmap (for now)\n  ,\n      pIndex = 0;\n  html += Array.from(elements).map(function (e) {\n    var n = document.importNode(e, true);\n    if (n.nodeName !== 'IMG') {\n      if (n.nodeName === 'P' && Array.isArray(data['p'])) {\n        // BETA only paragraph support\n        var v = data['p'][String(pIndex)];\n        if (v !== undefined) {\n          var color = shadeColor(colors[parseInt(v, 10).toString()], 0.5);\n          n.style.background = color;\n          n.style.backgroundColor = 'rgba(' + color + ', 0.9)';\n        }\n        pIndex += 1;\n      }\n    }\n    return n.outerHTML;\n  }).join('');\n  html += '</body></html>';\n  return html;\n}\n\nfunction makeCanvas(width, height) {\n  var container = document.getElementById('scrolliris_canvas_container'),\n      canvas = document.createElement('canvas');\n  canvas.setAttribute('id', 'scrolliris_canvas');\n  canvas.setAttribute('width', width * 0.5);\n  canvas.setAttribute('height', height * 0.5);\n  container.appendChild(canvas);\n  return canvas;\n}\n\nfunction drawCanvas(canvas, html, width, height, margin) {\n  _rasterizehtml2.default.drawHTML(html, canvas, {\n    zoom: 0.5,\n    width: width,\n    height: height\n  });\n\n  var dragging = false,\n      lastY = void 0,\n      marginTop = 0,\n      event = {};\n\n  canvas.addEventListener('mousedown', function (e) {\n    var evt = e || event;\n    canvas.style.cursor = 'grabbing';\n    dragging = true;\n    lastY = evt.clientY;\n    e.preventDefault();\n  }, false);\n\n  canvas.addEventListener('mouseup', function (e) {\n    canvas.style.cursor = 'grab';\n    dragging = false;\n  }, false);\n\n  window.addEventListener('mousemove', function (e) {\n    var evt = e || event;\n    if (dragging) {\n      var delta = evt.clientY - lastY;\n      lastY = evt.clientY;\n      marginTop += delta;\n      if (marginTop > 0) {\n        marginTop = 0;\n      } else if (marginTop < margin) {\n        marginTop = margin;\n      }\n      canvas.style.marginTop = marginTop + 'px';\n    }\n    e.preventDefault();\n  }, false);\n\n  window.addEventListener('mouseout', function (e) {\n    canvas.style.cursor = 'grab';\n    dragging = false;\n  }, false);\n}\n\n(function (doc, ctx) {\n  var config = {},\n      settings = {},\n      options = {};\n\n  if (ctx.hasOwnProperty('config') && _typeof(ctx.config) === 'object') {\n    config = ctx['config'];\n    // pass\n  }\n  if (ctx.hasOwnProperty('settings') && _typeof(ctx.options) === 'object') {\n    settings = ctx['settings'];\n    if (!settings.endpointURL) {\n      console.error('endpointURL is required');\n      return false;\n    }\n  }\n  if (ctx.hasOwnProperty('options') && _typeof(ctx.options) === 'object') {\n    options = ctx['options'];\n  }\n\n  var selectors = options.selectors || {};\n  var article = doc.querySelector(selectors.article || 'body article');\n\n  // collect elements and styles\n  var elements = collectElements(article, selectors),\n      styles = doc.querySelectorAll('style') || [];\n\n  // NOTE:\n  // Use <article>'s clientHeight?\n  var elm = doc.documentElement;\n  var docWidth = Math.max(doc.body.clientWidth, elm.clientWidth, elm.scrollWidth);\n  var docHeight = Math.max(doc.body.clientHeight, elm.clientHeight, elm.scrollHeight);\n\n  var draw = function draw(data) {\n    var html = buildHTML(data, elements, styles),\n        canvas = makeCanvas(docWidth, docHeight);\n    // draw minimap\n    var canvasHeight = 290 // container main area\n    ,\n        headerHeight = 22,\n        footerHeiht = 22,\n        frameMargin = 9 // {left|bottom} 9px\n    ,\n        scale = 0.5;\n    var margin = -1 * (docHeight * scale / canvasHeight * 100) + (headerHeight + footerHeiht + frameMargin);\n    drawCanvas(canvas, html, docWidth, docHeight, margin);\n  };\n\n  fetchResultData(settings.endpointURL, settings.csrfToken, function (data) {\n    // resolve\n    draw(data);\n  }, function (data) {\n    // reject\n    // FIXME\n    draw(data);\n  });\n})(window.parent.document, (window.ScrollirisReadabilityReflector || {}).Context);\n\n},{\"rasterizehtml\":39}],2:[function(require,module,exports){\n// UMD header\n(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n        define(factory);\n    } else if (typeof exports === 'object') {\n        module.exports = factory();\n    } else {\n        root.ayepromise = factory();\n    }\n}(this, function () {\n    'use strict';\n\n    var ayepromise = {};\n\n    /* Wrap an arbitrary number of functions and allow only one of them to be\n       executed and only once */\n    var once = function () {\n        var wasCalled = false;\n\n        return function wrapper(wrappedFunction) {\n            return function () {\n                if (wasCalled) {\n                    return;\n                }\n                wasCalled = true;\n                wrappedFunction.apply(null, arguments);\n            };\n        };\n    };\n\n    var getThenableIfExists = function (obj) {\n        // Make sure we only access the accessor once as required by the spec\n        var then = obj && obj.then;\n\n        if (typeof obj === \"object\" && typeof then === \"function\") {\n            // Bind function back to it's object (so fan's of 'this' don't get sad)\n            return function() { return then.apply(obj, arguments); };\n        }\n    };\n\n    var aThenHandler = function (onFulfilled, onRejected) {\n        var defer = ayepromise.defer();\n\n        var doHandlerCall = function (func, value) {\n            setTimeout(function () {\n                var returnValue;\n                try {\n                    returnValue = func(value);\n                } catch (e) {\n                    defer.reject(e);\n                    return;\n                }\n\n                if (returnValue === defer.promise) {\n                    defer.reject(new TypeError('Cannot resolve promise with itself'));\n                } else {\n                    defer.resolve(returnValue);\n                }\n            }, 1);\n        };\n\n        var callFulfilled = function (value) {\n            if (onFulfilled && onFulfilled.call) {\n                doHandlerCall(onFulfilled, value);\n            } else {\n                defer.resolve(value);\n            }\n        };\n\n        var callRejected = function (value) {\n            if (onRejected && onRejected.call) {\n                doHandlerCall(onRejected, value);\n            } else {\n                defer.reject(value);\n            }\n        };\n\n        return {\n            promise: defer.promise,\n            handle: function (state, value) {\n                if (state === FULFILLED) {\n                    callFulfilled(value);\n                } else {\n                    callRejected(value);\n                }\n            }\n        };\n    };\n\n    // States\n    var PENDING = 0,\n        FULFILLED = 1,\n        REJECTED = 2;\n\n    ayepromise.defer = function () {\n        var state = PENDING,\n            outcome,\n            thenHandlers = [];\n\n        var doSettle = function (settledState, value) {\n            state = settledState;\n            // persist for handlers registered after settling\n            outcome = value;\n\n            thenHandlers.forEach(function (then) {\n                then.handle(state, outcome);\n            });\n\n            // Discard all references to handlers to be garbage collected\n            thenHandlers = null;\n        };\n\n        var doFulfill = function (value) {\n            doSettle(FULFILLED, value);\n        };\n\n        var doReject = function (error) {\n            doSettle(REJECTED, error);\n        };\n\n        var registerThenHandler = function (onFulfilled, onRejected) {\n            var thenHandler = aThenHandler(onFulfilled, onRejected);\n\n            if (state === PENDING) {\n                thenHandlers.push(thenHandler);\n            } else {\n                thenHandler.handle(state, outcome);\n            }\n\n            return thenHandler.promise;\n        };\n\n        var safelyResolveThenable = function (thenable) {\n            // Either fulfill, reject or reject with error\n            var onceWrapper = once();\n            try {\n                thenable(\n                    onceWrapper(transparentlyResolveThenablesAndSettle),\n                    onceWrapper(doReject)\n                );\n            } catch (e) {\n                onceWrapper(doReject)(e);\n            }\n        };\n\n        var transparentlyResolveThenablesAndSettle = function (value) {\n            var thenable;\n\n            try {\n                thenable = getThenableIfExists(value);\n            } catch (e) {\n                doReject(e);\n                return;\n            }\n\n            if (thenable) {\n                safelyResolveThenable(thenable);\n            } else {\n                doFulfill(value);\n            }\n        };\n\n        var onceWrapper = once();\n        return {\n            resolve: onceWrapper(transparentlyResolveThenablesAndSettle),\n            reject: onceWrapper(doReject),\n            promise: {\n                then: registerThenHandler,\n                fail: function (onRejected) {\n                    return registerThenHandler(null, onRejected);\n                }\n            }\n        };\n    };\n\n    return ayepromise;\n}));\n\n},{}],3:[function(require,module,exports){\n// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar punycode = require('punycode');\nvar util = require('./util');\n\nexports.parse = urlParse;\nexports.resolve = urlResolve;\nexports.resolveObject = urlResolveObject;\nexports.format = urlFormat;\n\nexports.Url = Url;\n\nfunction Url() {\n  this.protocol = null;\n  this.slashes = null;\n  this.auth = null;\n  this.host = null;\n  this.port = null;\n  this.hostname = null;\n  this.hash = null;\n  this.search = null;\n  this.query = null;\n  this.pathname = null;\n  this.path = null;\n  this.href = null;\n}\n\n// Reference: RFC 3986, RFC 1808, RFC 2396\n\n// define these here so at least they only have to be\n// compiled once on the first module load.\nvar protocolPattern = /^([a-z0-9.+-]+:)/i,\n    portPattern = /:[0-9]*$/,\n\n    // Special case for a simple path URL\n    simplePathPattern = /^(\\/\\/?(?!\\/)[^\\?\\s]*)(\\?[^\\s]*)?$/,\n\n    // RFC 2396: characters reserved for delimiting URLs.\n    // We actually just auto-escape these.\n    delims = ['<', '>', '\"', '`', ' ', '\\r', '\\n', '\\t'],\n\n    // RFC 2396: characters not allowed for various reasons.\n    unwise = ['{', '}', '|', '\\\\', '^', '`'].concat(delims),\n\n    // Allowed by RFCs, but cause of XSS attacks.  Always escape these.\n    autoEscape = ['\\''].concat(unwise),\n    // Characters that are never ever allowed in a hostname.\n    // Note that any invalid chars are also handled, but these\n    // are the ones that are *expected* to be seen, so we fast-path\n    // them.\n    nonHostChars = ['%', '/', '?', ';', '#'].concat(autoEscape),\n    hostEndingChars = ['/', '?', '#'],\n    hostnameMaxLen = 255,\n    hostnamePartPattern = /^[+a-z0-9A-Z_-]{0,63}$/,\n    hostnamePartStart = /^([+a-z0-9A-Z_-]{0,63})(.*)$/,\n    // protocols that can allow \"unsafe\" and \"unwise\" chars.\n    unsafeProtocol = {\n      'javascript': true,\n      'javascript:': true\n    },\n    // protocols that never have a hostname.\n    hostlessProtocol = {\n      'javascript': true,\n      'javascript:': true\n    },\n    // protocols that always contain a // bit.\n    slashedProtocol = {\n      'http': true,\n      'https': true,\n      'ftp': true,\n      'gopher': true,\n      'file': true,\n      'http:': true,\n      'https:': true,\n      'ftp:': true,\n      'gopher:': true,\n      'file:': true\n    },\n    querystring = require('querystring');\n\nfunction urlParse(url, parseQueryString, slashesDenoteHost) {\n  if (url && util.isObject(url) && url instanceof Url) return url;\n\n  var u = new Url;\n  u.parse(url, parseQueryString, slashesDenoteHost);\n  return u;\n}\n\nUrl.prototype.parse = function(url, parseQueryString, slashesDenoteHost) {\n  if (!util.isString(url)) {\n    throw new TypeError(\"Parameter 'url' must be a string, not \" + typeof url);\n  }\n\n  // Copy chrome, IE, opera backslash-handling behavior.\n  // Back slashes before the query string get converted to forward slashes\n  // See: https://code.google.com/p/chromium/issues/detail?id=25916\n  var queryIndex = url.indexOf('?'),\n      splitter =\n          (queryIndex !== -1 && queryIndex < url.indexOf('#')) ? '?' : '#',\n      uSplit = url.split(splitter),\n      slashRegex = /\\\\/g;\n  uSplit[0] = uSplit[0].replace(slashRegex, '/');\n  url = uSplit.join(splitter);\n\n  var rest = url;\n\n  // trim before proceeding.\n  // This is to support parse stuff like \"  http://foo.com  \\n\"\n  rest = rest.trim();\n\n  if (!slashesDenoteHost && url.split('#').length === 1) {\n    // Try fast path regexp\n    var simplePath = simplePathPattern.exec(rest);\n    if (simplePath) {\n      this.path = rest;\n      this.href = rest;\n      this.pathname = simplePath[1];\n      if (simplePath[2]) {\n        this.search = simplePath[2];\n        if (parseQueryString) {\n          this.query = querystring.parse(this.search.substr(1));\n        } else {\n          this.query = this.search.substr(1);\n        }\n      } else if (parseQueryString) {\n        this.search = '';\n        this.query = {};\n      }\n      return this;\n    }\n  }\n\n  var proto = protocolPattern.exec(rest);\n  if (proto) {\n    proto = proto[0];\n    var lowerProto = proto.toLowerCase();\n    this.protocol = lowerProto;\n    rest = rest.substr(proto.length);\n  }\n\n  // figure out if it's got a host\n  // user@server is *always* interpreted as a hostname, and url\n  // resolution will treat //foo/bar as host=foo,path=bar because that's\n  // how the browser resolves relative URLs.\n  if (slashesDenoteHost || proto || rest.match(/^\\/\\/[^@\\/]+@[^@\\/]+/)) {\n    var slashes = rest.substr(0, 2) === '//';\n    if (slashes && !(proto && hostlessProtocol[proto])) {\n      rest = rest.substr(2);\n      this.slashes = true;\n    }\n  }\n\n  if (!hostlessProtocol[proto] &&\n      (slashes || (proto && !slashedProtocol[proto]))) {\n\n    // there's a hostname.\n    // the first instance of /, ?, ;, or # ends the host.\n    //\n    // If there is an @ in the hostname, then non-host chars *are* allowed\n    // to the left of the last @ sign, unless some host-ending character\n    // comes *before* the @-sign.\n    // URLs are obnoxious.\n    //\n    // ex:\n    // http://a@b@c/ => user:a@b host:c\n    // http://a@b?@c => user:a host:c path:/?@c\n\n    // v0.12 TODO(isaacs): This is not quite how Chrome does things.\n    // Review our test case against browsers more comprehensively.\n\n    // find the first instance of any hostEndingChars\n    var hostEnd = -1;\n    for (var i = 0; i < hostEndingChars.length; i++) {\n      var hec = rest.indexOf(hostEndingChars[i]);\n      if (hec !== -1 && (hostEnd === -1 || hec < hostEnd))\n        hostEnd = hec;\n    }\n\n    // at this point, either we have an explicit point where the\n    // auth portion cannot go past, or the last @ char is the decider.\n    var auth, atSign;\n    if (hostEnd === -1) {\n      // atSign can be anywhere.\n      atSign = rest.lastIndexOf('@');\n    } else {\n      // atSign must be in auth portion.\n      // http://a@b/c@d => host:b auth:a path:/c@d\n      atSign = rest.lastIndexOf('@', hostEnd);\n    }\n\n    // Now we have a portion which is definitely the auth.\n    // Pull that off.\n    if (atSign !== -1) {\n      auth = rest.slice(0, atSign);\n      rest = rest.slice(atSign + 1);\n      this.auth = decodeURIComponent(auth);\n    }\n\n    // the host is the remaining to the left of the first non-host char\n    hostEnd = -1;\n    for (var i = 0; i < nonHostChars.length; i++) {\n      var hec = rest.indexOf(nonHostChars[i]);\n      if (hec !== -1 && (hostEnd === -1 || hec < hostEnd))\n        hostEnd = hec;\n    }\n    // if we still have not hit it, then the entire thing is a host.\n    if (hostEnd === -1)\n      hostEnd = rest.length;\n\n    this.host = rest.slice(0, hostEnd);\n    rest = rest.slice(hostEnd);\n\n    // pull out port.\n    this.parseHost();\n\n    // we've indicated that there is a hostname,\n    // so even if it's empty, it has to be present.\n    this.hostname = this.hostname || '';\n\n    // if hostname begins with [ and ends with ]\n    // assume that it's an IPv6 address.\n    var ipv6Hostname = this.hostname[0] === '[' &&\n        this.hostname[this.hostname.length - 1] === ']';\n\n    // validate a little.\n    if (!ipv6Hostname) {\n      var hostparts = this.hostname.split(/\\./);\n      for (var i = 0, l = hostparts.length; i < l; i++) {\n        var part = hostparts[i];\n        if (!part) continue;\n        if (!part.match(hostnamePartPattern)) {\n          var newpart = '';\n          for (var j = 0, k = part.length; j < k; j++) {\n            if (part.charCodeAt(j) > 127) {\n              // we replace non-ASCII char with a temporary placeholder\n              // we need this to make sure size of hostname is not\n              // broken by replacing non-ASCII by nothing\n              newpart += 'x';\n            } else {\n              newpart += part[j];\n            }\n          }\n          // we test again with ASCII char only\n          if (!newpart.match(hostnamePartPattern)) {\n            var validParts = hostparts.slice(0, i);\n            var notHost = hostparts.slice(i + 1);\n            var bit = part.match(hostnamePartStart);\n            if (bit) {\n              validParts.push(bit[1]);\n              notHost.unshift(bit[2]);\n            }\n            if (notHost.length) {\n              rest = '/' + notHost.join('.') + rest;\n            }\n            this.hostname = validParts.join('.');\n            break;\n          }\n        }\n      }\n    }\n\n    if (this.hostname.length > hostnameMaxLen) {\n      this.hostname = '';\n    } else {\n      // hostnames are always lower case.\n      this.hostname = this.hostname.toLowerCase();\n    }\n\n    if (!ipv6Hostname) {\n      // IDNA Support: Returns a punycoded representation of \"domain\".\n      // It only converts parts of the domain name that\n      // have non-ASCII characters, i.e. it doesn't matter if\n      // you call it with a domain that already is ASCII-only.\n      this.hostname = punycode.toASCII(this.hostname);\n    }\n\n    var p = this.port ? ':' + this.port : '';\n    var h = this.hostname || '';\n    this.host = h + p;\n    this.href += this.host;\n\n    // strip [ and ] from the hostname\n    // the host field still retains them, though\n    if (ipv6Hostname) {\n      this.hostname = this.hostname.substr(1, this.hostname.length - 2);\n      if (rest[0] !== '/') {\n        rest = '/' + rest;\n      }\n    }\n  }\n\n  // now rest is set to the post-host stuff.\n  // chop off any delim chars.\n  if (!unsafeProtocol[lowerProto]) {\n\n    // First, make 100% sure that any \"autoEscape\" chars get\n    // escaped, even if encodeURIComponent doesn't think they\n    // need to be.\n    for (var i = 0, l = autoEscape.length; i < l; i++) {\n      var ae = autoEscape[i];\n      if (rest.indexOf(ae) === -1)\n        continue;\n      var esc = encodeURIComponent(ae);\n      if (esc === ae) {\n        esc = escape(ae);\n      }\n      rest = rest.split(ae).join(esc);\n    }\n  }\n\n\n  // chop off from the tail first.\n  var hash = rest.indexOf('#');\n  if (hash !== -1) {\n    // got a fragment string.\n    this.hash = rest.substr(hash);\n    rest = rest.slice(0, hash);\n  }\n  var qm = rest.indexOf('?');\n  if (qm !== -1) {\n    this.search = rest.substr(qm);\n    this.query = rest.substr(qm + 1);\n    if (parseQueryString) {\n      this.query = querystring.parse(this.query);\n    }\n    rest = rest.slice(0, qm);\n  } else if (parseQueryString) {\n    // no query string, but parseQueryString still requested\n    this.search = '';\n    this.query = {};\n  }\n  if (rest) this.pathname = rest;\n  if (slashedProtocol[lowerProto] &&\n      this.hostname && !this.pathname) {\n    this.pathname = '/';\n  }\n\n  //to support http.request\n  if (this.pathname || this.search) {\n    var p = this.pathname || '';\n    var s = this.search || '';\n    this.path = p + s;\n  }\n\n  // finally, reconstruct the href based on what has been validated.\n  this.href = this.format();\n  return this;\n};\n\n// format a parsed object into a url string\nfunction urlFormat(obj) {\n  // ensure it's an object, and not a string url.\n  // If it's an obj, this is a no-op.\n  // this way, you can call url_format() on strings\n  // to clean up potentially wonky urls.\n  if (util.isString(obj)) obj = urlParse(obj);\n  if (!(obj instanceof Url)) return Url.prototype.format.call(obj);\n  return obj.format();\n}\n\nUrl.prototype.format = function() {\n  var auth = this.auth || '';\n  if (auth) {\n    auth = encodeURIComponent(auth);\n    auth = auth.replace(/%3A/i, ':');\n    auth += '@';\n  }\n\n  var protocol = this.protocol || '',\n      pathname = this.pathname || '',\n      hash = this.hash || '',\n      host = false,\n      query = '';\n\n  if (this.host) {\n    host = auth + this.host;\n  } else if (this.hostname) {\n    host = auth + (this.hostname.indexOf(':') === -1 ?\n        this.hostname :\n        '[' + this.hostname + ']');\n    if (this.port) {\n      host += ':' + this.port;\n    }\n  }\n\n  if (this.query &&\n      util.isObject(this.query) &&\n      Object.keys(this.query).length) {\n    query = querystring.stringify(this.query);\n  }\n\n  var search = this.search || (query && ('?' + query)) || '';\n\n  if (protocol && protocol.substr(-1) !== ':') protocol += ':';\n\n  // only the slashedProtocols get the //.  Not mailto:, xmpp:, etc.\n  // unless they had them to begin with.\n  if (this.slashes ||\n      (!protocol || slashedProtocol[protocol]) && host !== false) {\n    host = '//' + (host || '');\n    if (pathname && pathname.charAt(0) !== '/') pathname = '/' + pathname;\n  } else if (!host) {\n    host = '';\n  }\n\n  if (hash && hash.charAt(0) !== '#') hash = '#' + hash;\n  if (search && search.charAt(0) !== '?') search = '?' + search;\n\n  pathname = pathname.replace(/[?#]/g, function(match) {\n    return encodeURIComponent(match);\n  });\n  search = search.replace('#', '%23');\n\n  return protocol + host + pathname + search + hash;\n};\n\nfunction urlResolve(source, relative) {\n  return urlParse(source, false, true).resolve(relative);\n}\n\nUrl.prototype.resolve = function(relative) {\n  return this.resolveObject(urlParse(relative, false, true)).format();\n};\n\nfunction urlResolveObject(source, relative) {\n  if (!source) return relative;\n  return urlParse(source, false, true).resolveObject(relative);\n}\n\nUrl.prototype.resolveObject = function(relative) {\n  if (util.isString(relative)) {\n    var rel = new Url();\n    rel.parse(relative, false, true);\n    relative = rel;\n  }\n\n  var result = new Url();\n  var tkeys = Object.keys(this);\n  for (var tk = 0; tk < tkeys.length; tk++) {\n    var tkey = tkeys[tk];\n    result[tkey] = this[tkey];\n  }\n\n  // hash is always overridden, no matter what.\n  // even href=\"\" will remove it.\n  result.hash = relative.hash;\n\n  // if the relative url is empty, then there's nothing left to do here.\n  if (relative.href === '') {\n    result.href = result.format();\n    return result;\n  }\n\n  // hrefs like //foo/bar always cut to the protocol.\n  if (relative.slashes && !relative.protocol) {\n    // take everything except the protocol from relative\n    var rkeys = Object.keys(relative);\n    for (var rk = 0; rk < rkeys.length; rk++) {\n      var rkey = rkeys[rk];\n      if (rkey !== 'protocol')\n        result[rkey] = relative[rkey];\n    }\n\n    //urlParse appends trailing / to urls like http://www.example.com\n    if (slashedProtocol[result.protocol] &&\n        result.hostname && !result.pathname) {\n      result.path = result.pathname = '/';\n    }\n\n    result.href = result.format();\n    return result;\n  }\n\n  if (relative.protocol && relative.protocol !== result.protocol) {\n    // if it's a known url protocol, then changing\n    // the protocol does weird things\n    // first, if it's not file:, then we MUST have a host,\n    // and if there was a path\n    // to begin with, then we MUST have a path.\n    // if it is file:, then the host is dropped,\n    // because that's known to be hostless.\n    // anything else is assumed to be absolute.\n    if (!slashedProtocol[relative.protocol]) {\n      var keys = Object.keys(relative);\n      for (var v = 0; v < keys.length; v++) {\n        var k = keys[v];\n        result[k] = relative[k];\n      }\n      result.href = result.format();\n      return result;\n    }\n\n    result.protocol = relative.protocol;\n    if (!relative.host && !hostlessProtocol[relative.protocol]) {\n      var relPath = (relative.pathname || '').split('/');\n      while (relPath.length && !(relative.host = relPath.shift()));\n      if (!relative.host) relative.host = '';\n      if (!relative.hostname) relative.hostname = '';\n      if (relPath[0] !== '') relPath.unshift('');\n      if (relPath.length < 2) relPath.unshift('');\n      result.pathname = relPath.join('/');\n    } else {\n      result.pathname = relative.pathname;\n    }\n    result.search = relative.search;\n    result.query = relative.query;\n    result.host = relative.host || '';\n    result.auth = relative.auth;\n    result.hostname = relative.hostname || relative.host;\n    result.port = relative.port;\n    // to support http.request\n    if (result.pathname || result.search) {\n      var p = result.pathname || '';\n      var s = result.search || '';\n      result.path = p + s;\n    }\n    result.slashes = result.slashes || relative.slashes;\n    result.href = result.format();\n    return result;\n  }\n\n  var isSourceAbs = (result.pathname && result.pathname.charAt(0) === '/'),\n      isRelAbs = (\n          relative.host ||\n          relative.pathname && relative.pathname.charAt(0) === '/'\n      ),\n      mustEndAbs = (isRelAbs || isSourceAbs ||\n                    (result.host && relative.pathname)),\n      removeAllDots = mustEndAbs,\n      srcPath = result.pathname && result.pathname.split('/') || [],\n      relPath = relative.pathname && relative.pathname.split('/') || [],\n      psychotic = result.protocol && !slashedProtocol[result.protocol];\n\n  // if the url is a non-slashed url, then relative\n  // links like ../.. should be able\n  // to crawl up to the hostname, as well.  This is strange.\n  // result.protocol has already been set by now.\n  // Later on, put the first path part into the host field.\n  if (psychotic) {\n    result.hostname = '';\n    result.port = null;\n    if (result.host) {\n      if (srcPath[0] === '') srcPath[0] = result.host;\n      else srcPath.unshift(result.host);\n    }\n    result.host = '';\n    if (relative.protocol) {\n      relative.hostname = null;\n      relative.port = null;\n      if (relative.host) {\n        if (relPath[0] === '') relPath[0] = relative.host;\n        else relPath.unshift(relative.host);\n      }\n      relative.host = null;\n    }\n    mustEndAbs = mustEndAbs && (relPath[0] === '' || srcPath[0] === '');\n  }\n\n  if (isRelAbs) {\n    // it's absolute.\n    result.host = (relative.host || relative.host === '') ?\n                  relative.host : result.host;\n    result.hostname = (relative.hostname || relative.hostname === '') ?\n                      relative.hostname : result.hostname;\n    result.search = relative.search;\n    result.query = relative.query;\n    srcPath = relPath;\n    // fall through to the dot-handling below.\n  } else if (relPath.length) {\n    // it's relative\n    // throw away the existing file, and take the new path instead.\n    if (!srcPath) srcPath = [];\n    srcPath.pop();\n    srcPath = srcPath.concat(relPath);\n    result.search = relative.search;\n    result.query = relative.query;\n  } else if (!util.isNullOrUndefined(relative.search)) {\n    // just pull out the search.\n    // like href='?foo'.\n    // Put this after the other two cases because it simplifies the booleans\n    if (psychotic) {\n      result.hostname = result.host = srcPath.shift();\n      //occationaly the auth can get stuck only in host\n      //this especially happens in cases like\n      //url.resolveObject('mailto:local1@domain1', 'local2@domain2')\n      var authInHost = result.host && result.host.indexOf('@') > 0 ?\n                       result.host.split('@') : false;\n      if (authInHost) {\n        result.auth = authInHost.shift();\n        result.host = result.hostname = authInHost.shift();\n      }\n    }\n    result.search = relative.search;\n    result.query = relative.query;\n    //to support http.request\n    if (!util.isNull(result.pathname) || !util.isNull(result.search)) {\n      result.path = (result.pathname ? result.pathname : '') +\n                    (result.search ? result.search : '');\n    }\n    result.href = result.format();\n    return result;\n  }\n\n  if (!srcPath.length) {\n    // no path at all.  easy.\n    // we've already handled the other stuff above.\n    result.pathname = null;\n    //to support http.request\n    if (result.search) {\n      result.path = '/' + result.search;\n    } else {\n      result.path = null;\n    }\n    result.href = result.format();\n    return result;\n  }\n\n  // if a url ENDs in . or .., then it must get a trailing slash.\n  // however, if it ends in anything else non-slashy,\n  // then it must NOT get a trailing slash.\n  var last = srcPath.slice(-1)[0];\n  var hasTrailingSlash = (\n      (result.host || relative.host || srcPath.length > 1) &&\n      (last === '.' || last === '..') || last === '');\n\n  // strip single dots, resolve double dots to parent dir\n  // if the path tries to go above the root, `up` ends up > 0\n  var up = 0;\n  for (var i = srcPath.length; i >= 0; i--) {\n    last = srcPath[i];\n    if (last === '.') {\n      srcPath.splice(i, 1);\n    } else if (last === '..') {\n      srcPath.splice(i, 1);\n      up++;\n    } else if (up) {\n      srcPath.splice(i, 1);\n      up--;\n    }\n  }\n\n  // if the path is allowed to go above the root, restore leading ..s\n  if (!mustEndAbs && !removeAllDots) {\n    for (; up--; up) {\n      srcPath.unshift('..');\n    }\n  }\n\n  if (mustEndAbs && srcPath[0] !== '' &&\n      (!srcPath[0] || srcPath[0].charAt(0) !== '/')) {\n    srcPath.unshift('');\n  }\n\n  if (hasTrailingSlash && (srcPath.join('/').substr(-1) !== '/')) {\n    srcPath.push('');\n  }\n\n  var isAbsolute = srcPath[0] === '' ||\n      (srcPath[0] && srcPath[0].charAt(0) === '/');\n\n  // put the host back\n  if (psychotic) {\n    result.hostname = result.host = isAbsolute ? '' :\n                                    srcPath.length ? srcPath.shift() : '';\n    //occationaly the auth can get stuck only in host\n    //this especially happens in cases like\n    //url.resolveObject('mailto:local1@domain1', 'local2@domain2')\n    var authInHost = result.host && result.host.indexOf('@') > 0 ?\n                     result.host.split('@') : false;\n    if (authInHost) {\n      result.auth = authInHost.shift();\n      result.host = result.hostname = authInHost.shift();\n    }\n  }\n\n  mustEndAbs = mustEndAbs || (result.host && srcPath.length);\n\n  if (mustEndAbs && !isAbsolute) {\n    srcPath.unshift('');\n  }\n\n  if (!srcPath.length) {\n    result.pathname = null;\n    result.path = null;\n  } else {\n    result.pathname = srcPath.join('/');\n  }\n\n  //to support request.http\n  if (!util.isNull(result.pathname) || !util.isNull(result.search)) {\n    result.path = (result.pathname ? result.pathname : '') +\n                  (result.search ? result.search : '');\n  }\n  result.auth = relative.auth || result.auth;\n  result.slashes = result.slashes || relative.slashes;\n  result.href = result.format();\n  return result;\n};\n\nUrl.prototype.parseHost = function() {\n  var host = this.host;\n  var port = portPattern.exec(host);\n  if (port) {\n    port = port[0];\n    if (port !== ':') {\n      this.port = port.substr(1);\n    }\n    host = host.substr(0, host.length - port.length);\n  }\n  if (host) this.hostname = host;\n};\n\n},{\"./util\":4,\"punycode\":35,\"querystring\":38}],4:[function(require,module,exports){\n'use strict';\n\nmodule.exports = {\n  isString: function(arg) {\n    return typeof(arg) === 'string';\n  },\n  isObject: function(arg) {\n    return typeof(arg) === 'object' && arg !== null;\n  },\n  isNull: function(arg) {\n    return arg === null;\n  },\n  isNullOrUndefined: function(arg) {\n    return arg == null;\n  }\n};\n\n},{}],5:[function(require,module,exports){\nmodule.exports = (function() {\n  /*\n   * Generated by PEG.js 0.8.0.\n   *\n   * http://pegjs.majda.cz/\n   */\n\n  function peg$subclass(child, parent) {\n    function ctor() { this.constructor = child; }\n    ctor.prototype = parent.prototype;\n    child.prototype = new ctor();\n  }\n\n  function SyntaxError(message, expected, found, offset, line, column) {\n    this.message  = message;\n    this.expected = expected;\n    this.found    = found;\n    this.offset   = offset;\n    this.line     = line;\n    this.column   = column;\n\n    this.name     = \"SyntaxError\";\n  }\n\n  peg$subclass(SyntaxError, Error);\n\n  function parse(input) {\n    var options = arguments.length > 1 ? arguments[1] : {},\n\n        peg$FAILED = {},\n\n        peg$startRuleFunctions = { start: peg$parsestart },\n        peg$startRuleFunction  = peg$parsestart,\n\n        peg$c0 = [],\n        peg$c1 = function() { return []},\n        peg$c2 = peg$FAILED,\n        peg$c3 = \",\",\n        peg$c4 = { type: \"literal\", value: \",\", description: \"\\\",\\\"\" },\n        peg$c5 = function(x, xs) { return [x].concat(xs); },\n        peg$c6 = function(entry) { return [entry]; },\n        peg$c7 = function(url, format) { return {url: url, format: format}; },\n        peg$c8 = function(url) { return {url: url}; },\n        peg$c9 = \"url(\",\n        peg$c10 = { type: \"literal\", value: \"url(\", description: \"\\\"url(\\\"\" },\n        peg$c11 = \")\",\n        peg$c12 = { type: \"literal\", value: \")\", description: \"\\\")\\\"\" },\n        peg$c13 = function(value) { return value; },\n        peg$c14 = \"format(\",\n        peg$c15 = { type: \"literal\", value: \"format(\", description: \"\\\"format(\\\"\" },\n        peg$c16 = \"local(\",\n        peg$c17 = { type: \"literal\", value: \"local(\", description: \"\\\"local(\\\"\" },\n        peg$c18 = function(value) { return {local: value}; },\n        peg$c19 = /^[^)]/,\n        peg$c20 = { type: \"class\", value: \"[^)]\", description: \"[^)]\" },\n        peg$c21 = function(chars) { return util.extractValue(chars.join(\"\")); },\n        peg$c22 = /^[ \\t\\r\\n\\f]/,\n        peg$c23 = { type: \"class\", value: \"[ \\\\t\\\\r\\\\n\\\\f]\", description: \"[ \\\\t\\\\r\\\\n\\\\f]\" },\n\n        peg$currPos          = 0,\n        peg$reportedPos      = 0,\n        peg$cachedPos        = 0,\n        peg$cachedPosDetails = { line: 1, column: 1, seenCR: false },\n        peg$maxFailPos       = 0,\n        peg$maxFailExpected  = [],\n        peg$silentFails      = 0,\n\n        peg$result;\n\n    if (\"startRule\" in options) {\n      if (!(options.startRule in peg$startRuleFunctions)) {\n        throw new Error(\"Can't start parsing from rule \\\"\" + options.startRule + \"\\\".\");\n      }\n\n      peg$startRuleFunction = peg$startRuleFunctions[options.startRule];\n    }\n\n    function text() {\n      return input.substring(peg$reportedPos, peg$currPos);\n    }\n\n    function offset() {\n      return peg$reportedPos;\n    }\n\n    function line() {\n      return peg$computePosDetails(peg$reportedPos).line;\n    }\n\n    function column() {\n      return peg$computePosDetails(peg$reportedPos).column;\n    }\n\n    function expected(description) {\n      throw peg$buildException(\n        null,\n        [{ type: \"other\", description: description }],\n        peg$reportedPos\n      );\n    }\n\n    function error(message) {\n      throw peg$buildException(message, null, peg$reportedPos);\n    }\n\n    function peg$computePosDetails(pos) {\n      function advance(details, startPos, endPos) {\n        var p, ch;\n\n        for (p = startPos; p < endPos; p++) {\n          ch = input.charAt(p);\n          if (ch === \"\\n\") {\n            if (!details.seenCR) { details.line++; }\n            details.column = 1;\n            details.seenCR = false;\n          } else if (ch === \"\\r\" || ch === \"\\u2028\" || ch === \"\\u2029\") {\n            details.line++;\n            details.column = 1;\n            details.seenCR = true;\n          } else {\n            details.column++;\n            details.seenCR = false;\n          }\n        }\n      }\n\n      if (peg$cachedPos !== pos) {\n        if (peg$cachedPos > pos) {\n          peg$cachedPos = 0;\n          peg$cachedPosDetails = { line: 1, column: 1, seenCR: false };\n        }\n        advance(peg$cachedPosDetails, peg$cachedPos, pos);\n        peg$cachedPos = pos;\n      }\n\n      return peg$cachedPosDetails;\n    }\n\n    function peg$fail(expected) {\n      if (peg$currPos < peg$maxFailPos) { return; }\n\n      if (peg$currPos > peg$maxFailPos) {\n        peg$maxFailPos = peg$currPos;\n        peg$maxFailExpected = [];\n      }\n\n      peg$maxFailExpected.push(expected);\n    }\n\n    function peg$buildException(message, expected, pos) {\n      function cleanupExpected(expected) {\n        var i = 1;\n\n        expected.sort(function(a, b) {\n          if (a.description < b.description) {\n            return -1;\n          } else if (a.description > b.description) {\n            return 1;\n          } else {\n            return 0;\n          }\n        });\n\n        while (i < expected.length) {\n          if (expected[i - 1] === expected[i]) {\n            expected.splice(i, 1);\n          } else {\n            i++;\n          }\n        }\n      }\n\n      function buildMessage(expected, found) {\n        function stringEscape(s) {\n          function hex(ch) { return ch.charCodeAt(0).toString(16).toUpperCase(); }\n\n          return s\n            .replace(/\\\\/g,   '\\\\\\\\')\n            .replace(/\"/g,    '\\\\\"')\n            .replace(/\\x08/g, '\\\\b')\n            .replace(/\\t/g,   '\\\\t')\n            .replace(/\\n/g,   '\\\\n')\n            .replace(/\\f/g,   '\\\\f')\n            .replace(/\\r/g,   '\\\\r')\n            .replace(/[\\x00-\\x07\\x0B\\x0E\\x0F]/g, function(ch) { return '\\\\x0' + hex(ch); })\n            .replace(/[\\x10-\\x1F\\x80-\\xFF]/g,    function(ch) { return '\\\\x'  + hex(ch); })\n            .replace(/[\\u0180-\\u0FFF]/g,         function(ch) { return '\\\\u0' + hex(ch); })\n            .replace(/[\\u1080-\\uFFFF]/g,         function(ch) { return '\\\\u'  + hex(ch); });\n        }\n\n        var expectedDescs = new Array(expected.length),\n            expectedDesc, foundDesc, i;\n\n        for (i = 0; i < expected.length; i++) {\n          expectedDescs[i] = expected[i].description;\n        }\n\n        expectedDesc = expected.length > 1\n          ? expectedDescs.slice(0, -1).join(\", \")\n              + \" or \"\n              + expectedDescs[expected.length - 1]\n          : expectedDescs[0];\n\n        foundDesc = found ? \"\\\"\" + stringEscape(found) + \"\\\"\" : \"end of input\";\n\n        return \"Expected \" + expectedDesc + \" but \" + foundDesc + \" found.\";\n      }\n\n      var posDetails = peg$computePosDetails(pos),\n          found      = pos < input.length ? input.charAt(pos) : null;\n\n      if (expected !== null) {\n        cleanupExpected(expected);\n      }\n\n      return new SyntaxError(\n        message !== null ? message : buildMessage(expected, found),\n        expected,\n        found,\n        pos,\n        posDetails.line,\n        posDetails.column\n      );\n    }\n\n    function peg$parsestart() {\n      var s0, s1;\n\n      s0 = peg$parsesourceEntries();\n      if (s0 === peg$FAILED) {\n        s0 = peg$currPos;\n        s1 = [];\n        if (s1 !== peg$FAILED) {\n          peg$reportedPos = s0;\n          s1 = peg$c1();\n        }\n        s0 = s1;\n      }\n\n      return s0;\n    }\n\n    function peg$parsesourceEntries() {\n      var s0, s1, s2, s3, s4, s5;\n\n      s0 = peg$currPos;\n      s1 = peg$parsesourceEntry();\n      if (s1 !== peg$FAILED) {\n        s2 = [];\n        s3 = peg$parsewhitespace();\n        while (s3 !== peg$FAILED) {\n          s2.push(s3);\n          s3 = peg$parsewhitespace();\n        }\n        if (s2 !== peg$FAILED) {\n          if (input.charCodeAt(peg$currPos) === 44) {\n            s3 = peg$c3;\n            peg$currPos++;\n          } else {\n            s3 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c4); }\n          }\n          if (s3 !== peg$FAILED) {\n            s4 = [];\n            s5 = peg$parsewhitespace();\n            while (s5 !== peg$FAILED) {\n              s4.push(s5);\n              s5 = peg$parsewhitespace();\n            }\n            if (s4 !== peg$FAILED) {\n              s5 = peg$parsesourceEntries();\n              if (s5 !== peg$FAILED) {\n                peg$reportedPos = s0;\n                s1 = peg$c5(s1, s5);\n                s0 = s1;\n              } else {\n                peg$currPos = s0;\n                s0 = peg$c2;\n              }\n            } else {\n              peg$currPos = s0;\n              s0 = peg$c2;\n            }\n          } else {\n            peg$currPos = s0;\n            s0 = peg$c2;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c2;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c2;\n      }\n      if (s0 === peg$FAILED) {\n        s0 = peg$currPos;\n        s1 = peg$parsesourceEntry();\n        if (s1 !== peg$FAILED) {\n          peg$reportedPos = s0;\n          s1 = peg$c6(s1);\n        }\n        s0 = s1;\n      }\n\n      return s0;\n    }\n\n    function peg$parsesourceEntry() {\n      var s0;\n\n      s0 = peg$parseurlEntry();\n      if (s0 === peg$FAILED) {\n        s0 = peg$parselocalEntry();\n      }\n\n      return s0;\n    }\n\n    function peg$parseurlEntry() {\n      var s0, s1, s2, s3;\n\n      s0 = peg$currPos;\n      s1 = peg$parseurl();\n      if (s1 !== peg$FAILED) {\n        s2 = [];\n        s3 = peg$parsewhitespace();\n        if (s3 !== peg$FAILED) {\n          while (s3 !== peg$FAILED) {\n            s2.push(s3);\n            s3 = peg$parsewhitespace();\n          }\n        } else {\n          s2 = peg$c2;\n        }\n        if (s2 !== peg$FAILED) {\n          s3 = peg$parseformat();\n          if (s3 !== peg$FAILED) {\n            peg$reportedPos = s0;\n            s1 = peg$c7(s1, s3);\n            s0 = s1;\n          } else {\n            peg$currPos = s0;\n            s0 = peg$c2;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c2;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c2;\n      }\n      if (s0 === peg$FAILED) {\n        s0 = peg$currPos;\n        s1 = peg$parseurl();\n        if (s1 !== peg$FAILED) {\n          peg$reportedPos = s0;\n          s1 = peg$c8(s1);\n        }\n        s0 = s1;\n      }\n\n      return s0;\n    }\n\n    function peg$parseurl() {\n      var s0, s1, s2, s3;\n\n      s0 = peg$currPos;\n      if (input.substr(peg$currPos, 4) === peg$c9) {\n        s1 = peg$c9;\n        peg$currPos += 4;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c10); }\n      }\n      if (s1 !== peg$FAILED) {\n        s2 = peg$parsevalue();\n        if (s2 !== peg$FAILED) {\n          if (input.charCodeAt(peg$currPos) === 41) {\n            s3 = peg$c11;\n            peg$currPos++;\n          } else {\n            s3 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c12); }\n          }\n          if (s3 !== peg$FAILED) {\n            peg$reportedPos = s0;\n            s1 = peg$c13(s2);\n            s0 = s1;\n          } else {\n            peg$currPos = s0;\n            s0 = peg$c2;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c2;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c2;\n      }\n\n      return s0;\n    }\n\n    function peg$parseformat() {\n      var s0, s1, s2, s3;\n\n      s0 = peg$currPos;\n      if (input.substr(peg$currPos, 7) === peg$c14) {\n        s1 = peg$c14;\n        peg$currPos += 7;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c15); }\n      }\n      if (s1 !== peg$FAILED) {\n        s2 = peg$parsevalue();\n        if (s2 !== peg$FAILED) {\n          if (input.charCodeAt(peg$currPos) === 41) {\n            s3 = peg$c11;\n            peg$currPos++;\n          } else {\n            s3 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c12); }\n          }\n          if (s3 !== peg$FAILED) {\n            peg$reportedPos = s0;\n            s1 = peg$c13(s2);\n            s0 = s1;\n          } else {\n            peg$currPos = s0;\n            s0 = peg$c2;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c2;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c2;\n      }\n\n      return s0;\n    }\n\n    function peg$parselocalEntry() {\n      var s0, s1, s2, s3;\n\n      s0 = peg$currPos;\n      if (input.substr(peg$currPos, 6) === peg$c16) {\n        s1 = peg$c16;\n        peg$currPos += 6;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c17); }\n      }\n      if (s1 !== peg$FAILED) {\n        s2 = peg$parsevalue();\n        if (s2 !== peg$FAILED) {\n          if (input.charCodeAt(peg$currPos) === 41) {\n            s3 = peg$c11;\n            peg$currPos++;\n          } else {\n            s3 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c12); }\n          }\n          if (s3 !== peg$FAILED) {\n            peg$reportedPos = s0;\n            s1 = peg$c18(s2);\n            s0 = s1;\n          } else {\n            peg$currPos = s0;\n            s0 = peg$c2;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c2;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c2;\n      }\n\n      return s0;\n    }\n\n    function peg$parsevalue() {\n      var s0, s1, s2;\n\n      s0 = peg$currPos;\n      s1 = [];\n      if (peg$c19.test(input.charAt(peg$currPos))) {\n        s2 = input.charAt(peg$currPos);\n        peg$currPos++;\n      } else {\n        s2 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c20); }\n      }\n      if (s2 !== peg$FAILED) {\n        while (s2 !== peg$FAILED) {\n          s1.push(s2);\n          if (peg$c19.test(input.charAt(peg$currPos))) {\n            s2 = input.charAt(peg$currPos);\n            peg$currPos++;\n          } else {\n            s2 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c20); }\n          }\n        }\n      } else {\n        s1 = peg$c2;\n      }\n      if (s1 !== peg$FAILED) {\n        peg$reportedPos = s0;\n        s1 = peg$c21(s1);\n      }\n      s0 = s1;\n\n      return s0;\n    }\n\n    function peg$parsewhitespace() {\n      var s0;\n\n      if (peg$c22.test(input.charAt(peg$currPos))) {\n        s0 = input.charAt(peg$currPos);\n        peg$currPos++;\n      } else {\n        s0 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c23); }\n      }\n\n      return s0;\n    }\n\n\n      var util = require('../util');\n\n\n    peg$result = peg$startRuleFunction();\n\n    if (peg$result !== peg$FAILED && peg$currPos === input.length) {\n      return peg$result;\n    } else {\n      if (peg$result !== peg$FAILED && peg$currPos < input.length) {\n        peg$fail({ type: \"end\", description: \"end of input\" });\n      }\n\n      throw peg$buildException(null, peg$maxFailExpected, peg$maxFailPos);\n    }\n  }\n\n  return {\n    SyntaxError: SyntaxError,\n    parse:       parse\n  };\n})();\n\n},{\"../util\":7}],6:[function(require,module,exports){\nvar grammar = require('./grammar');\n\n\nexports.SyntaxError = function (message, offset) {\n    this.message  = message;\n    this.offset   = offset;\n};\n\nexports.parse = function (fontFaceSourceValue) {\n    try {\n        return grammar.parse(fontFaceSourceValue);\n    } catch (e) {\n        throw new exports.SyntaxError(e.message, e.offset);\n    }\n};\n\nexports.serialize = function (parsedFontFaceSources) {\n    return parsedFontFaceSources.map(function (sourceItem) {\n        var itemValue;\n\n        if (sourceItem.url) {\n            itemValue = 'url(\"' + sourceItem.url + '\")';\n            if (sourceItem.format) {\n                itemValue += ' format(\"' + sourceItem.format + '\")';\n            }\n        } else {\n            itemValue = 'local(\"' + sourceItem.local + '\")';\n        }\n        return itemValue;\n    }).join(', ');\n};\n\n},{\"./grammar\":5}],7:[function(require,module,exports){\nvar trimCSSWhitespace = function (value) {\n    var whitespaceRegex = /^[\\t\\r\\f\\n ]*(.+?)[\\t\\r\\f\\n ]*$/;\n\n    return value.replace(whitespaceRegex, \"$1\");\n};\n\nvar unquoteString = function (quotedUrl) {\n    var doubleQuoteRegex = /^\"(.*)\"$/,\n        singleQuoteRegex = /^'(.*)'$/;\n\n    if (doubleQuoteRegex.test(quotedUrl)) {\n        return quotedUrl.replace(doubleQuoteRegex, \"$1\");\n    } else {\n        if (singleQuoteRegex.test(quotedUrl)) {\n            return quotedUrl.replace(singleQuoteRegex, \"$1\");\n        } else {\n            return quotedUrl;\n        }\n    }\n};\n\nexports.extractValue = function (value) {\n    return unquoteString(trimCSSWhitespace(value));\n};\n\n},{}],8:[function(require,module,exports){\n/*\nCopyright (c) 2014, Yahoo! Inc. All rights reserved.\nCopyrights licensed under the New BSD License.\nSee the accompanying LICENSE file for terms.\n*/\n\n'use strict';\n\nexports.match = matchQuery;\nexports.parse = parseQuery;\n\n// -----------------------------------------------------------------------------\n\nvar RE_MEDIA_QUERY     = /(?:(only|not)?\\s*([^\\s\\(\\)]+)(?:\\s*and)?\\s*)?(.+)?/i,\n    RE_MQ_EXPRESSION   = /\\(\\s*([^\\s\\:\\)]+)\\s*(?:\\:\\s*([^\\s\\)]+))?\\s*\\)/,\n    RE_MQ_FEATURE      = /^(?:(min|max)-)?(.+)/,\n    RE_LENGTH_UNIT     = /(em|rem|px|cm|mm|in|pt|pc)?$/,\n    RE_RESOLUTION_UNIT = /(dpi|dpcm|dppx)?$/;\n\nfunction matchQuery(mediaQuery, values) {\n    return parseQuery(mediaQuery).some(function (query) {\n        var inverse = query.inverse;\n\n        // Either the parsed or specified `type` is \"all\", or the types must be\n        // equal for a match.\n        var typeMatch = query.type === 'all' || values.type === query.type;\n\n        // Quit early when `type` doesn't match, but take \"not\" into account.\n        if ((typeMatch && inverse) || !(typeMatch || inverse)) {\n            return false;\n        }\n\n        var expressionsMatch = query.expressions.every(function (expression) {\n            var feature  = expression.feature,\n                modifier = expression.modifier,\n                expValue = expression.value,\n                value    = values[feature];\n\n            // Missing or falsy values don't match.\n            if (!value) { return false; }\n\n            switch (feature) {\n                case 'orientation':\n                case 'scan':\n                    return value.toLowerCase() === expValue.toLowerCase();\n\n                case 'width':\n                case 'height':\n                case 'device-width':\n                case 'device-height':\n                    expValue = toPx(expValue);\n                    value    = toPx(value);\n                    break;\n\n                case 'resolution':\n                    expValue = toDpi(expValue);\n                    value    = toDpi(value);\n                    break;\n\n                case 'aspect-ratio':\n                case 'device-aspect-ratio':\n                case /* Deprecated */ 'device-pixel-ratio':\n                    expValue = toDecimal(expValue);\n                    value    = toDecimal(value);\n                    break;\n\n                case 'grid':\n                case 'color':\n                case 'color-index':\n                case 'monochrome':\n                    expValue = parseInt(expValue, 10) || 1;\n                    value    = parseInt(value, 10) || 0;\n                    break;\n            }\n\n            switch (modifier) {\n                case 'min': return value >= expValue;\n                case 'max': return value <= expValue;\n                default   : return value === expValue;\n            }\n        });\n\n        return (expressionsMatch && !inverse) || (!expressionsMatch && inverse);\n    });\n}\n\nfunction parseQuery(mediaQuery) {\n    return mediaQuery.split(',').map(function (query) {\n        query = query.trim();\n\n        var captures    = query.match(RE_MEDIA_QUERY),\n            modifier    = captures[1],\n            type        = captures[2],\n            expressions = captures[3] || '',\n            parsed      = {};\n\n        parsed.inverse = !!modifier && modifier.toLowerCase() === 'not';\n        parsed.type    = type ? type.toLowerCase() : 'all';\n\n        // Split expressions into a list.\n        expressions = expressions.match(/\\([^\\)]+\\)/g) || [];\n\n        parsed.expressions = expressions.map(function (expression) {\n            var captures = expression.match(RE_MQ_EXPRESSION),\n                feature  = captures[1].toLowerCase().match(RE_MQ_FEATURE);\n\n            return {\n                modifier: feature[1],\n                feature : feature[2],\n                value   : captures[2]\n            };\n        });\n\n        return parsed;\n    });\n}\n\n// -- Utilities ----------------------------------------------------------------\n\nfunction toDecimal(ratio) {\n    var decimal = Number(ratio),\n        numbers;\n\n    if (!decimal) {\n        numbers = ratio.match(/^(\\d+)\\s*\\/\\s*(\\d+)$/);\n        decimal = numbers[1] / numbers[2];\n    }\n\n    return decimal;\n}\n\nfunction toDpi(resolution) {\n    var value = parseFloat(resolution),\n        units = String(resolution).match(RE_RESOLUTION_UNIT)[1];\n\n    switch (units) {\n        case 'dpcm': return value / 2.54;\n        case 'dppx': return value * 96;\n        default    : return value;\n    }\n}\n\nfunction toPx(length) {\n    var value = parseFloat(length),\n        units = String(length).match(RE_LENGTH_UNIT)[1];\n\n    switch (units) {\n        case 'em' : return value * 16;\n        case 'rem': return value * 16;\n        case 'cm' : return value * 96 / 2.54;\n        case 'mm' : return value * 96 / 2.54 / 10;\n        case 'in' : return value * 96;\n        case 'pt' : return value * 72;\n        case 'pc' : return value * 72 / 12;\n        default   : return value;\n    }\n}\n\n},{}],9:[function(require,module,exports){\n//.CommonJS\nvar CSSOM = {\n    CSSRule: require(\"./CSSRule\").CSSRule,\n    MatcherList: require(\"./MatcherList\").MatcherList\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see https://developer.mozilla.org/en/CSS/@-moz-document\n */\nCSSOM.CSSDocumentRule = function CSSDocumentRule() {\n    CSSOM.CSSRule.call(this);\n    this.matcher = new CSSOM.MatcherList();\n    this.cssRules = [];\n};\n\nCSSOM.CSSDocumentRule.prototype = new CSSOM.CSSRule();\nCSSOM.CSSDocumentRule.prototype.constructor = CSSOM.CSSDocumentRule;\nCSSOM.CSSDocumentRule.prototype.type = 10;\n//FIXME\n//CSSOM.CSSDocumentRule.prototype.insertRule = CSSStyleSheet.prototype.insertRule;\n//CSSOM.CSSDocumentRule.prototype.deleteRule = CSSStyleSheet.prototype.deleteRule;\n\nObject.defineProperty(CSSOM.CSSDocumentRule.prototype, \"cssText\", {\n  get: function() {\n    var cssTexts = [];\n    for (var i=0, length=this.cssRules.length; i < length; i++) {\n        cssTexts.push(this.cssRules[i].cssText);\n    }\n    return \"@-moz-document \" + this.matcher.matcherText + \" {\" + cssTexts.join(\"\") + \"}\";\n  }\n});\n\n\n//.CommonJS\nexports.CSSDocumentRule = CSSOM.CSSDocumentRule;\n///CommonJS\n\n},{\"./CSSRule\":16,\"./MatcherList\":22}],10:[function(require,module,exports){\n//.CommonJS\nvar CSSOM = {\n\tCSSStyleDeclaration: require(\"./CSSStyleDeclaration\").CSSStyleDeclaration,\n\tCSSRule: require(\"./CSSRule\").CSSRule\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#css-font-face-rule\n */\nCSSOM.CSSFontFaceRule = function CSSFontFaceRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.style = new CSSOM.CSSStyleDeclaration();\n\tthis.style.parentRule = this;\n};\n\nCSSOM.CSSFontFaceRule.prototype = new CSSOM.CSSRule();\nCSSOM.CSSFontFaceRule.prototype.constructor = CSSOM.CSSFontFaceRule;\nCSSOM.CSSFontFaceRule.prototype.type = 5;\n//FIXME\n//CSSOM.CSSFontFaceRule.prototype.insertRule = CSSStyleSheet.prototype.insertRule;\n//CSSOM.CSSFontFaceRule.prototype.deleteRule = CSSStyleSheet.prototype.deleteRule;\n\n// http://www.opensource.apple.com/source/WebCore/WebCore-955.66.1/css/WebKitCSSFontFaceRule.cpp\nObject.defineProperty(CSSOM.CSSFontFaceRule.prototype, \"cssText\", {\n  get: function() {\n    return \"@font-face {\" + this.style.cssText + \"}\";\n  }\n});\n\n\n//.CommonJS\nexports.CSSFontFaceRule = CSSOM.CSSFontFaceRule;\n///CommonJS\n\n},{\"./CSSRule\":16,\"./CSSStyleDeclaration\":17}],11:[function(require,module,exports){\n//.CommonJS\nvar CSSOM = {\n\tCSSRule: require(\"./CSSRule\").CSSRule\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://www.w3.org/TR/shadow-dom/#host-at-rule\n */\nCSSOM.CSSHostRule = function CSSHostRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.cssRules = [];\n};\n\nCSSOM.CSSHostRule.prototype = new CSSOM.CSSRule();\nCSSOM.CSSHostRule.prototype.constructor = CSSOM.CSSHostRule;\nCSSOM.CSSHostRule.prototype.type = 1001;\n//FIXME\n//CSSOM.CSSHostRule.prototype.insertRule = CSSStyleSheet.prototype.insertRule;\n//CSSOM.CSSHostRule.prototype.deleteRule = CSSStyleSheet.prototype.deleteRule;\n\nObject.defineProperty(CSSOM.CSSHostRule.prototype, \"cssText\", {\n\tget: function() {\n\t\tvar cssTexts = [];\n\t\tfor (var i=0, length=this.cssRules.length; i < length; i++) {\n\t\t\tcssTexts.push(this.cssRules[i].cssText);\n\t\t}\n\t\treturn \"@host {\" + cssTexts.join(\"\") + \"}\";\n\t}\n});\n\n\n//.CommonJS\nexports.CSSHostRule = CSSOM.CSSHostRule;\n///CommonJS\n\n},{\"./CSSRule\":16}],12:[function(require,module,exports){\n//.CommonJS\nvar CSSOM = {\n\tCSSRule: require(\"./CSSRule\").CSSRule,\n\tCSSStyleSheet: require(\"./CSSStyleSheet\").CSSStyleSheet,\n\tMediaList: require(\"./MediaList\").MediaList\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#cssimportrule\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSImportRule\n */\nCSSOM.CSSImportRule = function CSSImportRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.href = \"\";\n\tthis.media = new CSSOM.MediaList();\n\tthis.styleSheet = new CSSOM.CSSStyleSheet();\n};\n\nCSSOM.CSSImportRule.prototype = new CSSOM.CSSRule();\nCSSOM.CSSImportRule.prototype.constructor = CSSOM.CSSImportRule;\nCSSOM.CSSImportRule.prototype.type = 3;\n\nObject.defineProperty(CSSOM.CSSImportRule.prototype, \"cssText\", {\n  get: function() {\n    var mediaText = this.media.mediaText;\n    return \"@import url(\" + this.href + \")\" + (mediaText ? \" \" + mediaText : \"\") + \";\";\n  },\n  set: function(cssText) {\n    var i = 0;\n\n    /**\n     * @import url(partial.css) screen, handheld;\n     *        ||               |\n     *        after-import     media\n     *         |\n     *         url\n     */\n    var state = '';\n\n    var buffer = '';\n    var index;\n    for (var character; (character = cssText.charAt(i)); i++) {\n\n      switch (character) {\n        case ' ':\n        case '\\t':\n        case '\\r':\n        case '\\n':\n        case '\\f':\n          if (state === 'after-import') {\n            state = 'url';\n          } else {\n            buffer += character;\n          }\n          break;\n\n        case '@':\n          if (!state && cssText.indexOf('@import', i) === i) {\n            state = 'after-import';\n            i += 'import'.length;\n            buffer = '';\n          }\n          break;\n\n        case 'u':\n          if (state === 'url' && cssText.indexOf('url(', i) === i) {\n            index = cssText.indexOf(')', i + 1);\n            if (index === -1) {\n              throw i + ': \")\" not found';\n            }\n            i += 'url('.length;\n            var url = cssText.slice(i, index);\n            if (url[0] === url[url.length - 1]) {\n              if (url[0] === '\"' || url[0] === \"'\") {\n                url = url.slice(1, -1);\n              }\n            }\n            this.href = url;\n            i = index;\n            state = 'media';\n          }\n          break;\n\n        case '\"':\n          if (state === 'url') {\n            index = cssText.indexOf('\"', i + 1);\n            if (!index) {\n              throw i + \": '\\\"' not found\";\n            }\n            this.href = cssText.slice(i + 1, index);\n            i = index;\n            state = 'media';\n          }\n          break;\n\n        case \"'\":\n          if (state === 'url') {\n            index = cssText.indexOf(\"'\", i + 1);\n            if (!index) {\n              throw i + ': \"\\'\" not found';\n            }\n            this.href = cssText.slice(i + 1, index);\n            i = index;\n            state = 'media';\n          }\n          break;\n\n        case ';':\n          if (state === 'media') {\n            if (buffer) {\n              this.media.mediaText = buffer.trim();\n            }\n          }\n          break;\n\n        default:\n          if (state === 'media') {\n            buffer += character;\n          }\n          break;\n      }\n    }\n  }\n});\n\n\n//.CommonJS\nexports.CSSImportRule = CSSOM.CSSImportRule;\n///CommonJS\n\n},{\"./CSSRule\":16,\"./CSSStyleSheet\":19,\"./MediaList\":23}],13:[function(require,module,exports){\n//.CommonJS\nvar CSSOM = {\n\tCSSRule: require(\"./CSSRule\").CSSRule,\n\tCSSStyleDeclaration: require('./CSSStyleDeclaration').CSSStyleDeclaration\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://www.w3.org/TR/css3-animations/#DOM-CSSKeyframeRule\n */\nCSSOM.CSSKeyframeRule = function CSSKeyframeRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.keyText = '';\n\tthis.style = new CSSOM.CSSStyleDeclaration();\n\tthis.style.parentRule = this;\n};\n\nCSSOM.CSSKeyframeRule.prototype = new CSSOM.CSSRule();\nCSSOM.CSSKeyframeRule.prototype.constructor = CSSOM.CSSKeyframeRule;\nCSSOM.CSSKeyframeRule.prototype.type = 9;\n//FIXME\n//CSSOM.CSSKeyframeRule.prototype.insertRule = CSSStyleSheet.prototype.insertRule;\n//CSSOM.CSSKeyframeRule.prototype.deleteRule = CSSStyleSheet.prototype.deleteRule;\n\n// http://www.opensource.apple.com/source/WebCore/WebCore-955.66.1/css/WebKitCSSKeyframeRule.cpp\nObject.defineProperty(CSSOM.CSSKeyframeRule.prototype, \"cssText\", {\n  get: function() {\n    return this.keyText + \" {\" + this.style.cssText + \"} \";\n  }\n});\n\n\n//.CommonJS\nexports.CSSKeyframeRule = CSSOM.CSSKeyframeRule;\n///CommonJS\n\n},{\"./CSSRule\":16,\"./CSSStyleDeclaration\":17}],14:[function(require,module,exports){\n//.CommonJS\nvar CSSOM = {\n\tCSSRule: require(\"./CSSRule\").CSSRule\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://www.w3.org/TR/css3-animations/#DOM-CSSKeyframesRule\n */\nCSSOM.CSSKeyframesRule = function CSSKeyframesRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.name = '';\n\tthis.cssRules = [];\n};\n\nCSSOM.CSSKeyframesRule.prototype = new CSSOM.CSSRule();\nCSSOM.CSSKeyframesRule.prototype.constructor = CSSOM.CSSKeyframesRule;\nCSSOM.CSSKeyframesRule.prototype.type = 8;\n//FIXME\n//CSSOM.CSSKeyframesRule.prototype.insertRule = CSSStyleSheet.prototype.insertRule;\n//CSSOM.CSSKeyframesRule.prototype.deleteRule = CSSStyleSheet.prototype.deleteRule;\n\n// http://www.opensource.apple.com/source/WebCore/WebCore-955.66.1/css/WebKitCSSKeyframesRule.cpp\nObject.defineProperty(CSSOM.CSSKeyframesRule.prototype, \"cssText\", {\n  get: function() {\n    var cssTexts = [];\n    for (var i=0, length=this.cssRules.length; i < length; i++) {\n      cssTexts.push(\"  \" + this.cssRules[i].cssText);\n    }\n    return \"@\" + (this._vendorPrefix || '') + \"keyframes \" + this.name + \" { \\n\" + cssTexts.join(\"\\n\") + \"\\n}\";\n  }\n});\n\n\n//.CommonJS\nexports.CSSKeyframesRule = CSSOM.CSSKeyframesRule;\n///CommonJS\n\n},{\"./CSSRule\":16}],15:[function(require,module,exports){\n//.CommonJS\nvar CSSOM = {\n\tCSSRule: require(\"./CSSRule\").CSSRule,\n\tMediaList: require(\"./MediaList\").MediaList\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#cssmediarule\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSMediaRule\n */\nCSSOM.CSSMediaRule = function CSSMediaRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.media = new CSSOM.MediaList();\n\tthis.cssRules = [];\n};\n\nCSSOM.CSSMediaRule.prototype = new CSSOM.CSSRule();\nCSSOM.CSSMediaRule.prototype.constructor = CSSOM.CSSMediaRule;\nCSSOM.CSSMediaRule.prototype.type = 4;\n//FIXME\n//CSSOM.CSSMediaRule.prototype.insertRule = CSSStyleSheet.prototype.insertRule;\n//CSSOM.CSSMediaRule.prototype.deleteRule = CSSStyleSheet.prototype.deleteRule;\n\n// http://opensource.apple.com/source/WebCore/WebCore-658.28/css/CSSMediaRule.cpp\nObject.defineProperty(CSSOM.CSSMediaRule.prototype, \"cssText\", {\n  get: function() {\n    var cssTexts = [];\n    for (var i=0, length=this.cssRules.length; i < length; i++) {\n      cssTexts.push(this.cssRules[i].cssText);\n    }\n    return \"@media \" + this.media.mediaText + \" {\" + cssTexts.join(\"\") + \"}\";\n  }\n});\n\n\n//.CommonJS\nexports.CSSMediaRule = CSSOM.CSSMediaRule;\n///CommonJS\n\n},{\"./CSSRule\":16,\"./MediaList\":23}],16:[function(require,module,exports){\n//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#the-cssrule-interface\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSRule\n */\nCSSOM.CSSRule = function CSSRule() {\n\tthis.parentRule = null;\n\tthis.parentStyleSheet = null;\n};\n\nCSSOM.CSSRule.UNKNOWN_RULE = 0;                 // obsolete\nCSSOM.CSSRule.STYLE_RULE = 1;\nCSSOM.CSSRule.CHARSET_RULE = 2;                 // obsolete\nCSSOM.CSSRule.IMPORT_RULE = 3;\nCSSOM.CSSRule.MEDIA_RULE = 4;\nCSSOM.CSSRule.FONT_FACE_RULE = 5;\nCSSOM.CSSRule.PAGE_RULE = 6;\nCSSOM.CSSRule.KEYFRAMES_RULE = 7;\nCSSOM.CSSRule.KEYFRAME_RULE = 8;\nCSSOM.CSSRule.MARGIN_RULE = 9;\nCSSOM.CSSRule.NAMESPACE_RULE = 10;\nCSSOM.CSSRule.COUNTER_STYLE_RULE = 11;\nCSSOM.CSSRule.SUPPORTS_RULE = 12;\nCSSOM.CSSRule.DOCUMENT_RULE = 13;\nCSSOM.CSSRule.FONT_FEATURE_VALUES_RULE = 14;\nCSSOM.CSSRule.VIEWPORT_RULE = 15;\nCSSOM.CSSRule.REGION_STYLE_RULE = 16;\n\n\nCSSOM.CSSRule.prototype = {\n\tconstructor: CSSOM.CSSRule\n\t//FIXME\n};\n\n\n//.CommonJS\nexports.CSSRule = CSSOM.CSSRule;\n///CommonJS\n\n},{}],17:[function(require,module,exports){\n//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleDeclaration\n */\nCSSOM.CSSStyleDeclaration = function CSSStyleDeclaration(){\n\tthis.length = 0;\n\tthis.parentRule = null;\n\n\t// NON-STANDARD\n\tthis._importants = {};\n};\n\n\nCSSOM.CSSStyleDeclaration.prototype = {\n\n\tconstructor: CSSOM.CSSStyleDeclaration,\n\n\t/**\n\t *\n\t * @param {string} name\n\t * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleDeclaration-getPropertyValue\n\t * @return {string} the value of the property if it has been explicitly set for this declaration block.\n\t * Returns the empty string if the property has not been set.\n\t */\n\tgetPropertyValue: function(name) {\n\t\treturn this[name] || \"\";\n\t},\n\n\t/**\n\t *\n\t * @param {string} name\n\t * @param {string} value\n\t * @param {string} [priority=null] \"important\" or null\n\t * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleDeclaration-setProperty\n\t */\n\tsetProperty: function(name, value, priority) {\n\t\tif (this[name]) {\n\t\t\t// Property already exist. Overwrite it.\n\t\t\tvar index = Array.prototype.indexOf.call(this, name);\n\t\t\tif (index < 0) {\n\t\t\t\tthis[this.length] = name;\n\t\t\t\tthis.length++;\n\t\t\t}\n\t\t} else {\n\t\t\t// New property.\n\t\t\tthis[this.length] = name;\n\t\t\tthis.length++;\n\t\t}\n\t\tthis[name] = value + \"\";\n\t\tthis._importants[name] = priority;\n\t},\n\n\t/**\n\t *\n\t * @param {string} name\n\t * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleDeclaration-removeProperty\n\t * @return {string} the value of the property if it has been explicitly set for this declaration block.\n\t * Returns the empty string if the property has not been set or the property name does not correspond to a known CSS property.\n\t */\n\tremoveProperty: function(name) {\n\t\tif (!(name in this)) {\n\t\t\treturn \"\";\n\t\t}\n\t\tvar index = Array.prototype.indexOf.call(this, name);\n\t\tif (index < 0) {\n\t\t\treturn \"\";\n\t\t}\n\t\tvar prevValue = this[name];\n\t\tthis[name] = \"\";\n\n\t\t// That's what WebKit and Opera do\n\t\tArray.prototype.splice.call(this, index, 1);\n\n\t\t// That's what Firefox does\n\t\t//this[index] = \"\"\n\n\t\treturn prevValue;\n\t},\n\n\tgetPropertyCSSValue: function() {\n\t\t//FIXME\n\t},\n\n\t/**\n\t *\n\t * @param {String} name\n\t */\n\tgetPropertyPriority: function(name) {\n\t\treturn this._importants[name] || \"\";\n\t},\n\n\n\t/**\n\t *   element.style.overflow = \"auto\"\n\t *   element.style.getPropertyShorthand(\"overflow-x\")\n\t *   -> \"overflow\"\n\t */\n\tgetPropertyShorthand: function() {\n\t\t//FIXME\n\t},\n\n\tisPropertyImplicit: function() {\n\t\t//FIXME\n\t},\n\n\t// Doesn't work in IE < 9\n\tget cssText(){\n\t\tvar properties = [];\n\t\tfor (var i=0, length=this.length; i < length; ++i) {\n\t\t\tvar name = this[i];\n\t\t\tvar value = this.getPropertyValue(name);\n\t\t\tvar priority = this.getPropertyPriority(name);\n\t\t\tif (priority) {\n\t\t\t\tpriority = \" !\" + priority;\n\t\t\t}\n\t\t\tproperties[i] = name + \": \" + value + priority + \";\";\n\t\t}\n\t\treturn properties.join(\" \");\n\t},\n\n\tset cssText(text){\n\t\tvar i, name;\n\t\tfor (i = this.length; i--;) {\n\t\t\tname = this[i];\n\t\t\tthis[name] = \"\";\n\t\t}\n\t\tArray.prototype.splice.call(this, 0, this.length);\n\t\tthis._importants = {};\n\n\t\tvar dummyRule = CSSOM.parse('#bogus{' + text + '}').cssRules[0].style;\n\t\tvar length = dummyRule.length;\n\t\tfor (i = 0; i < length; ++i) {\n\t\t\tname = dummyRule[i];\n\t\t\tthis.setProperty(dummyRule[i], dummyRule.getPropertyValue(name), dummyRule.getPropertyPriority(name));\n\t\t}\n\t}\n};\n\n\n//.CommonJS\nexports.CSSStyleDeclaration = CSSOM.CSSStyleDeclaration;\nCSSOM.parse = require('./parse').parse; // Cannot be included sooner due to the mutual dependency between parse.js and CSSStyleDeclaration.js\n///CommonJS\n\n},{\"./parse\":27}],18:[function(require,module,exports){\n//.CommonJS\nvar CSSOM = {\n\tCSSStyleDeclaration: require(\"./CSSStyleDeclaration\").CSSStyleDeclaration,\n\tCSSRule: require(\"./CSSRule\").CSSRule\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#cssstylerule\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleRule\n */\nCSSOM.CSSStyleRule = function CSSStyleRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.selectorText = \"\";\n\tthis.style = new CSSOM.CSSStyleDeclaration();\n\tthis.style.parentRule = this;\n};\n\nCSSOM.CSSStyleRule.prototype = new CSSOM.CSSRule();\nCSSOM.CSSStyleRule.prototype.constructor = CSSOM.CSSStyleRule;\nCSSOM.CSSStyleRule.prototype.type = 1;\n\nObject.defineProperty(CSSOM.CSSStyleRule.prototype, \"cssText\", {\n\tget: function() {\n\t\tvar text;\n\t\tif (this.selectorText) {\n\t\t\ttext = this.selectorText + \" {\" + this.style.cssText + \"}\";\n\t\t} else {\n\t\t\ttext = \"\";\n\t\t}\n\t\treturn text;\n\t},\n\tset: function(cssText) {\n\t\tvar rule = CSSOM.CSSStyleRule.parse(cssText);\n\t\tthis.style = rule.style;\n\t\tthis.selectorText = rule.selectorText;\n\t}\n});\n\n\n/**\n * NON-STANDARD\n * lightweight version of parse.js.\n * @param {string} ruleText\n * @return CSSStyleRule\n */\nCSSOM.CSSStyleRule.parse = function(ruleText) {\n\tvar i = 0;\n\tvar state = \"selector\";\n\tvar index;\n\tvar j = i;\n\tvar buffer = \"\";\n\n\tvar SIGNIFICANT_WHITESPACE = {\n\t\t\"selector\": true,\n\t\t\"value\": true\n\t};\n\n\tvar styleRule = new CSSOM.CSSStyleRule();\n\tvar name, priority=\"\";\n\n\tfor (var character; (character = ruleText.charAt(i)); i++) {\n\n\t\tswitch (character) {\n\n\t\tcase \" \":\n\t\tcase \"\\t\":\n\t\tcase \"\\r\":\n\t\tcase \"\\n\":\n\t\tcase \"\\f\":\n\t\t\tif (SIGNIFICANT_WHITESPACE[state]) {\n\t\t\t\t// Squash 2 or more white-spaces in the row into 1\n\t\t\t\tswitch (ruleText.charAt(i - 1)) {\n\t\t\t\t\tcase \" \":\n\t\t\t\t\tcase \"\\t\":\n\t\t\t\t\tcase \"\\r\":\n\t\t\t\t\tcase \"\\n\":\n\t\t\t\t\tcase \"\\f\":\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tbuffer += \" \";\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\n\t\t// String\n\t\tcase '\"':\n\t\t\tj = i + 1;\n\t\t\tindex = ruleText.indexOf('\"', j) + 1;\n\t\t\tif (!index) {\n\t\t\t\tthrow '\" is missing';\n\t\t\t}\n\t\t\tbuffer += ruleText.slice(i, index);\n\t\t\ti = index - 1;\n\t\t\tbreak;\n\n\t\tcase \"'\":\n\t\t\tj = i + 1;\n\t\t\tindex = ruleText.indexOf(\"'\", j) + 1;\n\t\t\tif (!index) {\n\t\t\t\tthrow \"' is missing\";\n\t\t\t}\n\t\t\tbuffer += ruleText.slice(i, index);\n\t\t\ti = index - 1;\n\t\t\tbreak;\n\n\t\t// Comment\n\t\tcase \"/\":\n\t\t\tif (ruleText.charAt(i + 1) === \"*\") {\n\t\t\t\ti += 2;\n\t\t\t\tindex = ruleText.indexOf(\"*/\", i);\n\t\t\t\tif (index === -1) {\n\t\t\t\t\tthrow new SyntaxError(\"Missing */\");\n\t\t\t\t} else {\n\t\t\t\t\ti = index + 1;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"{\":\n\t\t\tif (state === \"selector\") {\n\t\t\t\tstyleRule.selectorText = buffer.trim();\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"name\";\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \":\":\n\t\t\tif (state === \"name\") {\n\t\t\t\tname = buffer.trim();\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"value\";\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"!\":\n\t\t\tif (state === \"value\" && ruleText.indexOf(\"!important\", i) === i) {\n\t\t\t\tpriority = \"important\";\n\t\t\t\ti += \"important\".length;\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \";\":\n\t\t\tif (state === \"value\") {\n\t\t\t\tstyleRule.style.setProperty(name, buffer.trim(), priority);\n\t\t\t\tpriority = \"\";\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"name\";\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"}\":\n\t\t\tif (state === \"value\") {\n\t\t\t\tstyleRule.style.setProperty(name, buffer.trim(), priority);\n\t\t\t\tpriority = \"\";\n\t\t\t\tbuffer = \"\";\n\t\t\t} else if (state === \"name\") {\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tstate = \"selector\";\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tbuffer += character;\n\t\t\tbreak;\n\n\t\t}\n\t}\n\n\treturn styleRule;\n\n};\n\n\n//.CommonJS\nexports.CSSStyleRule = CSSOM.CSSStyleRule;\n///CommonJS\n\n},{\"./CSSRule\":16,\"./CSSStyleDeclaration\":17}],19:[function(require,module,exports){\n//.CommonJS\nvar CSSOM = {\n\tStyleSheet: require(\"./StyleSheet\").StyleSheet,\n\tCSSStyleRule: require(\"./CSSStyleRule\").CSSStyleRule\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleSheet\n */\nCSSOM.CSSStyleSheet = function CSSStyleSheet() {\n\tCSSOM.StyleSheet.call(this);\n\tthis.cssRules = [];\n};\n\n\nCSSOM.CSSStyleSheet.prototype = new CSSOM.StyleSheet();\nCSSOM.CSSStyleSheet.prototype.constructor = CSSOM.CSSStyleSheet;\n\n\n/**\n * Used to insert a new rule into the style sheet. The new rule now becomes part of the cascade.\n *\n *   sheet = new Sheet(\"body {margin: 0}\")\n *   sheet.toString()\n *   -> \"body{margin:0;}\"\n *   sheet.insertRule(\"img {border: none}\", 0)\n *   -> 0\n *   sheet.toString()\n *   -> \"img{border:none;}body{margin:0;}\"\n *\n * @param {string} rule\n * @param {number} index\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleSheet-insertRule\n * @return {number} The index within the style sheet's rule collection of the newly inserted rule.\n */\nCSSOM.CSSStyleSheet.prototype.insertRule = function(rule, index) {\n\tif (index < 0 || index > this.cssRules.length) {\n\t\tthrow new RangeError(\"INDEX_SIZE_ERR\");\n\t}\n\tvar cssRule = CSSOM.parse(rule).cssRules[0];\n\tcssRule.parentStyleSheet = this;\n\tthis.cssRules.splice(index, 0, cssRule);\n\treturn index;\n};\n\n\n/**\n * Used to delete a rule from the style sheet.\n *\n *   sheet = new Sheet(\"img{border:none} body{margin:0}\")\n *   sheet.toString()\n *   -> \"img{border:none;}body{margin:0;}\"\n *   sheet.deleteRule(0)\n *   sheet.toString()\n *   -> \"body{margin:0;}\"\n *\n * @param {number} index within the style sheet's rule list of the rule to remove.\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleSheet-deleteRule\n */\nCSSOM.CSSStyleSheet.prototype.deleteRule = function(index) {\n\tif (index < 0 || index >= this.cssRules.length) {\n\t\tthrow new RangeError(\"INDEX_SIZE_ERR\");\n\t}\n\tthis.cssRules.splice(index, 1);\n};\n\n\n/**\n * NON-STANDARD\n * @return {string} serialize stylesheet\n */\nCSSOM.CSSStyleSheet.prototype.toString = function() {\n\tvar result = \"\";\n\tvar rules = this.cssRules;\n\tfor (var i=0; i<rules.length; i++) {\n\t\tresult += rules[i].cssText + \"\\n\";\n\t}\n\treturn result;\n};\n\n\n//.CommonJS\nexports.CSSStyleSheet = CSSOM.CSSStyleSheet;\nCSSOM.parse = require('./parse').parse; // Cannot be included sooner due to the mutual dependency between parse.js and CSSStyleSheet.js\n///CommonJS\n\n},{\"./CSSStyleRule\":18,\"./StyleSheet\":24,\"./parse\":27}],20:[function(require,module,exports){\n//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSValue\n *\n * TODO: add if needed\n */\nCSSOM.CSSValue = function CSSValue() {\n};\n\nCSSOM.CSSValue.prototype = {\n\tconstructor: CSSOM.CSSValue,\n\n\t// @see: http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSValue\n\tset cssText(text) {\n\t\tvar name = this._getConstructorName();\n\n\t\tthrow new Error('DOMException: property \"cssText\" of \"' + name + '\" is readonly and can not be replaced with \"' + text + '\"!');\n\t},\n\n\tget cssText() {\n\t\tvar name = this._getConstructorName();\n\n\t\tthrow new Error('getter \"cssText\" of \"' + name + '\" is not implemented!');\n\t},\n\n\t_getConstructorName: function() {\n\t\tvar s = this.constructor.toString(),\n\t\t\t\tc = s.match(/function\\s([^\\(]+)/),\n\t\t\t\tname = c[1];\n\n\t\treturn name;\n\t}\n};\n\n\n//.CommonJS\nexports.CSSValue = CSSOM.CSSValue;\n///CommonJS\n\n},{}],21:[function(require,module,exports){\n//.CommonJS\nvar CSSOM = {\n\tCSSValue: require('./CSSValue').CSSValue\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://msdn.microsoft.com/en-us/library/ms537634(v=vs.85).aspx\n *\n */\nCSSOM.CSSValueExpression = function CSSValueExpression(token, idx) {\n\tthis._token = token;\n\tthis._idx = idx;\n};\n\nCSSOM.CSSValueExpression.prototype = new CSSOM.CSSValue();\nCSSOM.CSSValueExpression.prototype.constructor = CSSOM.CSSValueExpression;\n\n/**\n * parse css expression() value\n *\n * @return {Object}\n *         - error:\n *         or\n *         - idx:\n *         - expression:\n *\n * Example:\n *\n * .selector {\n *\t\tzoom: expression(documentElement.clientWidth > 1000 ? '1000px' : 'auto');\n * }\n */\nCSSOM.CSSValueExpression.prototype.parse = function() {\n\tvar token = this._token,\n\t\t\tidx = this._idx;\n\n\tvar character = '',\n\t\t\texpression = '',\n\t\t\terror = '',\n\t\t\tinfo,\n\t\t\tparen = [];\n\n\n\tfor (; ; ++idx) {\n\t\tcharacter = token.charAt(idx);\n\n\t\t// end of token\n\t\tif (character === '') {\n\t\t\terror = 'css expression error: unfinished expression!';\n\t\t\tbreak;\n\t\t}\n\n\t\tswitch(character) {\n\t\t\tcase '(':\n\t\t\t\tparen.push(character);\n\t\t\t\texpression += character;\n\t\t\t\tbreak;\n\n\t\t\tcase ')':\n\t\t\t\tparen.pop(character);\n\t\t\t\texpression += character;\n\t\t\t\tbreak;\n\n\t\t\tcase '/':\n\t\t\t\tif ((info = this._parseJSComment(token, idx))) { // comment?\n\t\t\t\t\tif (info.error) {\n\t\t\t\t\t\terror = 'css expression error: unfinished comment in expression!';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tidx = info.idx;\n\t\t\t\t\t\t// ignore the comment\n\t\t\t\t\t}\n\t\t\t\t} else if ((info = this._parseJSRexExp(token, idx))) { // regexp\n\t\t\t\t\tidx = info.idx;\n\t\t\t\t\texpression += info.text;\n\t\t\t\t} else { // other\n\t\t\t\t\texpression += character;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase \"'\":\n\t\t\tcase '\"':\n\t\t\t\tinfo = this._parseJSString(token, idx, character);\n\t\t\t\tif (info) { // string\n\t\t\t\t\tidx = info.idx;\n\t\t\t\t\texpression += info.text;\n\t\t\t\t} else {\n\t\t\t\t\texpression += character;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\texpression += character;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (error) {\n\t\t\tbreak;\n\t\t}\n\n\t\t// end of expression\n\t\tif (paren.length === 0) {\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tvar ret;\n\tif (error) {\n\t\tret = {\n\t\t\terror: error\n\t\t};\n\t} else {\n\t\tret = {\n\t\t\tidx: idx,\n\t\t\texpression: expression\n\t\t};\n\t}\n\n\treturn ret;\n};\n\n\n/**\n *\n * @return {Object|false}\n *          - idx:\n *          - text:\n *          or\n *          - error:\n *          or\n *          false\n *\n */\nCSSOM.CSSValueExpression.prototype._parseJSComment = function(token, idx) {\n\tvar nextChar = token.charAt(idx + 1),\n\t\t\ttext;\n\n\tif (nextChar === '/' || nextChar === '*') {\n\t\tvar startIdx = idx,\n\t\t\t\tendIdx,\n\t\t\t\tcommentEndChar;\n\n\t\tif (nextChar === '/') { // line comment\n\t\t\tcommentEndChar = '\\n';\n\t\t} else if (nextChar === '*') { // block comment\n\t\t\tcommentEndChar = '*/';\n\t\t}\n\n\t\tendIdx = token.indexOf(commentEndChar, startIdx + 1 + 1);\n\t\tif (endIdx !== -1) {\n\t\t\tendIdx = endIdx + commentEndChar.length - 1;\n\t\t\ttext = token.substring(idx, endIdx + 1);\n\t\t\treturn {\n\t\t\t\tidx: endIdx,\n\t\t\t\ttext: text\n\t\t\t};\n\t\t} else {\n\t\t\tvar error = 'css expression error: unfinished comment in expression!';\n\t\t\treturn {\n\t\t\t\terror: error\n\t\t\t};\n\t\t}\n\t} else {\n\t\treturn false;\n\t}\n};\n\n\n/**\n *\n * @return {Object|false}\n *\t\t\t\t\t- idx:\n *\t\t\t\t\t- text:\n *\t\t\t\t\tor \n *\t\t\t\t\tfalse\n *\n */\nCSSOM.CSSValueExpression.prototype._parseJSString = function(token, idx, sep) {\n\tvar endIdx = this._findMatchedIdx(token, idx, sep),\n\t\t\ttext;\n\n\tif (endIdx === -1) {\n\t\treturn false;\n\t} else {\n\t\ttext = token.substring(idx, endIdx + sep.length);\n\n\t\treturn {\n\t\t\tidx: endIdx,\n\t\t\ttext: text\n\t\t};\n\t}\n};\n\n\n/**\n * parse regexp in css expression\n *\n * @return {Object|false}\n *\t\t\t\t- idx:\n *\t\t\t\t- regExp:\n *\t\t\t\tor \n *\t\t\t\tfalse\n */\n\n/*\n\nall legal RegExp\n \n/a/\n(/a/)\n[/a/]\n[12, /a/]\n\n!/a/\n\n+/a/\n-/a/\n* /a/\n/ /a/\n%/a/\n\n===/a/\n!==/a/\n==/a/\n!=/a/\n>/a/\n>=/a/\n</a/\n<=/a/\n\n&/a/\n|/a/\n^/a/\n~/a/\n<</a/\n>>/a/\n>>>/a/\n\n&&/a/\n||/a/\n?/a/\n=/a/\n,/a/\n\n\t\tdelete /a/\n\t\t\t\tin /a/\ninstanceof /a/\n\t\t\t\tnew /a/\n\t\ttypeof /a/\n\t\t\tvoid /a/\n\n*/\nCSSOM.CSSValueExpression.prototype._parseJSRexExp = function(token, idx) {\n\tvar before = token.substring(0, idx).replace(/\\s+$/, \"\"),\n\t\t\tlegalRegx = [\n\t\t\t\t/^$/,\n\t\t\t\t/\\($/,\n\t\t\t\t/\\[$/,\n\t\t\t\t/\\!$/,\n\t\t\t\t/\\+$/,\n\t\t\t\t/\\-$/,\n\t\t\t\t/\\*$/,\n\t\t\t\t/\\/\\s+/,\n\t\t\t\t/\\%$/,\n\t\t\t\t/\\=$/,\n\t\t\t\t/\\>$/,\n\t\t\t\t/<$/,\n\t\t\t\t/\\&$/,\n\t\t\t\t/\\|$/,\n\t\t\t\t/\\^$/,\n\t\t\t\t/\\~$/,\n\t\t\t\t/\\?$/,\n\t\t\t\t/\\,$/,\n\t\t\t\t/delete$/,\n\t\t\t\t/in$/,\n\t\t\t\t/instanceof$/,\n\t\t\t\t/new$/,\n\t\t\t\t/typeof$/,\n\t\t\t\t/void$/\n\t\t\t];\n\n\tvar isLegal = legalRegx.some(function(reg) {\n\t\treturn reg.test(before);\n\t});\n\n\tif (!isLegal) {\n\t\treturn false;\n\t} else {\n\t\tvar sep = '/';\n\n\t\t// same logic as string\n\t\treturn this._parseJSString(token, idx, sep);\n\t}\n};\n\n\n/**\n *\n * find next sep(same line) index in `token`\n *\n * @return {Number}\n *\n */\nCSSOM.CSSValueExpression.prototype._findMatchedIdx = function(token, idx, sep) {\n\tvar startIdx = idx,\n\t\t\tendIdx;\n\n\tvar NOT_FOUND = -1;\n\n\twhile(true) {\n\t\tendIdx = token.indexOf(sep, startIdx + 1);\n\n\t\tif (endIdx === -1) { // not found\n\t\t\tendIdx = NOT_FOUND;\n\t\t\tbreak;\n\t\t} else {\n\t\t\tvar text = token.substring(idx + 1, endIdx),\n\t\t\t\t\tmatched = text.match(/\\\\+$/);\n\t\t\tif (!matched || matched[0] % 2 === 0) { // not escaped\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tstartIdx = endIdx;\n\t\t\t}\n\t\t}\n\t}\n\n\t// boundary must be in the same line(js sting or regexp)\n\tvar nextNewLineIdx = token.indexOf('\\n', idx + 1);\n\tif (nextNewLineIdx < endIdx) {\n\t\tendIdx = NOT_FOUND;\n\t}\n\n\n\treturn endIdx;\n};\n\n\n\n\n//.CommonJS\nexports.CSSValueExpression = CSSOM.CSSValueExpression;\n///CommonJS\n\n},{\"./CSSValue\":20}],22:[function(require,module,exports){\n//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see https://developer.mozilla.org/en/CSS/@-moz-document\n */\nCSSOM.MatcherList = function MatcherList(){\n    this.length = 0;\n};\n\nCSSOM.MatcherList.prototype = {\n\n    constructor: CSSOM.MatcherList,\n\n    /**\n     * @return {string}\n     */\n    get matcherText() {\n        return Array.prototype.join.call(this, \", \");\n    },\n\n    /**\n     * @param {string} value\n     */\n    set matcherText(value) {\n        // just a temporary solution, actually it may be wrong by just split the value with ',', because a url can include ','.\n        var values = value.split(\",\");\n        var length = this.length = values.length;\n        for (var i=0; i<length; i++) {\n            this[i] = values[i].trim();\n        }\n    },\n\n    /**\n     * @param {string} matcher\n     */\n    appendMatcher: function(matcher) {\n        if (Array.prototype.indexOf.call(this, matcher) === -1) {\n            this[this.length] = matcher;\n            this.length++;\n        }\n    },\n\n    /**\n     * @param {string} matcher\n     */\n    deleteMatcher: function(matcher) {\n        var index = Array.prototype.indexOf.call(this, matcher);\n        if (index !== -1) {\n            Array.prototype.splice.call(this, index, 1);\n        }\n    }\n\n};\n\n\n//.CommonJS\nexports.MatcherList = CSSOM.MatcherList;\n///CommonJS\n\n},{}],23:[function(require,module,exports){\n//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#the-medialist-interface\n */\nCSSOM.MediaList = function MediaList(){\n\tthis.length = 0;\n};\n\nCSSOM.MediaList.prototype = {\n\n\tconstructor: CSSOM.MediaList,\n\n\t/**\n\t * @return {string}\n\t */\n\tget mediaText() {\n\t\treturn Array.prototype.join.call(this, \", \");\n\t},\n\n\t/**\n\t * @param {string} value\n\t */\n\tset mediaText(value) {\n\t\tvar values = value.split(\",\");\n\t\tvar length = this.length = values.length;\n\t\tfor (var i=0; i<length; i++) {\n\t\t\tthis[i] = values[i].trim();\n\t\t}\n\t},\n\n\t/**\n\t * @param {string} medium\n\t */\n\tappendMedium: function(medium) {\n\t\tif (Array.prototype.indexOf.call(this, medium) === -1) {\n\t\t\tthis[this.length] = medium;\n\t\t\tthis.length++;\n\t\t}\n\t},\n\n\t/**\n\t * @param {string} medium\n\t */\n\tdeleteMedium: function(medium) {\n\t\tvar index = Array.prototype.indexOf.call(this, medium);\n\t\tif (index !== -1) {\n\t\t\tArray.prototype.splice.call(this, index, 1);\n\t\t}\n\t}\n\n};\n\n\n//.CommonJS\nexports.MediaList = CSSOM.MediaList;\n///CommonJS\n\n},{}],24:[function(require,module,exports){\n//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#the-stylesheet-interface\n */\nCSSOM.StyleSheet = function StyleSheet() {\n\tthis.parentStyleSheet = null;\n};\n\n\n//.CommonJS\nexports.StyleSheet = CSSOM.StyleSheet;\n///CommonJS\n\n},{}],25:[function(require,module,exports){\n//.CommonJS\nvar CSSOM = {\n\tCSSStyleSheet: require(\"./CSSStyleSheet\").CSSStyleSheet,\n\tCSSStyleRule: require(\"./CSSStyleRule\").CSSStyleRule,\n\tCSSMediaRule: require(\"./CSSMediaRule\").CSSMediaRule,\n\tCSSStyleDeclaration: require(\"./CSSStyleDeclaration\").CSSStyleDeclaration,\n\tCSSKeyframeRule: require('./CSSKeyframeRule').CSSKeyframeRule,\n\tCSSKeyframesRule: require('./CSSKeyframesRule').CSSKeyframesRule\n};\n///CommonJS\n\n\n/**\n * Produces a deep copy of stylesheet — the instance variables of stylesheet are copied recursively.\n * @param {CSSStyleSheet|CSSOM.CSSStyleSheet} stylesheet\n * @nosideeffects\n * @return {CSSOM.CSSStyleSheet}\n */\nCSSOM.clone = function clone(stylesheet) {\n\n\tvar cloned = new CSSOM.CSSStyleSheet();\n\n\tvar rules = stylesheet.cssRules;\n\tif (!rules) {\n\t\treturn cloned;\n\t}\n\n\tvar RULE_TYPES = {\n\t\t1: CSSOM.CSSStyleRule,\n\t\t4: CSSOM.CSSMediaRule,\n\t\t//3: CSSOM.CSSImportRule,\n\t\t//5: CSSOM.CSSFontFaceRule,\n\t\t//6: CSSOM.CSSPageRule,\n\t\t8: CSSOM.CSSKeyframesRule,\n\t\t9: CSSOM.CSSKeyframeRule\n\t};\n\n\tfor (var i=0, rulesLength=rules.length; i < rulesLength; i++) {\n\t\tvar rule = rules[i];\n\t\tvar ruleClone = cloned.cssRules[i] = new RULE_TYPES[rule.type]();\n\n\t\tvar style = rule.style;\n\t\tif (style) {\n\t\t\tvar styleClone = ruleClone.style = new CSSOM.CSSStyleDeclaration();\n\t\t\tfor (var j=0, styleLength=style.length; j < styleLength; j++) {\n\t\t\t\tvar name = styleClone[j] = style[j];\n\t\t\t\tstyleClone[name] = style[name];\n\t\t\t\tstyleClone._importants[name] = style.getPropertyPriority(name);\n\t\t\t}\n\t\t\tstyleClone.length = style.length;\n\t\t}\n\n\t\tif (rule.hasOwnProperty('keyText')) {\n\t\t\truleClone.keyText = rule.keyText;\n\t\t}\n\n\t\tif (rule.hasOwnProperty('selectorText')) {\n\t\t\truleClone.selectorText = rule.selectorText;\n\t\t}\n\n\t\tif (rule.hasOwnProperty('mediaText')) {\n\t\t\truleClone.mediaText = rule.mediaText;\n\t\t}\n\n\t\tif (rule.hasOwnProperty('cssRules')) {\n\t\t\truleClone.cssRules = clone(rule).cssRules;\n\t\t}\n\t}\n\n\treturn cloned;\n\n};\n\n//.CommonJS\nexports.clone = CSSOM.clone;\n///CommonJS\n\n},{\"./CSSKeyframeRule\":13,\"./CSSKeyframesRule\":14,\"./CSSMediaRule\":15,\"./CSSStyleDeclaration\":17,\"./CSSStyleRule\":18,\"./CSSStyleSheet\":19}],26:[function(require,module,exports){\nexports.CSSStyleDeclaration = require(\"./CSSStyleDeclaration\").CSSStyleDeclaration;\nexports.CSSRule = require(\"./CSSRule\").CSSRule;\nexports.CSSStyleRule = require(\"./CSSStyleRule\").CSSStyleRule;\nexports.CSSImportRule = require(\"./CSSImportRule\").CSSImportRule;\nexports.MediaList = require(\"./MediaList\").MediaList;\nexports.CSSMediaRule = require(\"./CSSMediaRule\").CSSMediaRule;\nexports.StyleSheet = require(\"./StyleSheet\").StyleSheet;\nexports.CSSStyleSheet = require(\"./CSSStyleSheet\").CSSStyleSheet;\nexports.parse = require(\"./parse\").parse;\nexports.clone = require(\"./clone\").clone;\n\n},{\"./CSSImportRule\":12,\"./CSSMediaRule\":15,\"./CSSRule\":16,\"./CSSStyleDeclaration\":17,\"./CSSStyleRule\":18,\"./CSSStyleSheet\":19,\"./MediaList\":23,\"./StyleSheet\":24,\"./clone\":25,\"./parse\":27}],27:[function(require,module,exports){\n//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @param {string} token\n */\nCSSOM.parse = function parse(token) {\n\n\tvar i = 0;\n\n\t/**\n\t\t\"before-selector\" or\n\t\t\"selector\" or\n\t\t\"atRule\" or\n\t\t\"atBlock\" or\n\t\t\"before-name\" or\n\t\t\"name\" or\n\t\t\"before-value\" or\n\t\t\"value\"\n\t*/\n\tvar state = \"before-selector\";\n\n\tvar index;\n\tvar buffer = \"\";\n\tvar valueParenthesisDepth = 0;\n\n\tvar SIGNIFICANT_WHITESPACE = {\n\t\t\"selector\": true,\n\t\t\"value\": true,\n\t\t\"value-parenthesis\": true,\n\t\t\"atRule\": true,\n\t\t\"importRule-begin\": true,\n\t\t\"importRule\": true,\n\t\t\"atBlock\": true,\n\t\t'documentRule-begin': true\n\t};\n\n\tvar styleSheet = new CSSOM.CSSStyleSheet();\n\n\t// @type CSSStyleSheet|CSSMediaRule|CSSFontFaceRule|CSSKeyframesRule|CSSDocumentRule\n\tvar currentScope = styleSheet;\n\n\t// @type CSSMediaRule|CSSKeyframesRule|CSSDocumentRule\n\tvar parentRule;\n\n\tvar name, priority=\"\", styleRule, mediaRule, importRule, fontFaceRule, keyframesRule, documentRule, hostRule;\n\n\tvar atKeyframesRegExp = /@(-(?:\\w+-)+)?keyframes/g;\n\n\tvar parseError = function(message) {\n\t\tvar lines = token.substring(0, i).split('\\n');\n\t\tvar lineCount = lines.length;\n\t\tvar charCount = lines.pop().length + 1;\n\t\tvar error = new Error(message + ' (line ' + lineCount + ', char ' + charCount + ')');\n\t\terror.line = lineCount;\n\t\t/* jshint sub : true */\n\t\terror['char'] = charCount;\n\t\terror.styleSheet = styleSheet;\n\t\tthrow error;\n\t};\n\n\tfor (var character; (character = token.charAt(i)); i++) {\n\n\t\tswitch (character) {\n\n\t\tcase \" \":\n\t\tcase \"\\t\":\n\t\tcase \"\\r\":\n\t\tcase \"\\n\":\n\t\tcase \"\\f\":\n\t\t\tif (SIGNIFICANT_WHITESPACE[state]) {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\t// String\n\t\tcase '\"':\n\t\t\tindex = i + 1;\n\t\t\tdo {\n\t\t\t\tindex = token.indexOf('\"', index) + 1;\n\t\t\t\tif (!index) {\n\t\t\t\t\tparseError('Unmatched \"');\n\t\t\t\t}\n\t\t\t} while (token[index - 2] === '\\\\');\n\t\t\tbuffer += token.slice(i, index);\n\t\t\ti = index - 1;\n\t\t\tswitch (state) {\n\t\t\t\tcase 'before-value':\n\t\t\t\t\tstate = 'value';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'importRule-begin':\n\t\t\t\t\tstate = 'importRule';\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"'\":\n\t\t\tindex = i + 1;\n\t\t\tdo {\n\t\t\t\tindex = token.indexOf(\"'\", index) + 1;\n\t\t\t\tif (!index) {\n\t\t\t\t\tparseError(\"Unmatched '\");\n\t\t\t\t}\n\t\t\t} while (token[index - 2] === '\\\\');\n\t\t\tbuffer += token.slice(i, index);\n\t\t\ti = index - 1;\n\t\t\tswitch (state) {\n\t\t\t\tcase 'before-value':\n\t\t\t\t\tstate = 'value';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'importRule-begin':\n\t\t\t\t\tstate = 'importRule';\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\n\t\t// Comment\n\t\tcase \"/\":\n\t\t\tif (token.charAt(i + 1) === \"*\") {\n\t\t\t\ti += 2;\n\t\t\t\tindex = token.indexOf(\"*/\", i);\n\t\t\t\tif (index === -1) {\n\t\t\t\t\tparseError(\"Missing */\");\n\t\t\t\t} else {\n\t\t\t\t\ti = index + 1;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tif (state === \"importRule-begin\") {\n\t\t\t\tbuffer += \" \";\n\t\t\t\tstate = \"importRule\";\n\t\t\t}\n\t\t\tbreak;\n\n\t\t// At-rule\n\t\tcase \"@\":\n\t\t\tif (token.indexOf(\"@-moz-document\", i) === i) {\n\t\t\t\tstate = \"documentRule-begin\";\n\t\t\t\tdocumentRule = new CSSOM.CSSDocumentRule();\n\t\t\t\tdocumentRule.__starts = i;\n\t\t\t\ti += \"-moz-document\".length;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tbreak;\n\t\t\t} else if (token.indexOf(\"@media\", i) === i) {\n\t\t\t\tstate = \"atBlock\";\n\t\t\t\tmediaRule = new CSSOM.CSSMediaRule();\n\t\t\t\tmediaRule.__starts = i;\n\t\t\t\ti += \"media\".length;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tbreak;\n\t\t\t} else if (token.indexOf(\"@host\", i) === i) {\n\t\t\t\tstate = \"hostRule-begin\";\n\t\t\t\ti += \"host\".length;\n\t\t\t\thostRule = new CSSOM.CSSHostRule();\n\t\t\t\thostRule.__starts = i;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tbreak;\n\t\t\t} else if (token.indexOf(\"@import\", i) === i) {\n\t\t\t\tstate = \"importRule-begin\";\n\t\t\t\ti += \"import\".length;\n\t\t\t\tbuffer += \"@import\";\n\t\t\t\tbreak;\n\t\t\t} else if (token.indexOf(\"@font-face\", i) === i) {\n\t\t\t\tstate = \"fontFaceRule-begin\";\n\t\t\t\ti += \"font-face\".length;\n\t\t\t\tfontFaceRule = new CSSOM.CSSFontFaceRule();\n\t\t\t\tfontFaceRule.__starts = i;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tatKeyframesRegExp.lastIndex = i;\n\t\t\t\tvar matchKeyframes = atKeyframesRegExp.exec(token);\n\t\t\t\tif (matchKeyframes && matchKeyframes.index === i) {\n\t\t\t\t\tstate = \"keyframesRule-begin\";\n\t\t\t\t\tkeyframesRule = new CSSOM.CSSKeyframesRule();\n\t\t\t\t\tkeyframesRule.__starts = i;\n\t\t\t\t\tkeyframesRule._vendorPrefix = matchKeyframes[1]; // Will come out as undefined if no prefix was found\n\t\t\t\t\ti += matchKeyframes[0].length - 1;\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tbreak;\n\t\t\t\t} else if (state === \"selector\") {\n\t\t\t\t\tstate = \"atRule\";\n\t\t\t\t}\n\t\t\t}\n\t\t\tbuffer += character;\n\t\t\tbreak;\n\n\t\tcase \"{\":\n\t\t\tif (state === \"selector\" || state === \"atRule\") {\n\t\t\t\tstyleRule.selectorText = buffer.trim();\n\t\t\t\tstyleRule.style.__starts = i;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-name\";\n\t\t\t} else if (state === \"atBlock\") {\n\t\t\t\tmediaRule.media.mediaText = buffer.trim();\n\t\t\t\tcurrentScope = parentRule = mediaRule;\n\t\t\t\tmediaRule.parentStyleSheet = styleSheet;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-selector\";\n\t\t\t} else if (state === \"hostRule-begin\") {\n\t\t\t\tcurrentScope = parentRule = hostRule;\n\t\t\t\thostRule.parentStyleSheet = styleSheet;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-selector\";\n\t\t\t} else if (state === \"fontFaceRule-begin\") {\n\t\t\t\tif (parentRule) {\n\t\t\t\t\tfontFaceRule.parentRule = parentRule;\n\t\t\t\t}\n\t\t\t\tfontFaceRule.parentStyleSheet = styleSheet;\n\t\t\t\tstyleRule = fontFaceRule;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-name\";\n\t\t\t} else if (state === \"keyframesRule-begin\") {\n\t\t\t\tkeyframesRule.name = buffer.trim();\n\t\t\t\tif (parentRule) {\n\t\t\t\t\tkeyframesRule.parentRule = parentRule;\n\t\t\t\t}\n\t\t\t\tkeyframesRule.parentStyleSheet = styleSheet;\n\t\t\t\tcurrentScope = parentRule = keyframesRule;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"keyframeRule-begin\";\n\t\t\t} else if (state === \"keyframeRule-begin\") {\n\t\t\t\tstyleRule = new CSSOM.CSSKeyframeRule();\n\t\t\t\tstyleRule.keyText = buffer.trim();\n\t\t\t\tstyleRule.__starts = i;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-name\";\n\t\t\t} else if (state === \"documentRule-begin\") {\n\t\t\t\t// FIXME: what if this '{' is in the url text of the match function?\n\t\t\t\tdocumentRule.matcher.matcherText = buffer.trim();\n\t\t\t\tif (parentRule) {\n\t\t\t\t\tdocumentRule.parentRule = parentRule;\n\t\t\t\t}\n\t\t\t\tcurrentScope = parentRule = documentRule;\n\t\t\t\tdocumentRule.parentStyleSheet = styleSheet;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-selector\";\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \":\":\n\t\t\tif (state === \"name\") {\n\t\t\t\tname = buffer.trim();\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-value\";\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"(\":\n\t\t\tif (state === 'value') {\n\t\t\t\t// ie css expression mode\n\t\t\t\tif (buffer.trim() === 'expression') {\n\t\t\t\t\tvar info = (new CSSOM.CSSValueExpression(token, i)).parse();\n\n\t\t\t\t\tif (info.error) {\n\t\t\t\t\t\tparseError(info.error);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbuffer += info.expression;\n\t\t\t\t\t\ti = info.idx;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tstate = 'value-parenthesis';\n\t\t\t\t\t//always ensure this is reset to 1 on transition\n\t\t\t\t\t//from value to value-parenthesis\n\t\t\t\t\tvalueParenthesisDepth = 1;\n\t\t\t\t\tbuffer += character;\n\t\t\t\t}\n\t\t\t} else if (state === 'value-parenthesis') {\n\t\t\t\tvalueParenthesisDepth++;\n\t\t\t\tbuffer += character;\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \")\":\n\t\t\tif (state === 'value-parenthesis') {\n\t\t\t\tvalueParenthesisDepth--;\n\t\t\t\tif (valueParenthesisDepth === 0) state = 'value';\n\t\t\t}\n\t\t\tbuffer += character;\n\t\t\tbreak;\n\n\t\tcase \"!\":\n\t\t\tif (state === \"value\" && token.indexOf(\"!important\", i) === i) {\n\t\t\t\tpriority = \"important\";\n\t\t\t\ti += \"important\".length;\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \";\":\n\t\t\tswitch (state) {\n\t\t\t\tcase \"value\":\n\t\t\t\t\tstyleRule.style.setProperty(name, buffer.trim(), priority);\n\t\t\t\t\tpriority = \"\";\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tstate = \"before-name\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"atRule\":\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tstate = \"before-selector\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"importRule\":\n\t\t\t\t\timportRule = new CSSOM.CSSImportRule();\n\t\t\t\t\timportRule.parentStyleSheet = importRule.styleSheet.parentStyleSheet = styleSheet;\n\t\t\t\t\timportRule.cssText = buffer + character;\n\t\t\t\t\tstyleSheet.cssRules.push(importRule);\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tstate = \"before-selector\";\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbuffer += character;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"}\":\n\t\t\tswitch (state) {\n\t\t\t\tcase \"value\":\n\t\t\t\t\tstyleRule.style.setProperty(name, buffer.trim(), priority);\n\t\t\t\t\tpriority = \"\";\n\t\t\t\t\t/* falls through */\n\t\t\t\tcase \"before-name\":\n\t\t\t\tcase \"name\":\n\t\t\t\t\tstyleRule.__ends = i + 1;\n\t\t\t\t\tif (parentRule) {\n\t\t\t\t\t\tstyleRule.parentRule = parentRule;\n\t\t\t\t\t}\n\t\t\t\t\tstyleRule.parentStyleSheet = styleSheet;\n\t\t\t\t\tcurrentScope.cssRules.push(styleRule);\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tif (currentScope.constructor === CSSOM.CSSKeyframesRule) {\n\t\t\t\t\t\tstate = \"keyframeRule-begin\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstate = \"before-selector\";\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"keyframeRule-begin\":\n\t\t\t\tcase \"before-selector\":\n\t\t\t\tcase \"selector\":\n\t\t\t\t\t// End of media/document rule.\n\t\t\t\t\tif (!parentRule) {\n\t\t\t\t\t\tparseError(\"Unexpected }\");\n\t\t\t\t\t}\n\t\t\t\t\tcurrentScope.__ends = i + 1;\n\t\t\t\t\t// Nesting rules aren't supported yet\n\t\t\t\t\tstyleSheet.cssRules.push(currentScope);\n\t\t\t\t\tcurrentScope = styleSheet;\n\t\t\t\t\tparentRule = null;\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tstate = \"before-selector\";\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tswitch (state) {\n\t\t\t\tcase \"before-selector\":\n\t\t\t\t\tstate = \"selector\";\n\t\t\t\t\tstyleRule = new CSSOM.CSSStyleRule();\n\t\t\t\t\tstyleRule.__starts = i;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"before-name\":\n\t\t\t\t\tstate = \"name\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"before-value\":\n\t\t\t\t\tstate = \"value\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"importRule-begin\":\n\t\t\t\t\tstate = \"importRule\";\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbuffer += character;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn styleSheet;\n};\n\n\n//.CommonJS\nexports.parse = CSSOM.parse;\n// The following modules cannot be included sooner due to the mutual dependency with parse.js\nCSSOM.CSSStyleSheet = require(\"./CSSStyleSheet\").CSSStyleSheet;\nCSSOM.CSSStyleRule = require(\"./CSSStyleRule\").CSSStyleRule;\nCSSOM.CSSImportRule = require(\"./CSSImportRule\").CSSImportRule;\nCSSOM.CSSMediaRule = require(\"./CSSMediaRule\").CSSMediaRule;\nCSSOM.CSSFontFaceRule = require(\"./CSSFontFaceRule\").CSSFontFaceRule;\nCSSOM.CSSHostRule = require(\"./CSSHostRule\").CSSHostRule;\nCSSOM.CSSStyleDeclaration = require('./CSSStyleDeclaration').CSSStyleDeclaration;\nCSSOM.CSSKeyframeRule = require('./CSSKeyframeRule').CSSKeyframeRule;\nCSSOM.CSSKeyframesRule = require('./CSSKeyframesRule').CSSKeyframesRule;\nCSSOM.CSSValueExpression = require('./CSSValueExpression').CSSValueExpression;\nCSSOM.CSSDocumentRule = require('./CSSDocumentRule').CSSDocumentRule;\n///CommonJS\n\n},{\"./CSSDocumentRule\":9,\"./CSSFontFaceRule\":10,\"./CSSHostRule\":11,\"./CSSImportRule\":12,\"./CSSKeyframeRule\":13,\"./CSSKeyframesRule\":14,\"./CSSMediaRule\":15,\"./CSSStyleDeclaration\":17,\"./CSSStyleRule\":18,\"./CSSStyleSheet\":19,\"./CSSValueExpression\":21}],28:[function(require,module,exports){\n// Simple, stupid \"background\"/\"background-image\" value parser that just aims at exposing the image URLs\n\"use strict\";\n\nvar cssSupport = require('./cssSupport');\n\n\nvar trimCSSWhitespace = function (url) {\n    var whitespaceRegex = /^[\\t\\r\\f\\n ]*(.+?)[\\t\\r\\f\\n ]*$/;\n\n    return url.replace(whitespaceRegex, \"$1\");\n};\n\n// TODO exporting this for the sake of unit testing. Should rather test the background value parser explicitly.\nexports.extractCssUrl = function (cssUrl) {\n    var urlRegex = /^url\\(([^\\)]+)\\)/,\n        quotedUrl;\n\n    if (!urlRegex.test(cssUrl)) {\n        throw new Error(\"Invalid url\");\n    }\n\n    quotedUrl = urlRegex.exec(cssUrl)[1];\n    return cssSupport.unquoteString(trimCSSWhitespace(quotedUrl));\n};\n\nvar sliceBackgroundDeclaration = function (backgroundDeclarationText) {\n    var functionParamRegexS = \"\\\\s*(?:\\\"[^\\\"]*\\\"|'[^']*'|[^\\\\(]+)\\\\s*\",\n        valueRegexS = \"(\" + \"url\\\\(\" + functionParamRegexS + \"\\\\)\" + \"|\" + \"[^,\\\\s]+\" + \")\",\n        simpleSingularBackgroundRegexS = \"(?:\\\\s*\" + valueRegexS + \")+\",\n        simpleBackgroundRegexS = \"^\\\\s*(\" + simpleSingularBackgroundRegexS + \")\" +\n                                  \"(?:\\\\s*,\\\\s*(\" + simpleSingularBackgroundRegexS + \"))*\" +\n                                  \"\\\\s*$\",\n        simpleSingularBackgroundRegex = new RegExp(simpleSingularBackgroundRegexS, \"g\"),\n        outerRepeatedMatch,\n        backgroundLayers = [],\n        getValues = function (singularBackgroundDeclaration) {\n            var valueRegex = new RegExp(valueRegexS, \"g\"),\n                backgroundValues = [],\n                repeatedMatch;\n\n            repeatedMatch = valueRegex.exec(singularBackgroundDeclaration);\n            while (repeatedMatch) {\n                backgroundValues.push(repeatedMatch[1]);\n                repeatedMatch = valueRegex.exec(singularBackgroundDeclaration);\n            }\n            return backgroundValues;\n        };\n\n    if (backgroundDeclarationText.match(new RegExp(simpleBackgroundRegexS))) {\n        outerRepeatedMatch = simpleSingularBackgroundRegex.exec(backgroundDeclarationText);\n        while (outerRepeatedMatch) {\n            backgroundLayers.push(getValues(outerRepeatedMatch[0]));\n            outerRepeatedMatch = simpleSingularBackgroundRegex.exec(backgroundDeclarationText);\n        }\n\n        return backgroundLayers;\n    }\n    return [];\n};\n\nvar findBackgroundImageUrlInValues = function (values) {\n    var i, url;\n\n    for(i = 0; i < values.length; i++) {\n        try {\n            url = exports.extractCssUrl(values[i]);\n            return {\n                url: url,\n                idx: i\n            };\n        } catch (e) {}\n    }\n};\n\nexports.parse = function (backgroundValue) {\n    var backgroundLayers = sliceBackgroundDeclaration(backgroundValue);\n\n    return backgroundLayers.map(function (backgroundLayerValues) {\n        var urlMatch = findBackgroundImageUrlInValues(backgroundLayerValues);\n\n        if (urlMatch) {\n            return {\n                preUrl: backgroundLayerValues.slice(0, urlMatch.idx),\n                url: urlMatch.url,\n                postUrl: backgroundLayerValues.slice(urlMatch.idx+1),\n            };\n        } else {\n            return {\n                preUrl: backgroundLayerValues\n            };\n        }\n    });\n};\n\nexports.serialize = function (parsedBackground) {\n    var backgroundLayers = parsedBackground.map(function (backgroundLayer) {\n        var values = [].concat(backgroundLayer.preUrl);\n\n        if (backgroundLayer.url) {\n            values.push('url(\"' + backgroundLayer.url + '\")');\n        }\n        if (backgroundLayer.postUrl) {\n            values = values.concat(backgroundLayer.postUrl);\n        }\n\n        return values.join(' ');\n    });\n\n    return backgroundLayers.join(', ');\n};\n\n},{\"./cssSupport\":29}],29:[function(require,module,exports){\n\"use strict\";\n\nvar cssom;\n\ntry {\n  cssom = require('cssom');\n} catch (e) {\n}\n\n\nexports.unquoteString = function (quotedUrl) {\n    var doubleQuoteRegex = /^\"(.*)\"$/,\n        singleQuoteRegex = /^'(.*)'$/;\n\n    if (doubleQuoteRegex.test(quotedUrl)) {\n        return quotedUrl.replace(doubleQuoteRegex, \"$1\");\n    } else {\n        if (singleQuoteRegex.test(quotedUrl)) {\n            return quotedUrl.replace(singleQuoteRegex, \"$1\");\n        } else {\n            return quotedUrl;\n        }\n    }\n};\n\nvar rulesForCssTextFromBrowser = function (styleContent) {\n    var doc = document.implementation.createHTMLDocument(\"\"),\n        styleElement = document.createElement(\"style\"),\n        rules;\n\n    styleElement.textContent = styleContent;\n    // the style will only be parsed once it is added to a document\n    doc.body.appendChild(styleElement);\n    rules = styleElement.sheet.cssRules;\n\n    return Array.prototype.slice.call(rules);\n};\n\nvar browserHasBackgroundImageUrlIssue = (function () {\n    // Checks for http://code.google.com/p/chromium/issues/detail?id=161644\n    var rules = rulesForCssTextFromBrowser('a{background:url(i)}');\n    return !rules.length || rules[0].cssText.indexOf('url()') >= 0;\n}());\n\nvar browserHasFontFaceUrlIssue = (function () {\n    // Checks for https://bugs.chromium.org/p/chromium/issues/detail?id=588129\n    var rules = rulesForCssTextFromBrowser('@font-face { font-family: \"f\"; src: url(\"f\"); }');\n    return !rules.length || /url\\(['\"]*\\)/.test(rules[0].cssText);\n}());\n\nvar browserHasBackgroundImageUrlSetIssue = (function () {\n    // Checks for https://bugs.chromium.org/p/chromium/issues/detail?id=660663\n    var rules = rulesForCssTextFromBrowser('a{background:url(old)}');\n    rules[0].style.setProperty('background', 'url(new)', '');\n    return rules[0].style.getPropertyValue('background').indexOf('old') >= 0;\n}());\n\nexports.rulesForCssText = function (styleContent) {\n    if ((browserHasBackgroundImageUrlIssue || browserHasFontFaceUrlIssue || browserHasBackgroundImageUrlSetIssue) && cssom && cssom.parse) {\n        return cssom.parse(styleContent).cssRules;\n    } else {\n        return rulesForCssTextFromBrowser(styleContent);\n    }\n};\n\nexports.cssRulesToText = function (cssRules) {\n    return cssRules.reduce(function (cssText, rule) {\n        return cssText + rule.cssText;\n    }, '');\n};\n\nexports.exchangeRule = function (cssRules, rule, newRuleText) {\n    var ruleIdx = cssRules.indexOf(rule);\n\n    // We create a new document and stylesheet to parse the rule,\n    // instead of relying on rule.parentStyleSheet, because\n    // rule.parentStyleSheet may be null\n    // (https://github.com/cburgmer/inlineresources/issues/3)\n    cssRules[ruleIdx] = exports.rulesForCssText(newRuleText)[0];\n};\n\n// Workaround for https://bugzilla.mozilla.org/show_bug.cgi?id=443978\nexports.changeFontFaceRuleSrc = function (cssRules, rule, newSrc) {\n    var newRuleText = '@font-face { font-family: ' + rule.style.getPropertyValue(\"font-family\") + '; ';\n\n    if (rule.style.getPropertyValue(\"font-style\")) {\n        newRuleText += 'font-style: ' + rule.style.getPropertyValue(\"font-style\") + '; ';\n    }\n\n    if (rule.style.getPropertyValue(\"font-weight\")) {\n        newRuleText += 'font-weight: ' + rule.style.getPropertyValue(\"font-weight\") + '; ';\n    }\n\n    newRuleText += 'src: ' + newSrc + '}';\n    exports.exchangeRule(cssRules, rule, newRuleText);\n};\n\n},{\"cssom\":26}],30:[function(require,module,exports){\n\"use strict\";\n\nvar util = require('./util'),\n    inlineImage = require('./inlineImage'),\n    inlineScript = require('./inlineScript'),\n    inlineCss = require('./inlineCss'),\n    cssSupport = require('./cssSupport');\n\n\nvar getUrlBasePath = function (url) {\n    return util.joinUrl(url, '.');\n};\n\nvar parameterHashFunction = function (params) {\n    // HACK JSON.stringify is poor man's hashing;\n    // same objects might not receive same result as key order is not guaranteed\n    var a = params.map(function (param, idx) {\n        // Only include options relevant for method\n        if (idx === (params.length - 1)) {\n            param = {\n                // Two different HTML pages on the same path level have the same base path, but a different URL\n                baseUrl: getUrlBasePath(param.baseUrl)\n            };\n        }\n        return JSON.stringify(param);\n    });\n    return a;\n};\n\nvar memoizeFunctionOnCaching = function (func, options) {\n    if ((options.cache !== false && options.cache !== 'none') && options.cacheBucket) {\n        return util.memoize(func, parameterHashFunction, options.cacheBucket);\n    } else {\n        return func;\n    }\n};\n\n/* Style inlining */\n\nvar requestExternalsForStylesheet = function (styleContent, alreadyLoadedCssUrls, options) {\n    var cssRules = cssSupport.rulesForCssText(styleContent);\n\n    return inlineCss.loadCSSImportsForRules(cssRules, alreadyLoadedCssUrls, options).then(function (cssImportResult) {\n        return inlineCss.loadAndInlineCSSResourcesForRules(cssRules, options).then(function (cssResourcesResult) {\n            var errors = cssImportResult.errors.concat(cssResourcesResult.errors),\n                hasChanges = cssImportResult.hasChanges || cssResourcesResult.hasChanges;\n\n            if (hasChanges) {\n                styleContent = cssSupport.cssRulesToText(cssRules);\n            }\n\n            return {\n                hasChanges: hasChanges,\n                content: styleContent,\n                errors: errors\n            };\n        });\n    });\n};\n\nvar loadAndInlineCssForStyle = function (style, options, alreadyLoadedCssUrls) {\n    var styleContent = style.textContent,\n        processExternals = memoizeFunctionOnCaching(requestExternalsForStylesheet, options);\n\n    return processExternals(styleContent, alreadyLoadedCssUrls, options).then(function (result) {\n        if (result.hasChanges) {\n            style.childNodes[0].nodeValue = result.content;\n        }\n\n        return util.cloneArray(result.errors);\n    });\n};\n\nvar getCssStyleElements = function (doc) {\n    var styles = doc.getElementsByTagName(\"style\");\n\n    return Array.prototype.filter.call(styles, function (style) {\n        return !style.attributes.type || style.attributes.type.value === \"text/css\";\n    });\n};\n\nexports.loadAndInlineStyles = function (doc, options) {\n    var styles = getCssStyleElements(doc),\n        allErrors = [],\n        alreadyLoadedCssUrls = [],\n        inlineOptions;\n\n    inlineOptions = util.clone(options);\n    inlineOptions.baseUrl = inlineOptions.baseUrl || util.getDocumentBaseUrl(doc);\n\n    return util.all(styles.map(function (style) {\n        return loadAndInlineCssForStyle(style, inlineOptions, alreadyLoadedCssUrls).then(function (errors) {\n            allErrors = allErrors.concat(errors);\n        });\n    })).then(function () {\n        return allErrors;\n    });\n};\n\n/* CSS link inlining */\n\nvar substituteLinkWithInlineStyle = function (oldLinkNode, styleContent) {\n    var parent = oldLinkNode.parentNode,\n        styleNode;\n\n    styleContent = styleContent.trim();\n    if (styleContent) {\n        styleNode = oldLinkNode.ownerDocument.createElement(\"style\");\n        styleNode.type = \"text/css\";\n        styleNode.appendChild(oldLinkNode.ownerDocument.createTextNode(styleContent));\n\n        parent.insertBefore(styleNode, oldLinkNode);\n    }\n\n    parent.removeChild(oldLinkNode);\n};\n\nvar requestStylesheetAndInlineResources = function (url, options) {\n    return util.ajax(url, options)\n        .then(function (content) {\n            var cssRules = cssSupport.rulesForCssText(content);\n\n            return {\n                content: content,\n                cssRules: cssRules\n            };\n        })\n        .then(function (result) {\n            var hasChangesFromPathAdjustment = inlineCss.adjustPathsOfCssResources(url, result.cssRules);\n\n            return {\n                content: result.content,\n                cssRules: result.cssRules,\n                hasChanges: hasChangesFromPathAdjustment\n            };\n        })\n        .then(function (result) {\n            return inlineCss.loadCSSImportsForRules(result.cssRules, [], options)\n                .then(function (cssImportResult) {\n                    return {\n                        content: result.content,\n                        cssRules: result.cssRules,\n                        hasChanges: result.hasChanges || cssImportResult.hasChanges,\n                        errors: cssImportResult.errors\n                    };\n                });\n        })\n        .then(function (result) {\n            return inlineCss.loadAndInlineCSSResourcesForRules(result.cssRules, options)\n                .then(function (cssResourcesResult) {\n                    return {\n                        content: result.content,\n                        cssRules: result.cssRules,\n                        hasChanges: result.hasChanges || cssResourcesResult.hasChanges,\n                        errors: result.errors.concat(cssResourcesResult.errors)\n                    };\n                });\n        })\n        .then(function (result) {\n            var content = result.content;\n            if (result.hasChanges) {\n                content = cssSupport.cssRulesToText(result.cssRules);\n            }\n            return {\n                content: content,\n                errors: result.errors\n            };\n        });\n};\n\nvar loadLinkedCSS = function (link, options) {\n    var cssHref = link.attributes.href.value,\n        documentBaseUrl = util.getDocumentBaseUrl(link.ownerDocument),\n        ajaxOptions = util.clone(options);\n\n    if (!ajaxOptions.baseUrl && documentBaseUrl) {\n        ajaxOptions.baseUrl = documentBaseUrl;\n    }\n\n    var processStylesheet = memoizeFunctionOnCaching(requestStylesheetAndInlineResources, options);\n\n    return processStylesheet(cssHref, ajaxOptions).then(function (result) {\n        return {\n            content: result.content,\n            errors: util.cloneArray(result.errors)\n        };\n    });\n};\n\nvar getCssStylesheetLinks = function (doc) {\n    var links = doc.getElementsByTagName(\"link\");\n\n    return Array.prototype.filter.call(links, function (link) {\n        return link.attributes.rel && link.attributes.rel.value === \"stylesheet\" &&\n            (!link.attributes.type || link.attributes.type.value === \"text/css\");\n    });\n};\n\nexports.loadAndInlineCssLinks = function (doc, options) {\n    var links = getCssStylesheetLinks(doc),\n        errors = [];\n\n    return util.all(links.map(function (link) {\n        return loadLinkedCSS(link, options).then(function(result) {\n            substituteLinkWithInlineStyle(link, result.content + \"\\n\");\n\n            errors = errors.concat(result.errors);\n        }, function (e) {\n            errors.push({\n                resourceType: \"stylesheet\",\n                url: e.url,\n                msg: \"Unable to load stylesheet \" + e.url\n            });\n        });\n    })).then(function () {\n        return errors;\n    });\n};\n\n/* Main */\n\nexports.loadAndInlineImages = inlineImage.inline;\nexports.loadAndInlineScript = inlineScript.inline;\n\nexports.inlineReferences = function (doc, options) {\n    var allErrors = [],\n        inlineFuncs = [\n            exports.loadAndInlineImages,\n            exports.loadAndInlineStyles,\n            exports.loadAndInlineCssLinks];\n\n    if (options.inlineScripts !== false) {\n        inlineFuncs.push(exports.loadAndInlineScript);\n    }\n\n    return util.all(inlineFuncs.map(function (func) {\n        return func(doc, options)\n            .then(function (errors) {\n                allErrors = allErrors.concat(errors);\n            });\n    })).then(function () {\n        return allErrors;\n    });\n};\n\n},{\"./cssSupport\":29,\"./inlineCss\":31,\"./inlineImage\":32,\"./inlineScript\":33,\"./util\":34}],31:[function(require,module,exports){\n\"use strict\";\n\nvar ayepromise = require('ayepromise'),\n    util = require('./util'),\n    cssSupport = require('./cssSupport'),\n    backgroundValueParser = require('./backgroundValueParser'),\n    fontFaceSrcValueParser = require('css-font-face-src');\n\n\nvar updateCssPropertyValue = function (rule, property, value) {\n    rule.style.setProperty(property, value, rule.style.getPropertyPriority(property));\n};\n\nvar findBackgroundImageRules = function (cssRules) {\n    return cssRules.filter(function (rule) {\n        return rule.type === window.CSSRule.STYLE_RULE && (rule.style.getPropertyValue('background-image') || rule.style.getPropertyValue('background'));\n    });\n};\n\nvar findBackgroundDeclarations = function (rules) {\n    var backgroundDeclarations = [];\n\n    rules.forEach(function (rule) {\n        if (rule.style.getPropertyValue('background-image')) {\n            backgroundDeclarations.push({\n                property: 'background-image',\n                value: rule.style.getPropertyValue('background-image'),\n                rule: rule\n            });\n        } else if (rule.style.getPropertyValue('background')) {\n            backgroundDeclarations.push({\n                property: 'background',\n                value: rule.style.getPropertyValue('background'),\n                rule: rule\n            });\n        }\n    });\n\n    return backgroundDeclarations;\n};\n\nvar findFontFaceRules = function (cssRules) {\n    return cssRules.filter(function (rule) {\n        return rule.type === window.CSSRule.FONT_FACE_RULE && rule.style.getPropertyValue(\"src\");\n    });\n};\n\nvar findCSSImportRules = function (cssRules) {\n    return cssRules.filter(function (rule) {\n        return rule.type === window.CSSRule.IMPORT_RULE && rule.href;\n    });\n};\n\nvar findExternalBackgroundUrls = function (parsedBackground) {\n    var matchIndices = [];\n\n    parsedBackground.forEach(function (backgroundLayer, i) {\n        if (backgroundLayer.url && !util.isDataUri(backgroundLayer.url)) {\n            matchIndices.push(i);\n        }\n    });\n\n    return matchIndices;\n};\n\nvar findExternalFontFaceUrls = function (parsedFontFaceSources) {\n    var sourceIndices = [];\n    parsedFontFaceSources.forEach(function (sourceItem, i) {\n        if (sourceItem.url && !util.isDataUri(sourceItem.url)) {\n            sourceIndices.push(i);\n        }\n    });\n    return sourceIndices;\n};\n\nexports.adjustPathsOfCssResources = function (baseUrl, cssRules) {\n    var backgroundRules = findBackgroundImageRules(cssRules),\n        backgroundDeclarations = findBackgroundDeclarations(backgroundRules),\n        change = false;\n\n    backgroundDeclarations.forEach(function (declaration) {\n        var parsedBackground = backgroundValueParser.parse(declaration.value),\n            externalBackgroundIndices = findExternalBackgroundUrls(parsedBackground),\n            backgroundValue;\n\n        if (externalBackgroundIndices.length > 0) {\n            externalBackgroundIndices.forEach(function (backgroundLayerIndex) {\n                var relativeUrl = parsedBackground[backgroundLayerIndex].url,\n                    url = util.joinUrl(baseUrl, relativeUrl);\n                parsedBackground[backgroundLayerIndex].url = url;\n            });\n\n            backgroundValue = backgroundValueParser.serialize(parsedBackground);\n\n            updateCssPropertyValue(declaration.rule, declaration.property, backgroundValue);\n\n            change = true;\n        }\n    });\n    findFontFaceRules(cssRules).forEach(function (rule) {\n        var fontFaceSrcDeclaration = rule.style.getPropertyValue(\"src\"),\n            parsedFontFaceSources, externalFontFaceUrlIndices;\n\n        try {\n            parsedFontFaceSources = fontFaceSrcValueParser.parse(fontFaceSrcDeclaration);\n        } catch (e) {\n            return;\n        }\n        externalFontFaceUrlIndices = findExternalFontFaceUrls(parsedFontFaceSources);\n\n        if (externalFontFaceUrlIndices.length > 0) {\n            externalFontFaceUrlIndices.forEach(function (fontFaceUrlIndex) {\n                var relativeUrl = parsedFontFaceSources[fontFaceUrlIndex].url,\n                    url = util.joinUrl(baseUrl, relativeUrl);\n\n                parsedFontFaceSources[fontFaceUrlIndex].url = url;\n            });\n\n            cssSupport.changeFontFaceRuleSrc(cssRules, rule, fontFaceSrcValueParser.serialize(parsedFontFaceSources));\n\n            change = true;\n        }\n    });\n    findCSSImportRules(cssRules).forEach(function (rule) {\n        var cssUrl = rule.href,\n            url = util.joinUrl(baseUrl, cssUrl);\n\n        cssSupport.exchangeRule(cssRules, rule, \"@import url(\" + url + \");\");\n\n        change = true;\n    });\n\n    return change;\n};\n\n/* CSS import inlining */\n\nvar substituteRule = function (cssRules, rule, newCssRules) {\n    var position = cssRules.indexOf(rule);\n\n    cssRules.splice(position, 1);\n\n    newCssRules.forEach(function (newRule, i) {\n        cssRules.splice(position + i, 0, newRule);\n    });\n};\n\nvar fulfilledPromise = function (value) {\n    var defer = ayepromise.defer();\n    defer.resolve(value);\n    return defer.promise;\n};\n\nvar loadAndInlineCSSImport = function (cssRules, rule, alreadyLoadedCssUrls, options) {\n    var url = rule.href,\n        cssHrefRelativeToDoc;\n\n    url = cssSupport.unquoteString(url);\n\n    cssHrefRelativeToDoc = util.joinUrl(options.baseUrl, url);\n\n    if (alreadyLoadedCssUrls.indexOf(cssHrefRelativeToDoc) >= 0) {\n        // Remove URL by adding empty string\n        substituteRule(cssRules, rule, []);\n        return fulfilledPromise([]);\n    } else {\n        alreadyLoadedCssUrls.push(cssHrefRelativeToDoc);\n    }\n\n    return util.ajax(url, options)\n        .then(function (cssText) {\n            var externalCssRules = cssSupport.rulesForCssText(cssText);\n\n            // Recursively follow @import statements\n            return exports.loadCSSImportsForRules(externalCssRules, alreadyLoadedCssUrls, options)\n                .then(function (result) {\n                    exports.adjustPathsOfCssResources(url, externalCssRules);\n\n                    substituteRule(cssRules, rule, externalCssRules);\n\n                    return result.errors;\n                });\n        }, function (e) {\n            throw {\n                resourceType: \"stylesheet\",\n                url: e.url,\n                msg: \"Unable to load stylesheet \" + e.url\n            };\n        });\n};\n\nexports.loadCSSImportsForRules = function (cssRules, alreadyLoadedCssUrls, options) {\n    var rulesToInline = findCSSImportRules(cssRules),\n        errors = [],\n        hasChanges = false;\n\n    return util.all(rulesToInline.map(function (rule) {\n        return loadAndInlineCSSImport(cssRules, rule, alreadyLoadedCssUrls, options).then(function (moreErrors) {\n            errors = errors.concat(moreErrors);\n\n            hasChanges = true;\n        }, function (e) {\n            errors.push(e);\n        });\n    })).then(function () {\n        return {\n            hasChanges: hasChanges,\n            errors: errors\n        };\n    });\n};\n\n/* CSS linked resource inlining */\n\nvar loadAndInlineBackgroundImages = function (backgroundValue, options) {\n    var parsedBackground = backgroundValueParser.parse(backgroundValue),\n        externalBackgroundLayerIndices = findExternalBackgroundUrls(parsedBackground),\n        hasChanges = false;\n\n    return util.collectAndReportErrors(externalBackgroundLayerIndices.map(function (backgroundLayerIndex) {\n        var url = parsedBackground[backgroundLayerIndex].url;\n\n        return util.getDataURIForImageURL(url, options)\n            .then(function (dataURI) {\n                parsedBackground[backgroundLayerIndex].url = dataURI;\n\n                hasChanges = true;\n            }, function (e) {\n                throw {\n                    resourceType: \"backgroundImage\",\n                    url: e.url,\n                    msg: \"Unable to load background-image \" + e.url\n                };\n            });\n    })).then(function (errors) {\n        return {\n            backgroundValue: backgroundValueParser.serialize(parsedBackground),\n            hasChanges: hasChanges,\n            errors: errors\n        };\n    });\n};\n\nvar iterateOverRulesAndInlineBackgroundImages = function (cssRules, options) {\n    var rulesToInline = findBackgroundImageRules(cssRules),\n        backgroundDeclarations = findBackgroundDeclarations(rulesToInline),\n        errors = [],\n        cssHasChanges = false;\n\n    return util.all(backgroundDeclarations.map(function (declaration) {\n        return loadAndInlineBackgroundImages(declaration.value, options)\n            .then(function (result) {\n                if (result.hasChanges) {\n                    updateCssPropertyValue(declaration.rule, declaration.property, result.backgroundValue);\n\n                    cssHasChanges = true;\n                }\n\n                errors = errors.concat(result.errors);\n            });\n    })).then(function () {\n        return {\n            hasChanges: cssHasChanges,\n            errors: errors\n        };\n    });\n};\n\nvar loadAndInlineFontFace = function (srcDeclarationValue, options) {\n    var hasChanges = false,\n        parsedFontFaceSources, externalFontFaceUrlIndices;\n\n    try {\n        parsedFontFaceSources = fontFaceSrcValueParser.parse(srcDeclarationValue);\n    } catch (e) {\n        parsedFontFaceSources = [];\n    }\n    externalFontFaceUrlIndices = findExternalFontFaceUrls(parsedFontFaceSources);\n\n    return util.collectAndReportErrors(externalFontFaceUrlIndices.map(function (urlIndex) {\n        var fontSrc = parsedFontFaceSources[urlIndex],\n            format = fontSrc.format || \"woff\";\n\n        return util.binaryAjax(fontSrc.url, options)\n            .then(function (content) {\n                var base64Content = btoa(content);\n                fontSrc.url = 'data:font/' + format + ';base64,' + base64Content;\n\n                hasChanges = true;\n            }, function (e) {\n                throw {\n                    resourceType: \"fontFace\",\n                    url: e.url,\n                    msg: \"Unable to load font-face \" + e.url\n                };\n            });\n    })).then(function (errors) {\n        return {\n            srcDeclarationValue: fontFaceSrcValueParser.serialize(parsedFontFaceSources),\n            hasChanges: hasChanges,\n            errors: errors\n        };\n    });\n};\n\nvar iterateOverRulesAndInlineFontFace = function (cssRules, options) {\n    var rulesToInline = findFontFaceRules(cssRules),\n        errors = [],\n        hasChanges = false;\n\n    return util.all(rulesToInline.map(function (rule) {\n        var srcDeclarationValue = rule.style.getPropertyValue(\"src\");\n\n        return loadAndInlineFontFace(srcDeclarationValue, options).then(function (result) {\n            if (result.hasChanges) {\n                cssSupport.changeFontFaceRuleSrc(cssRules, rule, result.srcDeclarationValue);\n\n                hasChanges = true;\n            }\n\n            errors = errors.concat(result.errors);\n        });\n    })).then(function () {\n        return {\n            hasChanges: hasChanges,\n            errors: errors\n        };\n    });\n};\n\nexports.loadAndInlineCSSResourcesForRules = function (cssRules, options) {\n    var hasChanges = false,\n        errors = [];\n\n    return util.all([iterateOverRulesAndInlineBackgroundImages, iterateOverRulesAndInlineFontFace].map(function (func) {\n        return func(cssRules, options)\n            .then(function (result) {\n                hasChanges = hasChanges || result.hasChanges;\n                errors = errors.concat(result.errors);\n            });\n    })).then(function () {\n        return {\n            hasChanges: hasChanges,\n            errors: errors\n        };\n    });\n};\n\n},{\"./backgroundValueParser\":28,\"./cssSupport\":29,\"./util\":34,\"ayepromise\":2,\"css-font-face-src\":6}],32:[function(require,module,exports){\n\"use strict\";\n\nvar util = require('./util');\n\n\nvar encodeImageAsDataURI = function (image, options) {\n    var url = null;\n    if(image.hasAttribute('src')){\n        url = image.getAttribute('src');\n    }\n    else if(image.hasAttributeNS('http://www.w3.org/1999/xlink','href')){\n        url = image.getAttributeNS('http://www.w3.org/1999/xlink','href');\n    }\n    else if(image.hasAttribute('href')){\n        url = image.getAttribute('href');\n    }\n    var documentBase = util.getDocumentBaseUrl(image.ownerDocument),\n        ajaxOptions = util.clone(options);\n\n    if (!ajaxOptions.baseUrl && documentBase) {\n        ajaxOptions.baseUrl = documentBase;\n    }\n\n    return util.getDataURIForImageURL(url, ajaxOptions)\n        .then(function (dataURI) {\n            return dataURI;\n        }, function (e) {\n            throw {\n                resourceType: \"image\",\n                url: e.url,\n                msg: \"Unable to load image \" + e.url\n            };\n        });\n};\n\nvar filterExternalImages = function (images) {\n    return images.filter(function (image) {\n        var url = null;\n        if(image.hasAttribute('src')){\n            url = image.getAttribute('src');\n        }\n        else if(image.hasAttributeNS('http://www.w3.org/1999/xlink','href')){\n            url = image.getAttributeNS('http://www.w3.org/1999/xlink','href');\n        }\n        else if(image.hasAttribute('href')){\n            url = image.getAttribute('href');\n        }\n\n        return url !== null && !util.isDataUri(url);\n    });\n};\n\nvar filterInputsForImageType = function (inputs) {\n    return Array.prototype.filter.call(inputs, function (input) {\n        return input.type === \"image\";\n    });\n};\n\nvar toArray = function (arrayLike) {\n    return Array.prototype.slice.call(arrayLike);\n};\n\nexports.inline = function (doc, options) {\n    var images = toArray(doc.getElementsByTagName(\"img\")),\n        svgImages = toArray(doc.getElementsByTagName(\"image\")),\n        imageInputs = filterInputsForImageType(doc.getElementsByTagName(\"input\"));\n\n    images = images.concat(svgImages);\n    images = images.concat(imageInputs);\n    var externalImages = filterExternalImages(images);\n\n    return util.collectAndReportErrors(externalImages.map(function (image) {\n        return encodeImageAsDataURI(image, options).then(function (dataURI) {\n            if(!!image.attributes.src){\n                image.attributes.src.value = dataURI;\n            }\n            else if(!!image.attributes['xlink:href']){\n                image.attributes['xlink:href'].value = dataURI;\n            }\n            else if(!!image.attributes.href){\n                image.attributes.href.value = dataURI;\n            }\n        });\n    }));\n};\n\n},{\"./util\":34}],33:[function(require,module,exports){\n\"use strict\";\n\nvar util = require('./util');\n\n\nvar loadLinkedScript = function (script, options) {\n    var src = script.attributes.src.value,\n        documentBase = util.getDocumentBaseUrl(script.ownerDocument),\n        ajaxOptions = util.clone(options);\n\n    if (!ajaxOptions.baseUrl && documentBase) {\n        ajaxOptions.baseUrl = documentBase;\n    }\n\n    return util.ajax(src, ajaxOptions)\n        .fail(function (e) {\n            throw {\n                resourceType: \"script\",\n                url: e.url,\n                msg: \"Unable to load script \" + e.url\n            };\n        });\n};\n\nvar escapeClosingTags = function (text) {\n    // http://stackoverflow.com/questions/9246382/escaping-script-tag-inside-javascript\n    return text.replace(/<\\//g, '<\\\\/');\n};\n\nvar substituteExternalScriptWithInline = function (scriptNode, jsCode) {\n    scriptNode.attributes.removeNamedItem('src');\n    scriptNode.textContent = escapeClosingTags(jsCode);\n};\n\nvar getScripts = function (doc) {\n    var scripts = doc.getElementsByTagName(\"script\");\n\n    return Array.prototype.filter.call(scripts, function (script) {\n        return !!script.attributes.src;\n    });\n};\n\nexports.inline = function (doc, options) {\n    var scripts = getScripts(doc);\n\n    return util.collectAndReportErrors(scripts.map(function (script) {\n        return loadLinkedScript(script, options).then(function (jsCode) {\n            substituteExternalScriptWithInline(script, jsCode);\n        });\n    }));\n};\n\n},{\"./util\":34}],34:[function(require,module,exports){\n\"use strict\";\n\nvar url = require('url'),\n    ayepromise = require('ayepromise');\n\n\nexports.getDocumentBaseUrl = function (doc) {\n    if (doc.baseURI !== 'about:blank') {\n        return doc.baseURI;\n    }\n\n    return null;\n};\n\nexports.clone = function (object) {\n    var theClone = {},\n        i;\n    for (i in object) {\n        if (object.hasOwnProperty(i)) {\n           theClone[i] = object[i];\n        }\n    }\n    return theClone;\n};\n\nexports.cloneArray = function (nodeList) {\n    return Array.prototype.slice.apply(nodeList, [0]);\n};\n\nexports.joinUrl = function (baseUrl, relUrl) {\n    if (!baseUrl) {\n        return relUrl;\n    }\n    return url.resolve(baseUrl, relUrl);\n};\n\nexports.isDataUri = function (url) {\n    return (/^data:/).test(url);\n};\n\nexports.all = function (promises) {\n    var defer = ayepromise.defer(),\n        pendingPromiseCount = promises.length,\n        resolvedValues = [];\n\n    if (promises.length === 0) {\n        defer.resolve([]);\n        return defer.promise;\n    }\n\n    promises.forEach(function (promise, idx) {\n        promise.then(function (value) {\n            pendingPromiseCount -= 1;\n            resolvedValues[idx] = value;\n\n            if (pendingPromiseCount === 0) {\n                defer.resolve(resolvedValues);\n            }\n        }, function (e) {\n            defer.reject(e);\n        });\n    });\n    return defer.promise;\n};\n\nexports.collectAndReportErrors = function (promises) {\n    var errors = [];\n\n    return exports.all(promises.map(function (promise) {\n        return promise.fail(function (e) {\n            errors.push(e);\n        });\n    })).then(function () {\n        return errors;\n    });\n};\n\nvar lastCacheDate = null;\n\nvar getUncachableURL = function (url, cache) {\n    if (cache === false || cache === 'none' || cache === 'repeated') {\n        if (lastCacheDate === null || cache !== 'repeated') {\n            lastCacheDate = Date.now();\n        }\n        return url + \"?_=\" + lastCacheDate;\n    } else {\n        return url;\n    }\n};\n\nexports.ajax = function (url, options) {\n    var ajaxRequest = new window.XMLHttpRequest(),\n        defer = ayepromise.defer(),\n        joinedUrl = exports.joinUrl(options.baseUrl, url),\n        augmentedUrl;\n\n    var doReject = function () {\n        defer.reject({\n            msg: 'Unable to load url',\n            url: joinedUrl\n        });\n    };\n\n    augmentedUrl = getUncachableURL(joinedUrl, options.cache);\n\n    ajaxRequest.addEventListener(\"load\", function () {\n        if (ajaxRequest.status === 200 || ajaxRequest.status === 0) {\n            defer.resolve(ajaxRequest.response);\n        } else {\n            doReject();\n        }\n    }, false);\n\n    ajaxRequest.addEventListener(\"error\", doReject, false);\n\n    try {\n        ajaxRequest.open('GET', augmentedUrl, true);\n        ajaxRequest.overrideMimeType(options.mimeType);\n        ajaxRequest.send(null);\n    } catch (e) {\n        doReject();\n    }\n\n    return defer.promise;\n};\n\nexports.binaryAjax = function (url, options) {\n    var ajaxOptions = exports.clone(options);\n\n    ajaxOptions.mimeType = 'text/plain; charset=x-user-defined';\n\n    return exports.ajax(url, ajaxOptions)\n        .then(function (content) {\n            var binaryContent = \"\";\n\n            for (var i = 0; i < content.length; i++) {\n                binaryContent += String.fromCharCode(content.charCodeAt(i) & 0xFF);\n            }\n\n            return binaryContent;\n        });\n};\n\nvar detectMimeType = function (content) {\n    var startsWith = function (string, substring) {\n        return string.substring(0, substring.length) === substring;\n    };\n\n    if (startsWith(content, '<?xml') || startsWith(content, '<svg')) {\n        return 'image/svg+xml';\n    }\n    return 'image/png';\n};\n\nexports.getDataURIForImageURL = function (url, options) {\n    return exports.binaryAjax(url, options)\n        .then(function (content) {\n            var base64Content = btoa(content),\n                mimeType = detectMimeType(content);\n\n            return 'data:' + mimeType + ';base64,' + base64Content;\n        });\n};\n\nvar uniqueIdList = [];\n\nvar constantUniqueIdFor = function (element) {\n    // HACK, using a list results in O(n), but how do we hash a function?\n    if (uniqueIdList.indexOf(element) < 0) {\n        uniqueIdList.push(element);\n    }\n    return uniqueIdList.indexOf(element);\n};\n\nexports.memoize = function (func, hasher, memo) {\n    if (typeof memo !== \"object\") {\n        throw new Error(\"cacheBucket is not an object\");\n    }\n\n    return function () {\n        var args = Array.prototype.slice.call(arguments);\n\n        var argumentHash = hasher(args),\n            funcHash = constantUniqueIdFor(func),\n            retValue;\n\n        if (memo[funcHash] && memo[funcHash][argumentHash]) {\n            return memo[funcHash][argumentHash];\n        } else {\n            retValue = func.apply(null, args);\n\n            memo[funcHash] = memo[funcHash] || {};\n            memo[funcHash][argumentHash] = retValue;\n\n            return retValue;\n        }\n    };\n};\n\n},{\"ayepromise\":2,\"url\":3}],35:[function(require,module,exports){\n(function (global){\n/*! https://mths.be/punycode v1.3.2 by @mathias */\n;(function(root) {\n\n\t/** Detect free variables */\n\tvar freeExports = typeof exports == 'object' && exports &&\n\t\t!exports.nodeType && exports;\n\tvar freeModule = typeof module == 'object' && module &&\n\t\t!module.nodeType && module;\n\tvar freeGlobal = typeof global == 'object' && global;\n\tif (\n\t\tfreeGlobal.global === freeGlobal ||\n\t\tfreeGlobal.window === freeGlobal ||\n\t\tfreeGlobal.self === freeGlobal\n\t) {\n\t\troot = freeGlobal;\n\t}\n\n\t/**\n\t * The `punycode` object.\n\t * @name punycode\n\t * @type Object\n\t */\n\tvar punycode,\n\n\t/** Highest positive signed 32-bit float value */\n\tmaxInt = 2147483647, // aka. 0x7FFFFFFF or 2^31-1\n\n\t/** Bootstring parameters */\n\tbase = 36,\n\ttMin = 1,\n\ttMax = 26,\n\tskew = 38,\n\tdamp = 700,\n\tinitialBias = 72,\n\tinitialN = 128, // 0x80\n\tdelimiter = '-', // '\\x2D'\n\n\t/** Regular expressions */\n\tregexPunycode = /^xn--/,\n\tregexNonASCII = /[^\\x20-\\x7E]/, // unprintable ASCII chars + non-ASCII chars\n\tregexSeparators = /[\\x2E\\u3002\\uFF0E\\uFF61]/g, // RFC 3490 separators\n\n\t/** Error messages */\n\terrors = {\n\t\t'overflow': 'Overflow: input needs wider integers to process',\n\t\t'not-basic': 'Illegal input >= 0x80 (not a basic code point)',\n\t\t'invalid-input': 'Invalid input'\n\t},\n\n\t/** Convenience shortcuts */\n\tbaseMinusTMin = base - tMin,\n\tfloor = Math.floor,\n\tstringFromCharCode = String.fromCharCode,\n\n\t/** Temporary variable */\n\tkey;\n\n\t/*--------------------------------------------------------------------------*/\n\n\t/**\n\t * A generic error utility function.\n\t * @private\n\t * @param {String} type The error type.\n\t * @returns {Error} Throws a `RangeError` with the applicable error message.\n\t */\n\tfunction error(type) {\n\t\tthrow RangeError(errors[type]);\n\t}\n\n\t/**\n\t * A generic `Array#map` utility function.\n\t * @private\n\t * @param {Array} array The array to iterate over.\n\t * @param {Function} callback The function that gets called for every array\n\t * item.\n\t * @returns {Array} A new array of values returned by the callback function.\n\t */\n\tfunction map(array, fn) {\n\t\tvar length = array.length;\n\t\tvar result = [];\n\t\twhile (length--) {\n\t\t\tresult[length] = fn(array[length]);\n\t\t}\n\t\treturn result;\n\t}\n\n\t/**\n\t * A simple `Array#map`-like wrapper to work with domain name strings or email\n\t * addresses.\n\t * @private\n\t * @param {String} domain The domain name or email address.\n\t * @param {Function} callback The function that gets called for every\n\t * character.\n\t * @returns {Array} A new string of characters returned by the callback\n\t * function.\n\t */\n\tfunction mapDomain(string, fn) {\n\t\tvar parts = string.split('@');\n\t\tvar result = '';\n\t\tif (parts.length > 1) {\n\t\t\t// In email addresses, only the domain name should be punycoded. Leave\n\t\t\t// the local part (i.e. everything up to `@`) intact.\n\t\t\tresult = parts[0] + '@';\n\t\t\tstring = parts[1];\n\t\t}\n\t\t// Avoid `split(regex)` for IE8 compatibility. See #17.\n\t\tstring = string.replace(regexSeparators, '\\x2E');\n\t\tvar labels = string.split('.');\n\t\tvar encoded = map(labels, fn).join('.');\n\t\treturn result + encoded;\n\t}\n\n\t/**\n\t * Creates an array containing the numeric code points of each Unicode\n\t * character in the string. While JavaScript uses UCS-2 internally,\n\t * this function will convert a pair of surrogate halves (each of which\n\t * UCS-2 exposes as separate characters) into a single code point,\n\t * matching UTF-16.\n\t * @see `punycode.ucs2.encode`\n\t * @see <https://mathiasbynens.be/notes/javascript-encoding>\n\t * @memberOf punycode.ucs2\n\t * @name decode\n\t * @param {String} string The Unicode input string (UCS-2).\n\t * @returns {Array} The new array of code points.\n\t */\n\tfunction ucs2decode(string) {\n\t\tvar output = [],\n\t\t    counter = 0,\n\t\t    length = string.length,\n\t\t    value,\n\t\t    extra;\n\t\twhile (counter < length) {\n\t\t\tvalue = string.charCodeAt(counter++);\n\t\t\tif (value >= 0xD800 && value <= 0xDBFF && counter < length) {\n\t\t\t\t// high surrogate, and there is a next character\n\t\t\t\textra = string.charCodeAt(counter++);\n\t\t\t\tif ((extra & 0xFC00) == 0xDC00) { // low surrogate\n\t\t\t\t\toutput.push(((value & 0x3FF) << 10) + (extra & 0x3FF) + 0x10000);\n\t\t\t\t} else {\n\t\t\t\t\t// unmatched surrogate; only append this code unit, in case the next\n\t\t\t\t\t// code unit is the high surrogate of a surrogate pair\n\t\t\t\t\toutput.push(value);\n\t\t\t\t\tcounter--;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\toutput.push(value);\n\t\t\t}\n\t\t}\n\t\treturn output;\n\t}\n\n\t/**\n\t * Creates a string based on an array of numeric code points.\n\t * @see `punycode.ucs2.decode`\n\t * @memberOf punycode.ucs2\n\t * @name encode\n\t * @param {Array} codePoints The array of numeric code points.\n\t * @returns {String} The new Unicode string (UCS-2).\n\t */\n\tfunction ucs2encode(array) {\n\t\treturn map(array, function(value) {\n\t\t\tvar output = '';\n\t\t\tif (value > 0xFFFF) {\n\t\t\t\tvalue -= 0x10000;\n\t\t\t\toutput += stringFromCharCode(value >>> 10 & 0x3FF | 0xD800);\n\t\t\t\tvalue = 0xDC00 | value & 0x3FF;\n\t\t\t}\n\t\t\toutput += stringFromCharCode(value);\n\t\t\treturn output;\n\t\t}).join('');\n\t}\n\n\t/**\n\t * Converts a basic code point into a digit/integer.\n\t * @see `digitToBasic()`\n\t * @private\n\t * @param {Number} codePoint The basic numeric code point value.\n\t * @returns {Number} The numeric value of a basic code point (for use in\n\t * representing integers) in the range `0` to `base - 1`, or `base` if\n\t * the code point does not represent a value.\n\t */\n\tfunction basicToDigit(codePoint) {\n\t\tif (codePoint - 48 < 10) {\n\t\t\treturn codePoint - 22;\n\t\t}\n\t\tif (codePoint - 65 < 26) {\n\t\t\treturn codePoint - 65;\n\t\t}\n\t\tif (codePoint - 97 < 26) {\n\t\t\treturn codePoint - 97;\n\t\t}\n\t\treturn base;\n\t}\n\n\t/**\n\t * Converts a digit/integer into a basic code point.\n\t * @see `basicToDigit()`\n\t * @private\n\t * @param {Number} digit The numeric value of a basic code point.\n\t * @returns {Number} The basic code point whose value (when used for\n\t * representing integers) is `digit`, which needs to be in the range\n\t * `0` to `base - 1`. If `flag` is non-zero, the uppercase form is\n\t * used; else, the lowercase form is used. The behavior is undefined\n\t * if `flag` is non-zero and `digit` has no uppercase form.\n\t */\n\tfunction digitToBasic(digit, flag) {\n\t\t//  0..25 map to ASCII a..z or A..Z\n\t\t// 26..35 map to ASCII 0..9\n\t\treturn digit + 22 + 75 * (digit < 26) - ((flag != 0) << 5);\n\t}\n\n\t/**\n\t * Bias adaptation function as per section 3.4 of RFC 3492.\n\t * http://tools.ietf.org/html/rfc3492#section-3.4\n\t * @private\n\t */\n\tfunction adapt(delta, numPoints, firstTime) {\n\t\tvar k = 0;\n\t\tdelta = firstTime ? floor(delta / damp) : delta >> 1;\n\t\tdelta += floor(delta / numPoints);\n\t\tfor (/* no initialization */; delta > baseMinusTMin * tMax >> 1; k += base) {\n\t\t\tdelta = floor(delta / baseMinusTMin);\n\t\t}\n\t\treturn floor(k + (baseMinusTMin + 1) * delta / (delta + skew));\n\t}\n\n\t/**\n\t * Converts a Punycode string of ASCII-only symbols to a string of Unicode\n\t * symbols.\n\t * @memberOf punycode\n\t * @param {String} input The Punycode string of ASCII-only symbols.\n\t * @returns {String} The resulting string of Unicode symbols.\n\t */\n\tfunction decode(input) {\n\t\t// Don't use UCS-2\n\t\tvar output = [],\n\t\t    inputLength = input.length,\n\t\t    out,\n\t\t    i = 0,\n\t\t    n = initialN,\n\t\t    bias = initialBias,\n\t\t    basic,\n\t\t    j,\n\t\t    index,\n\t\t    oldi,\n\t\t    w,\n\t\t    k,\n\t\t    digit,\n\t\t    t,\n\t\t    /** Cached calculation results */\n\t\t    baseMinusT;\n\n\t\t// Handle the basic code points: let `basic` be the number of input code\n\t\t// points before the last delimiter, or `0` if there is none, then copy\n\t\t// the first basic code points to the output.\n\n\t\tbasic = input.lastIndexOf(delimiter);\n\t\tif (basic < 0) {\n\t\t\tbasic = 0;\n\t\t}\n\n\t\tfor (j = 0; j < basic; ++j) {\n\t\t\t// if it's not a basic code point\n\t\t\tif (input.charCodeAt(j) >= 0x80) {\n\t\t\t\terror('not-basic');\n\t\t\t}\n\t\t\toutput.push(input.charCodeAt(j));\n\t\t}\n\n\t\t// Main decoding loop: start just after the last delimiter if any basic code\n\t\t// points were copied; start at the beginning otherwise.\n\n\t\tfor (index = basic > 0 ? basic + 1 : 0; index < inputLength; /* no final expression */) {\n\n\t\t\t// `index` is the index of the next character to be consumed.\n\t\t\t// Decode a generalized variable-length integer into `delta`,\n\t\t\t// which gets added to `i`. The overflow checking is easier\n\t\t\t// if we increase `i` as we go, then subtract off its starting\n\t\t\t// value at the end to obtain `delta`.\n\t\t\tfor (oldi = i, w = 1, k = base; /* no condition */; k += base) {\n\n\t\t\t\tif (index >= inputLength) {\n\t\t\t\t\terror('invalid-input');\n\t\t\t\t}\n\n\t\t\t\tdigit = basicToDigit(input.charCodeAt(index++));\n\n\t\t\t\tif (digit >= base || digit > floor((maxInt - i) / w)) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\ti += digit * w;\n\t\t\t\tt = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\n\t\t\t\tif (digit < t) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tbaseMinusT = base - t;\n\t\t\t\tif (w > floor(maxInt / baseMinusT)) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\tw *= baseMinusT;\n\n\t\t\t}\n\n\t\t\tout = output.length + 1;\n\t\t\tbias = adapt(i - oldi, out, oldi == 0);\n\n\t\t\t// `i` was supposed to wrap around from `out` to `0`,\n\t\t\t// incrementing `n` each time, so we'll fix that now:\n\t\t\tif (floor(i / out) > maxInt - n) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\tn += floor(i / out);\n\t\t\ti %= out;\n\n\t\t\t// Insert `n` at position `i` of the output\n\t\t\toutput.splice(i++, 0, n);\n\n\t\t}\n\n\t\treturn ucs2encode(output);\n\t}\n\n\t/**\n\t * Converts a string of Unicode symbols (e.g. a domain name label) to a\n\t * Punycode string of ASCII-only symbols.\n\t * @memberOf punycode\n\t * @param {String} input The string of Unicode symbols.\n\t * @returns {String} The resulting Punycode string of ASCII-only symbols.\n\t */\n\tfunction encode(input) {\n\t\tvar n,\n\t\t    delta,\n\t\t    handledCPCount,\n\t\t    basicLength,\n\t\t    bias,\n\t\t    j,\n\t\t    m,\n\t\t    q,\n\t\t    k,\n\t\t    t,\n\t\t    currentValue,\n\t\t    output = [],\n\t\t    /** `inputLength` will hold the number of code points in `input`. */\n\t\t    inputLength,\n\t\t    /** Cached calculation results */\n\t\t    handledCPCountPlusOne,\n\t\t    baseMinusT,\n\t\t    qMinusT;\n\n\t\t// Convert the input in UCS-2 to Unicode\n\t\tinput = ucs2decode(input);\n\n\t\t// Cache the length\n\t\tinputLength = input.length;\n\n\t\t// Initialize the state\n\t\tn = initialN;\n\t\tdelta = 0;\n\t\tbias = initialBias;\n\n\t\t// Handle the basic code points\n\t\tfor (j = 0; j < inputLength; ++j) {\n\t\t\tcurrentValue = input[j];\n\t\t\tif (currentValue < 0x80) {\n\t\t\t\toutput.push(stringFromCharCode(currentValue));\n\t\t\t}\n\t\t}\n\n\t\thandledCPCount = basicLength = output.length;\n\n\t\t// `handledCPCount` is the number of code points that have been handled;\n\t\t// `basicLength` is the number of basic code points.\n\n\t\t// Finish the basic string - if it is not empty - with a delimiter\n\t\tif (basicLength) {\n\t\t\toutput.push(delimiter);\n\t\t}\n\n\t\t// Main encoding loop:\n\t\twhile (handledCPCount < inputLength) {\n\n\t\t\t// All non-basic code points < n have been handled already. Find the next\n\t\t\t// larger one:\n\t\t\tfor (m = maxInt, j = 0; j < inputLength; ++j) {\n\t\t\t\tcurrentValue = input[j];\n\t\t\t\tif (currentValue >= n && currentValue < m) {\n\t\t\t\t\tm = currentValue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Increase `delta` enough to advance the decoder's <n,i> state to <m,0>,\n\t\t\t// but guard against overflow\n\t\t\thandledCPCountPlusOne = handledCPCount + 1;\n\t\t\tif (m - n > floor((maxInt - delta) / handledCPCountPlusOne)) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\tdelta += (m - n) * handledCPCountPlusOne;\n\t\t\tn = m;\n\n\t\t\tfor (j = 0; j < inputLength; ++j) {\n\t\t\t\tcurrentValue = input[j];\n\n\t\t\t\tif (currentValue < n && ++delta > maxInt) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\tif (currentValue == n) {\n\t\t\t\t\t// Represent delta as a generalized variable-length integer\n\t\t\t\t\tfor (q = delta, k = base; /* no condition */; k += base) {\n\t\t\t\t\t\tt = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\t\t\t\t\t\tif (q < t) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tqMinusT = q - t;\n\t\t\t\t\t\tbaseMinusT = base - t;\n\t\t\t\t\t\toutput.push(\n\t\t\t\t\t\t\tstringFromCharCode(digitToBasic(t + qMinusT % baseMinusT, 0))\n\t\t\t\t\t\t);\n\t\t\t\t\t\tq = floor(qMinusT / baseMinusT);\n\t\t\t\t\t}\n\n\t\t\t\t\toutput.push(stringFromCharCode(digitToBasic(q, 0)));\n\t\t\t\t\tbias = adapt(delta, handledCPCountPlusOne, handledCPCount == basicLength);\n\t\t\t\t\tdelta = 0;\n\t\t\t\t\t++handledCPCount;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t++delta;\n\t\t\t++n;\n\n\t\t}\n\t\treturn output.join('');\n\t}\n\n\t/**\n\t * Converts a Punycode string representing a domain name or an email address\n\t * to Unicode. Only the Punycoded parts of the input will be converted, i.e.\n\t * it doesn't matter if you call it on a string that has already been\n\t * converted to Unicode.\n\t * @memberOf punycode\n\t * @param {String} input The Punycoded domain name or email address to\n\t * convert to Unicode.\n\t * @returns {String} The Unicode representation of the given Punycode\n\t * string.\n\t */\n\tfunction toUnicode(input) {\n\t\treturn mapDomain(input, function(string) {\n\t\t\treturn regexPunycode.test(string)\n\t\t\t\t? decode(string.slice(4).toLowerCase())\n\t\t\t\t: string;\n\t\t});\n\t}\n\n\t/**\n\t * Converts a Unicode string representing a domain name or an email address to\n\t * Punycode. Only the non-ASCII parts of the domain name will be converted,\n\t * i.e. it doesn't matter if you call it with a domain that's already in\n\t * ASCII.\n\t * @memberOf punycode\n\t * @param {String} input The domain name or email address to convert, as a\n\t * Unicode string.\n\t * @returns {String} The Punycode representation of the given domain name or\n\t * email address.\n\t */\n\tfunction toASCII(input) {\n\t\treturn mapDomain(input, function(string) {\n\t\t\treturn regexNonASCII.test(string)\n\t\t\t\t? 'xn--' + encode(string)\n\t\t\t\t: string;\n\t\t});\n\t}\n\n\t/*--------------------------------------------------------------------------*/\n\n\t/** Define the public API */\n\tpunycode = {\n\t\t/**\n\t\t * A string representing the current Punycode.js version number.\n\t\t * @memberOf punycode\n\t\t * @type String\n\t\t */\n\t\t'version': '1.3.2',\n\t\t/**\n\t\t * An object of methods to convert from JavaScript's internal character\n\t\t * representation (UCS-2) to Unicode code points, and back.\n\t\t * @see <https://mathiasbynens.be/notes/javascript-encoding>\n\t\t * @memberOf punycode\n\t\t * @type Object\n\t\t */\n\t\t'ucs2': {\n\t\t\t'decode': ucs2decode,\n\t\t\t'encode': ucs2encode\n\t\t},\n\t\t'decode': decode,\n\t\t'encode': encode,\n\t\t'toASCII': toASCII,\n\t\t'toUnicode': toUnicode\n\t};\n\n\t/** Expose `punycode` */\n\t// Some AMD build optimizers, like r.js, check for specific condition patterns\n\t// like the following:\n\tif (\n\t\ttypeof define == 'function' &&\n\t\ttypeof define.amd == 'object' &&\n\t\tdefine.amd\n\t) {\n\t\tdefine('punycode', function() {\n\t\t\treturn punycode;\n\t\t});\n\t} else if (freeExports && freeModule) {\n\t\tif (module.exports == freeExports) { // in Node.js or RingoJS v0.8.0+\n\t\t\tfreeModule.exports = punycode;\n\t\t} else { // in Narwhal or RingoJS v0.7.0-\n\t\t\tfor (key in punycode) {\n\t\t\t\tpunycode.hasOwnProperty(key) && (freeExports[key] = punycode[key]);\n\t\t\t}\n\t\t}\n\t} else { // in Rhino or a web browser\n\t\troot.punycode = punycode;\n\t}\n\n}(this));\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{}],36:[function(require,module,exports){\n// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\n// If obj.hasOwnProperty has been overridden, then calling\n// obj.hasOwnProperty(prop) will break.\n// See: https://github.com/joyent/node/issues/1707\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n\nmodule.exports = function(qs, sep, eq, options) {\n  sep = sep || '&';\n  eq = eq || '=';\n  var obj = {};\n\n  if (typeof qs !== 'string' || qs.length === 0) {\n    return obj;\n  }\n\n  var regexp = /\\+/g;\n  qs = qs.split(sep);\n\n  var maxKeys = 1000;\n  if (options && typeof options.maxKeys === 'number') {\n    maxKeys = options.maxKeys;\n  }\n\n  var len = qs.length;\n  // maxKeys <= 0 means that we should not limit keys count\n  if (maxKeys > 0 && len > maxKeys) {\n    len = maxKeys;\n  }\n\n  for (var i = 0; i < len; ++i) {\n    var x = qs[i].replace(regexp, '%20'),\n        idx = x.indexOf(eq),\n        kstr, vstr, k, v;\n\n    if (idx >= 0) {\n      kstr = x.substr(0, idx);\n      vstr = x.substr(idx + 1);\n    } else {\n      kstr = x;\n      vstr = '';\n    }\n\n    k = decodeURIComponent(kstr);\n    v = decodeURIComponent(vstr);\n\n    if (!hasOwnProperty(obj, k)) {\n      obj[k] = v;\n    } else if (isArray(obj[k])) {\n      obj[k].push(v);\n    } else {\n      obj[k] = [obj[k], v];\n    }\n  }\n\n  return obj;\n};\n\nvar isArray = Array.isArray || function (xs) {\n  return Object.prototype.toString.call(xs) === '[object Array]';\n};\n\n},{}],37:[function(require,module,exports){\n// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar stringifyPrimitive = function(v) {\n  switch (typeof v) {\n    case 'string':\n      return v;\n\n    case 'boolean':\n      return v ? 'true' : 'false';\n\n    case 'number':\n      return isFinite(v) ? v : '';\n\n    default:\n      return '';\n  }\n};\n\nmodule.exports = function(obj, sep, eq, name) {\n  sep = sep || '&';\n  eq = eq || '=';\n  if (obj === null) {\n    obj = undefined;\n  }\n\n  if (typeof obj === 'object') {\n    return map(objectKeys(obj), function(k) {\n      var ks = encodeURIComponent(stringifyPrimitive(k)) + eq;\n      if (isArray(obj[k])) {\n        return map(obj[k], function(v) {\n          return ks + encodeURIComponent(stringifyPrimitive(v));\n        }).join(sep);\n      } else {\n        return ks + encodeURIComponent(stringifyPrimitive(obj[k]));\n      }\n    }).join(sep);\n\n  }\n\n  if (!name) return '';\n  return encodeURIComponent(stringifyPrimitive(name)) + eq +\n         encodeURIComponent(stringifyPrimitive(obj));\n};\n\nvar isArray = Array.isArray || function (xs) {\n  return Object.prototype.toString.call(xs) === '[object Array]';\n};\n\nfunction map (xs, f) {\n  if (xs.map) return xs.map(f);\n  var res = [];\n  for (var i = 0; i < xs.length; i++) {\n    res.push(f(xs[i], i));\n  }\n  return res;\n}\n\nvar objectKeys = Object.keys || function (obj) {\n  var res = [];\n  for (var key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) res.push(key);\n  }\n  return res;\n};\n\n},{}],38:[function(require,module,exports){\n'use strict';\n\nexports.decode = exports.parse = require('./decode');\nexports.encode = exports.stringify = require('./encode');\n\n},{\"./decode\":36,\"./encode\":37}],39:[function(require,module,exports){\n/*! rasterizeHTML.js - v1.2.4 - 2016-10-30\n* http://www.github.com/cburgmer/rasterizeHTML.js\n* Copyright (c) 2016 Christoph Burgmer; Licensed MIT */\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module unless amdModuleId is set\n    define([\"url\",\"css-mediaquery\",\"xmlserializer\",\"sane-domparser-error\",\"ayepromise\",\"inlineresources\"], function (a0,b1,c2,d3,e4,f5) {\n      return (root['rasterizeHTML'] = factory(a0,b1,c2,d3,e4,f5));\n    });\n  } else if (typeof exports === 'object') {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like environments that support module.exports,\n    // like Node.\n    module.exports = factory(require(\"url\"),require(\"css-mediaquery\"),require(\"xmlserializer\"),require(\"sane-domparser-error\"),require(\"ayepromise\"),require(\"inlineresources\"));\n  } else {\n    root['rasterizeHTML'] = factory(root[\"url\"],root[\"cssMediaQuery\"],root[\"xmlserializer\"],root[\"sanedomparsererror\"],root[\"ayepromise\"],root[\"inlineresources\"]);\n  }\n}(this, function (url, cssMediaQuery, xmlserializer, sanedomparsererror, ayepromise, inlineresources) {\n\nvar util = (function (url) {\n    \"use strict\";\n\n    var module = {};\n\n    var uniqueIdList = [];\n\n    module.joinUrl = function (baseUrl, relUrl) {\n        if (!baseUrl) {\n            return relUrl;\n        }\n        return url.resolve(baseUrl, relUrl);\n    };\n\n    module.getConstantUniqueIdFor = function (element) {\n        // HACK, using a list results in O(n), but how do we hash e.g. a DOM node?\n        if (uniqueIdList.indexOf(element) < 0) {\n            uniqueIdList.push(element);\n        }\n        return uniqueIdList.indexOf(element);\n    };\n\n    module.clone = function (object) {\n        var theClone = {},\n            i;\n        for (i in object) {\n            if (object.hasOwnProperty(i)) {\n                theClone[i] = object[i];\n            }\n        }\n        return theClone;\n    };\n\n    var isObject = function (obj) {\n        return typeof obj === \"object\" && obj !== null;\n    };\n\n    var isCanvas = function (obj) {\n        return isObject(obj) &&\n            Object.prototype.toString.apply(obj).match(/\\[object (Canvas|HTMLCanvasElement)\\]/i);\n    };\n\n    // args: canvas, options\n    module.parseOptionalParameters = function (args) {\n        var parameters = {\n            canvas: null,\n            options: {}\n        };\n\n        if (args[0] == null || isCanvas(args[0])) {\n            parameters.canvas = args[0] || null;\n\n            parameters.options = module.clone(args[1]);\n        } else {\n            parameters.options = module.clone(args[0]);\n        }\n\n        return parameters;\n    };\n\n    return module;\n}(url));\n\n// Proxy objects by monkey patching\nvar proxies = (function (util, ayepromise) {\n    \"use strict\";\n\n    var module = {};\n\n    var monkeyPatchInstanceMethod = function (object, methodName, proxyFunc) {\n        var originalFunc = object[methodName];\n\n        object[methodName] = function () {\n            var args = Array.prototype.slice.call(arguments);\n\n            return proxyFunc.apply(this, [args, originalFunc]);\n        };\n\n        return originalFunc;\n    };\n\n    // Bases all XHR calls on the given base URL\n    module.baseUrlRespectingXhr = function (XHRObject, baseUrl) {\n        var xhrConstructor = function () {\n            var xhr = new XHRObject();\n\n            monkeyPatchInstanceMethod(xhr, 'open', function (args, originalOpen) {\n                var method = args.shift(),\n                    url = args.shift(),\n                    joinedUrl = util.joinUrl(baseUrl, url);\n\n                return originalOpen.apply(this, [method, joinedUrl].concat(args));\n            });\n\n            return xhr;\n        };\n\n        return xhrConstructor;\n    };\n\n    // Provides a convenient way of being notified when all pending XHR calls are finished\n    module.finishNotifyingXhr = function (XHRObject) {\n        var totalXhrCount = 0,\n            doneXhrCount = 0,\n            waitingForPendingToClose = false,\n            defer = ayepromise.defer();\n\n        var checkAllRequestsFinished = function () {\n            var pendingXhrCount = totalXhrCount - doneXhrCount;\n\n            if (pendingXhrCount <= 0 && waitingForPendingToClose) {\n                defer.resolve({totalCount: totalXhrCount});\n            }\n        };\n\n        var xhrConstructor = function () {\n            var xhr = new XHRObject();\n\n            monkeyPatchInstanceMethod(xhr, 'send', function (_, originalSend) {\n                totalXhrCount += 1;\n                return originalSend.apply(this, arguments);\n            });\n\n            xhr.addEventListener('load', function () {\n                doneXhrCount += 1;\n\n                checkAllRequestsFinished();\n            });\n\n            return xhr;\n        };\n\n        xhrConstructor.waitForRequestsToFinish = function () {\n            waitingForPendingToClose = true;\n            checkAllRequestsFinished();\n            return defer.promise;\n        };\n\n        return xhrConstructor;\n    };\n\n    return module;\n}(util, ayepromise));\n\nvar documentUtil = (function () {\n    \"use strict\";\n\n    var module = {};\n\n    var asArray = function (arrayLike) {\n        return Array.prototype.slice.call(arrayLike);\n    };\n\n    module.addClassName = function (element, className) {\n        element.className += ' ' + className;\n    };\n\n    module.addClassNameRecursively = function (element, className) {\n        module.addClassName(element, className);\n\n        if (element.parentNode !== element.ownerDocument) {\n            module.addClassNameRecursively(element.parentNode, className);\n        }\n    };\n\n    var changeCssRule = function (rule, newRuleText) {\n        var styleSheet = rule.parentStyleSheet,\n            ruleIdx = asArray(styleSheet.cssRules).indexOf(rule);\n\n        // Exchange rule with the new text\n        styleSheet.insertRule(newRuleText, ruleIdx+1);\n        styleSheet.deleteRule(ruleIdx);\n    };\n\n    var updateRuleSelector = function (rule, updatedSelector) {\n        var styleDefinitions = rule.cssText.replace(/^[^\\{]+/, ''),\n            newRule = updatedSelector + ' ' + styleDefinitions;\n\n        changeCssRule(rule, newRule);\n    };\n\n    var cssRulesToText = function (cssRules) {\n        return asArray(cssRules).reduce(function (cssText, rule) {\n            return cssText + rule.cssText;\n        }, '');\n    };\n\n    var rewriteStyleContent = function (styleElement) {\n        styleElement.textContent = cssRulesToText(styleElement.sheet.cssRules);\n    };\n\n    var addSheetPropertyToSvgStyleElement = function (svgStyleElement) {\n        var doc = document.implementation.createHTMLDocument(''),\n            cssStyleElement = document.createElement('style');\n\n        cssStyleElement.textContent = svgStyleElement.textContent;\n        // the style will only be parsed once it is added to a document\n        doc.body.appendChild(cssStyleElement);\n\n        svgStyleElement.sheet = cssStyleElement.sheet;\n    };\n\n    var matchingSimpleSelectorsRegex = function (simpleSelectorList) {\n        return '(' +\n            '(?:^|[^.#:\\\\w])' +            // start of string or not a simple selector character,\n            '|' +                          // ... or ...\n            '(?=\\\\W)' +                    // the next character parsed is not an alphabetic character (and thus a natural boundary)\n            ')' +\n            '(' +\n            simpleSelectorList.join('|') + // one out of the given simple selectors\n            ')' +\n            '(?=\\\\W|$)';                   // followed either by a non-alphabetic character or the end of the string\n    };\n\n    var replaceSimpleSelectorsBy = function (element, simpleSelectorList, caseInsensitiveReplaceFunc) {\n        var selectorRegex = matchingSimpleSelectorsRegex(simpleSelectorList);\n\n        asArray(element.querySelectorAll('style')).forEach(function (styleElement) {\n            // SVGStyleElement doesn't have a property sheet in Safari, we need some workaround here\n            // more details can be found here: https://github.com/cburgmer/rasterizeHTML.js/issues/158\n            if (typeof styleElement.sheet === 'undefined') {\n                addSheetPropertyToSvgStyleElement(styleElement);\n            }\n\n            var matchingRules = asArray(styleElement.sheet.cssRules).filter(function (rule) {\n                return rule.selectorText && new RegExp(selectorRegex, 'i').test(rule.selectorText);\n            });\n\n            if (matchingRules.length) {\n                matchingRules.forEach(function (rule) {\n                    var newSelector = rule.selectorText.replace(new RegExp(selectorRegex, 'gi'),\n                                                             function (_, prefixMatch, selectorMatch) {\n                        return prefixMatch + caseInsensitiveReplaceFunc(selectorMatch);\n                    });\n\n                    if (newSelector !== rule.selectorText) {\n                        updateRuleSelector(rule, newSelector);\n                    }\n                });\n\n                rewriteStyleContent(styleElement);\n            }\n        });\n    };\n\n    module.rewriteCssSelectorWith = function (element, oldSelector, newSelector) {\n        replaceSimpleSelectorsBy(element, [oldSelector], function () {\n            return newSelector;\n        });\n    };\n\n    module.lowercaseCssTypeSelectors = function (element, matchingTagNames) {\n        replaceSimpleSelectorsBy(element, matchingTagNames, function (match) {\n            return match.toLowerCase();\n        });\n    };\n\n    module.findHtmlOnlyNodeNames = function (element) {\n        var treeWalker = element.ownerDocument.createTreeWalker(element, NodeFilter.SHOW_ELEMENT),\n            htmlNodeNames = {},\n            nonHtmlNodeNames = {},\n            currentTagName;\n\n        do {\n            currentTagName = treeWalker.currentNode.tagName.toLowerCase();\n            if (treeWalker.currentNode.namespaceURI === 'http://www.w3.org/1999/xhtml') {\n                htmlNodeNames[currentTagName] = true;\n            } else {\n                nonHtmlNodeNames[currentTagName] = true;\n            }\n        } while(treeWalker.nextNode());\n\n        return Object.keys(htmlNodeNames).filter(function (tagName) {\n            return !nonHtmlNodeNames[tagName];\n        });\n    };\n\n    return module;\n}());\n\nvar documentHelper = (function (documentUtil) {\n    \"use strict\";\n\n    var module = {};\n\n    var asArray = function (arrayLike) {\n        return Array.prototype.slice.call(arrayLike);\n    };\n\n    var cascadingAction = {\n        active: true,\n        hover: true,\n        focus: false,\n        target: false\n    };\n\n    module.fakeUserAction = function (element, selector, action) {\n        var elem = element.querySelector(selector),\n            pseudoClass = ':' + action,\n            fakeActionClass = 'rasterizehtml' + action;\n        if (! elem) {\n            return;\n        }\n\n        if (cascadingAction[action]) {\n            documentUtil.addClassNameRecursively(elem, fakeActionClass);\n        } else {\n            documentUtil.addClassName(elem, fakeActionClass);\n        }\n        documentUtil.rewriteCssSelectorWith(element, pseudoClass, '.' + fakeActionClass);\n    };\n\n    module.persistInputValues = function (doc) {\n        var inputs = doc.querySelectorAll('input'),\n            textareas = doc.querySelectorAll('textarea'),\n            isCheckable = function (input) {\n                return input.type === 'checkbox' || input.type === 'radio';\n            };\n\n        asArray(inputs).filter(isCheckable)\n            .forEach(function (input) {\n                if (input.checked) {\n                    input.setAttribute('checked', '');\n                } else {\n                    input.removeAttribute('checked');\n                }\n            });\n\n        asArray(inputs).filter(function (input) { return !isCheckable(input); })\n            .forEach(function (input) {\n                input.setAttribute('value', input.value);\n            });\n\n        asArray(textareas)\n            .forEach(function (textarea) {\n                textarea.textContent = textarea.value;\n            });\n    };\n\n    module.rewriteTagNameSelectorsToLowerCase = function (element) {\n        documentUtil.lowercaseCssTypeSelectors(element, documentUtil.findHtmlOnlyNodeNames(element));\n    };\n\n    return module;\n}(documentUtil));\n\nvar mediaQueryHelper = (function (cssMediaQuery) {\n    \"use strict\";\n\n    var module = {};\n\n    var svgImgBlueByEmMediaQuery = function () {\n        var svg = '<svg id=\"svg\" xmlns=\"http://www.w3.org/2000/svg\" width=\"10\" height=\"10\">' +\n                '<style>@media (max-width: 1em) { svg { background: #00f; } }</style>' +\n                '</svg>';\n\n        var url = \"data:image/svg+xml;charset=utf-8,\" + encodeURIComponent(svg),\n            img = document.createElement('img');\n\n        img.src = url;\n\n        return img;\n    };\n\n    var firstPixelHasColor = function (img, r, g, b) {\n        var canvas = document.createElement(\"canvas\");\n        canvas.width = img.width;\n        canvas.height = img.height;\n\n        var context = canvas.getContext(\"2d\"),\n            data;\n\n        context.drawImage(img, 0, 0);\n        data = context.getImageData(0, 0, 1, 1).data;\n        return data[0] === r && data[1] === g && data[2] === b;\n    };\n\n    var hasEmMediaQueryIssue = function () {\n        var img = svgImgBlueByEmMediaQuery(),\n            defer = ayepromise.defer();\n\n        document.querySelector('body').appendChild(img);\n\n        img.onload = function () {\n            document.querySelector('body').removeChild(img);\n            try {\n                defer.resolve(!firstPixelHasColor(img, 0, 0, 255));\n            } catch (e) {\n                // Fails in PhantomJS, let's assume the issue exists\n                defer.resolve(true);\n            }\n        };\n        img.onerror = function () {\n            defer.reject();\n        };\n\n        return defer.promise;\n    };\n\n    var hasEmIssue;\n\n    module.needsEmWorkaround = function () {\n        if (hasEmIssue === undefined) {\n            hasEmIssue = hasEmMediaQueryIssue();\n        }\n        return hasEmIssue;\n    };\n\n    var asArray = function (arrayLike) {\n        return Array.prototype.slice.call(arrayLike);\n    };\n\n    var cssRulesToText = function (cssRules) {\n        return asArray(cssRules).map(function (rule) {\n            return rule.cssText;\n        }).join('\\n');\n    };\n\n    var mediaQueryRule = function (mediaQuery, cssRules) {\n        return '@media ' + mediaQuery + '{' +\n            cssRulesToText(cssRules) +\n            '}';\n    };\n\n    var exchangeRuleWithNewContent = function (styleSheet, ruleIdx, newRuleText) {\n        try {\n            styleSheet.insertRule(newRuleText, ruleIdx+1);\n        } catch (e) {\n            // In case the browser does not like our new rule we just keep the existing one and quietly leave\n            return;\n        }\n        styleSheet.deleteRule(ruleIdx);\n    };\n\n    var changeCssRule = function (rule, newRuleText) {\n        var styleSheet = rule.parentStyleSheet,\n            ruleIdx = asArray(styleSheet.cssRules).indexOf(rule);\n\n        exchangeRuleWithNewContent(styleSheet, ruleIdx, newRuleText);\n    };\n\n    var rewriteStyleContent = function (styleElement) {\n        styleElement.textContent = cssRulesToText(styleElement.sheet.cssRules);\n    };\n\n    var serializeExpression = function (exp) {\n        var feature = exp.modifier ? exp.modifier + '-' + exp.feature : exp.feature;\n        if (exp.value) {\n            return '(' + feature + ': ' + exp.value + ')';\n        } else {\n            return '(' + feature + ')';\n        }\n    };\n\n    var serializeQueryPart = function (q) {\n        var segments = [];\n\n        if (q.inverse) {\n            segments.push(\"not\");\n        }\n\n        segments.push(q.type);\n\n        if (q.expressions.length > 0) {\n            segments.push('and ' + q.expressions.map(serializeExpression).join(' and '));\n        }\n\n        return segments.join(' ');\n    };\n\n    // poor man's testability\n    module.serializeQuery = function (q) {\n        var queryParts = q.map(serializeQueryPart);\n        return queryParts.join(', ');\n    };\n\n    var transformEmIntoPx = function (em) {\n        return em * 16;\n    };\n\n    var replaceEmValueWithPx = function (value) {\n        // Match a number with em unit. Doesn't match all, but should be enough for now\n        var match = /^((?:\\d+\\.)?\\d+)em/.exec(value);\n        if (match) {\n            return transformEmIntoPx(parseFloat(match[1])) + 'px';\n        }\n        return value;\n    };\n\n    var substituteEmWithPx = function (mediaQuery) {\n        var parsedQuery = cssMediaQuery.parse(mediaQuery),\n            hasChanges = false;\n\n        parsedQuery.forEach(function (q) {\n            q.expressions.forEach(function (exp) {\n                var rewrittenValue = replaceEmValueWithPx(exp.value);\n\n                hasChanges |= rewrittenValue !== exp.value;\n                exp.value = rewrittenValue;\n            });\n        });\n\n        if (hasChanges) {\n            return module.serializeQuery(parsedQuery);\n        }\n    };\n\n    var replaceEmsWithPx = function (mediaQueryRules) {\n        var anyRuleHasChanges = false;\n\n        mediaQueryRules.forEach(function (rule) {\n            var rewrittenMediaQuery = substituteEmWithPx(rule.media.mediaText);\n\n            if (rewrittenMediaQuery) {\n                changeCssRule(rule, mediaQueryRule(rewrittenMediaQuery, rule.cssRules));\n            }\n\n            anyRuleHasChanges |= !!rewrittenMediaQuery;\n        });\n\n        return anyRuleHasChanges;\n    };\n\n    module.workAroundWebKitEmSizeIssue = function (element) {\n        var styles = element.querySelectorAll('style');\n\n        asArray(styles).forEach(function (style) {\n            var mediaQueryRules = asArray(style.sheet.cssRules).filter(function (rule) {\n                return rule.type === window.CSSRule.MEDIA_RULE;\n            });\n\n            var hasChanges = replaceEmsWithPx(mediaQueryRules);\n            if (hasChanges) {\n                rewriteStyleContent(style);\n            }\n        });\n    };\n\n    return module;\n}(cssMediaQuery));\n\nvar browser = (function (util, proxies, ayepromise, sanedomparsererror, theWindow) {\n    \"use strict\";\n\n    var module = {};\n\n    var createHiddenElement = function (doc, tagName, width, height) {\n        var element = doc.createElement(tagName);\n        // 'display: none' doesn't cut it, as browsers seem to be lazy loading CSS\n        element.style.visibility = \"hidden\";\n        element.style.width = width + \"px\";\n        element.style.height = height + \"px\";\n        element.style.position = \"absolute\";\n        element.style.top = (-10000 - height) + \"px\";\n        element.style.left = (-10000 - width) + \"px\";\n        // We need to add the element to the document so that its content gets loaded\n        doc.getElementsByTagName(\"body\")[0].appendChild(element);\n        return element;\n    };\n\n    module.executeJavascript = function (element, options) {\n        var iframe = createHiddenElement(theWindow.document, \"iframe\", options.width, options.height),\n            html = element.outerHTML,\n            iframeErrorsMessages = [],\n            defer = ayepromise.defer(),\n            timeout = options.executeJsTimeout || 0;\n\n        var doResolve = function () {\n            var doc = iframe.contentDocument;\n            theWindow.document.getElementsByTagName(\"body\")[0].removeChild(iframe);\n            defer.resolve({\n                document: doc,\n                errors: iframeErrorsMessages\n            });\n        };\n\n        var waitForJavaScriptToRun = function () {\n            var d = ayepromise.defer();\n            if (timeout > 0) {\n                setTimeout(d.resolve, timeout);\n            } else {\n                d.resolve();\n            }\n            return d.promise;\n        };\n\n        var xhr = iframe.contentWindow.XMLHttpRequest,\n            finishNotifyXhrProxy = proxies.finishNotifyingXhr(xhr),\n            baseUrlXhrProxy = proxies.baseUrlRespectingXhr(finishNotifyXhrProxy, options.baseUrl);\n\n        iframe.onload = function () {\n            waitForJavaScriptToRun()\n                .then(finishNotifyXhrProxy.waitForRequestsToFinish)\n                .then(doResolve);\n        };\n\n        iframe.contentDocument.open();\n        iframe.contentWindow.XMLHttpRequest = baseUrlXhrProxy;\n        iframe.contentWindow.onerror = function (msg) {\n            iframeErrorsMessages.push({\n                resourceType: \"scriptExecution\",\n                msg: msg\n            });\n        };\n\n        iframe.contentDocument.write('<!DOCTYPE html>');\n        iframe.contentDocument.write(html);\n        iframe.contentDocument.close();\n\n        return defer.promise;\n    };\n\n    var createHiddenSandboxedIFrame = function (doc, width, height) {\n        var iframe = doc.createElement('iframe');\n        iframe.style.width = width + \"px\";\n        iframe.style.height = height + \"px\";\n        // 'display: none' doesn't cut it, as browsers seem to be lazy loading content\n        iframe.style.visibility = \"hidden\";\n        iframe.style.position = \"absolute\";\n        iframe.style.top = (-10000 - height) + \"px\";\n        iframe.style.left = (-10000 - width) + \"px\";\n        // Don't execute JS, all we need from sandboxing is access to the iframe's document\n        iframe.sandbox = 'allow-same-origin';\n        // Don't include a scrollbar on Linux\n        iframe.scrolling = 'no';\n        return iframe;\n    };\n\n    var createIframeWithSizeAtZoomLevel1 = function (width, height, zoom) {\n        var scaledViewportWidth = Math.floor(width / zoom),\n            scaledViewportHeight = Math.floor(height / zoom);\n\n        return createHiddenSandboxedIFrame(theWindow.document, scaledViewportWidth, scaledViewportHeight);\n    };\n\n    var calculateZoomedContentSizeAndRoundUp = function (actualViewport, requestedWidth, requestedHeight, zoom) {\n        return {\n            width: Math.max(actualViewport.width * zoom, requestedWidth),\n            height: Math.max(actualViewport.height * zoom, requestedHeight)\n        };\n    };\n\n    var selectElementOrDescendant = function (element, selector) {\n        var descendant = element.querySelector(selector);\n        if (descendant) {\n            return descendant;\n        } else if (element.ownerDocument.querySelector(selector) === element) {\n            return element;\n        }\n\n        throw {\n            message: \"Clipping selector not found\"\n        };\n    };\n\n    var calculateContentSize = function (rootElement, selector, requestedWidth, requestedHeight, zoom) {\n        // clientWidth/clientHeight needed for PhantomJS\n        var actualViewportWidth = Math.max(rootElement.scrollWidth, rootElement.clientWidth),\n            actualViewportHeight = Math.max(rootElement.scrollHeight, rootElement.clientHeight),\n            top, left, originalWidth, originalHeight, rootFontSize,\n            element, rect, contentSize;\n\n        if (selector) {\n            element = selectElementOrDescendant(rootElement, selector);\n\n            rect = element.getBoundingClientRect();\n\n            top = rect.top;\n            left = rect.left;\n            originalWidth = rect.width;\n            originalHeight = rect.height;\n        } else {\n            top = 0;\n            left = 0;\n            originalWidth = actualViewportWidth;\n            originalHeight = actualViewportHeight;\n        }\n\n        contentSize = calculateZoomedContentSizeAndRoundUp({\n                width: originalWidth,\n                height: originalHeight\n            },\n            requestedWidth,\n            requestedHeight,\n            zoom);\n\n        rootFontSize = theWindow.getComputedStyle(rootElement.ownerDocument.documentElement).fontSize;\n\n        return {\n            left: left,\n            top: top,\n            width: contentSize.width,\n            height: contentSize.height,\n            viewportWidth: actualViewportWidth,\n            viewportHeight: actualViewportHeight,\n\n            rootFontSize: rootFontSize\n        };\n    };\n\n    var findCorrelatingElement = function (element, documentClone) {\n        var tagName = element.tagName;\n        // Stupid but simple method: find first match. Should work for a single HTML element, and any other element given as root\n        return documentClone.querySelector(tagName);\n    };\n\n    var elementToFullHtmlDocument = function (element) {\n        var tagName = element.tagName.toLowerCase();\n        if (tagName === 'html' || tagName === 'body') {\n            return element.outerHTML;\n        }\n\n        // Simple hack: hide the body from sizing, otherwise browser would apply a 8px margin\n        return '<body style=\"margin: 0;\">' + element.outerHTML + '</body>';\n    };\n\n    module.calculateDocumentContentSize = function (element, options) {\n        var defer = ayepromise.defer(),\n            zoom = options.zoom || 1,\n            iframe;\n\n\n        iframe = createIframeWithSizeAtZoomLevel1(options.width, options.height, zoom);\n        // We need to add the element to the document so that its content gets loaded\n        theWindow.document.getElementsByTagName(\"body\")[0].appendChild(iframe);\n\n        iframe.onload = function () {\n            var doc = iframe.contentDocument,\n                size;\n\n            try {\n                size = calculateContentSize(findCorrelatingElement(element, doc), options.clip, options.width, options.height, zoom);\n\n                defer.resolve(size);\n            } catch (e) {\n                defer.reject(e);\n            } finally {\n                theWindow.document.getElementsByTagName(\"body\")[0].removeChild(iframe);\n            }\n        };\n\n        // srcdoc doesn't work in PhantomJS yet\n        iframe.contentDocument.open();\n        iframe.contentDocument.write('<!DOCTYPE html>');\n        iframe.contentDocument.write(elementToFullHtmlDocument(element));\n        iframe.contentDocument.close();\n\n        return defer.promise;\n    };\n\n    module.parseHtmlFragment = function (htmlFragment) {\n        var doc = theWindow.document.implementation.createHTMLDocument('');\n        doc.documentElement.innerHTML = htmlFragment;\n\n        var element = doc.querySelector('body').firstChild;\n\n        if (!element) {\n            throw \"Invalid source\";\n        }\n\n        return element;\n    };\n\n    var addHTMLTagAttributes = function (doc, html) {\n        var attributeMatch = /<html((?:\\s+[^>]*)?)>/im.exec(html),\n            helperDoc = theWindow.document.implementation.createHTMLDocument(''),\n            htmlTagSubstitute,\n            i, elementSubstitute, attribute;\n\n        if (!attributeMatch) {\n            return;\n        }\n\n        htmlTagSubstitute = '<div' + attributeMatch[1] + '></div>';\n        helperDoc.documentElement.innerHTML = htmlTagSubstitute;\n        elementSubstitute = helperDoc.querySelector('div');\n\n        for (i = 0; i < elementSubstitute.attributes.length; i++) {\n            attribute = elementSubstitute.attributes[i];\n            doc.documentElement.setAttribute(attribute.name, attribute.value);\n        }\n    };\n\n    module.parseHTML = function (html) {\n        // We should be using the DOMParser, but it is not supported in older browsers\n        var doc = theWindow.document.implementation.createHTMLDocument('');\n        doc.documentElement.innerHTML = html;\n\n        addHTMLTagAttributes(doc, html);\n        return doc;\n    };\n\n    var failOnInvalidSource = function (doc) {\n        try {\n            return sanedomparsererror.failOnParseError(doc);\n        } catch (e) {\n            throw {\n                message: \"Invalid source\",\n                originalError: e\n            };\n        }\n    };\n\n    module.validateXHTML = function (xhtml) {\n        var p = new DOMParser(),\n            doc = p.parseFromString(xhtml, \"application/xml\");\n\n        failOnInvalidSource(doc);\n    };\n\n    var lastCacheDate = null;\n\n    var getUncachableURL = function (url, cache) {\n        if (cache === 'none' || cache === 'repeated') {\n            if (lastCacheDate === null || cache !== 'repeated') {\n                lastCacheDate = Date.now();\n            }\n            return url + \"?_=\" + lastCacheDate;\n        } else {\n            return url;\n        }\n    };\n\n    var doDocumentLoad = function (url, options) {\n        var xhr = new window.XMLHttpRequest(),\n            joinedUrl = util.joinUrl(options.baseUrl, url),\n            augmentedUrl = getUncachableURL(joinedUrl, options.cache),\n            defer = ayepromise.defer(),\n            doReject = function (e) {\n                defer.reject({\n                    message: \"Unable to load page\",\n                    originalError: e\n                });\n            };\n\n        xhr.addEventListener(\"load\", function () {\n            if (xhr.status === 200 || xhr.status === 0) {\n                defer.resolve(xhr.responseXML);\n            } else {\n                doReject(xhr.statusText);\n            }\n        }, false);\n\n        xhr.addEventListener(\"error\", function (e) {\n            doReject(e);\n        }, false);\n\n        try {\n            xhr.open('GET', augmentedUrl, true);\n            xhr.responseType = \"document\";\n            xhr.send(null);\n        } catch (e) {\n            doReject(e);\n        }\n\n        return defer.promise;\n    };\n\n    module.loadDocument = function (url, options) {\n        return doDocumentLoad(url, options)\n            .then(function (doc) {\n                return failOnInvalidSource(doc);\n            });\n    };\n\n    return module;\n}(util, proxies, ayepromise, sanedomparsererror, window));\n\nvar svg2image = (function (ayepromise, window) {\n    \"use strict\";\n\n    var module = {};\n\n    var urlForSvg = function (svg, useBlobs) {\n        if (useBlobs) {\n            return URL.createObjectURL(new Blob([svg], {\"type\": \"image/svg+xml\"}));\n        } else {\n            return \"data:image/svg+xml;charset=utf-8,\" + encodeURIComponent(svg);\n        }\n    };\n\n    var cleanUpUrl = function (url) {\n        if (url instanceof Blob) {\n            URL.revokeObjectURL(url);\n        }\n    };\n\n    var simpleForeignObjectSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"1\" height=\"1\"><foreignObject></foreignObject></svg>';\n\n    var supportsReadingObjectFromCanvas = function (url) {\n        var canvas = document.createElement(\"canvas\"),\n            image = new Image(),\n            defer = ayepromise.defer();\n\n        image.onload = function () {\n            var context = canvas.getContext(\"2d\");\n            try {\n                context.drawImage(image, 0, 0);\n                // This will fail in Chrome & Safari\n                canvas.toDataURL(\"image/png\");\n                defer.resolve(true);\n            } catch (e) {\n                defer.resolve(false);\n            }\n        };\n        image.onerror = defer.reject;\n        image.src = url;\n\n        return defer.promise;\n    };\n\n    var readingBackFromCanvasBenefitsFromOldSchoolDataUris = function () {\n        // Check for work around for https://code.google.com/p/chromium/issues/detail?id=294129\n        var blobUrl = urlForSvg(simpleForeignObjectSvg, true);\n        return supportsReadingObjectFromCanvas(blobUrl)\n            .then(function (supportsReadingFromBlobs) {\n                cleanUpUrl(blobUrl);\n                if (supportsReadingFromBlobs) {\n                    return false;\n                }\n                return supportsReadingObjectFromCanvas(urlForSvg(simpleForeignObjectSvg, false))\n                    .then(function (s) {\n                        return s;\n                    });\n            }, function () {\n                return false;\n            });\n    };\n\n    var supportsBlobBuilding = function () {\n        if (window.Blob) {\n            // Available as constructor only in newer builds for all browsers\n            try {\n                new Blob(['<b></b>'], { \"type\" : \"text/xml\" });\n                return true;\n            } catch (err) {}\n        }\n        return false;\n    };\n\n    var checkBlobSupport = function () {\n        var defer = ayepromise.defer();\n\n        if (supportsBlobBuilding && window.URL) {\n            readingBackFromCanvasBenefitsFromOldSchoolDataUris()\n                .then(function (doesBenefit) {\n                    defer.resolve(! doesBenefit);\n                }, function () {\n                    defer.reject();\n                });\n        } else {\n            defer.resolve(false);\n        }\n\n        return defer.promise;\n    };\n\n    var checkForBlobsResult;\n\n    var checkForBlobs = function () {\n        if (checkForBlobsResult === undefined) {\n            checkForBlobsResult = checkBlobSupport();\n        }\n\n        return checkForBlobsResult;\n    };\n\n    var buildImageUrl = function (svg) {\n        return checkForBlobs().then(function (useBlobs) {\n            return urlForSvg(svg, useBlobs);\n        });\n    };\n\n    module.renderSvg = function (svg) {\n        var url, image,\n            defer = ayepromise.defer(),\n            resetEventHandlers = function () {\n                image.onload = null;\n                image.onerror = null;\n            },\n            cleanUp = function () {\n                if (url) {\n                    cleanUpUrl(url);\n                }\n            };\n\n        image = new Image();\n        image.onload = function() {\n            resetEventHandlers();\n            cleanUp();\n\n            defer.resolve(image);\n        };\n        image.onerror = function () {\n            cleanUp();\n\n            // Webkit calls the onerror handler if the SVG is faulty\n            defer.reject();\n        };\n\n        buildImageUrl(svg).then(function (imageUrl) {\n            url = imageUrl;\n            image.src = url;\n        }, defer.reject);\n\n        return defer.promise;\n    };\n\n    return module;\n}(ayepromise, window));\n\nvar document2svg = (function (util, browser, documentHelper, mediaQueryHelper, xmlserializer) {\n    \"use strict\";\n\n    var module = {};\n\n    var svgAttributes = function (size, zoom) {\n        var zoomFactor = zoom || 1;\n\n        var attributes = {\n            width: size.width,\n            height: size.height,\n            'font-size': size.rootFontSize\n        };\n\n        if (zoomFactor !== 1) {\n            attributes.style = 'transform:scale(' + zoomFactor + '); transform-origin: 0 0;';\n        }\n\n        return attributes;\n    };\n\n    var foreignObjectAttributes = function (size) {\n        var closestScaledWith, closestScaledHeight,\n            offsetX, offsetY;\n\n        closestScaledWith = Math.round(size.viewportWidth);\n        closestScaledHeight = Math.round(size.viewportHeight);\n\n        offsetX = -size.left;\n        offsetY = -size.top;\n\n        var attributes = {\n             'x': offsetX,\n             'y': offsetY,\n             'width': closestScaledWith,\n             'height': closestScaledHeight\n        };\n\n        return attributes;\n    };\n\n    var workAroundCollapsingMarginsAcrossSVGElementInWebKitLike = function (attributes) {\n        var style = attributes.style || '';\n        attributes.style = style + 'float: left;';\n    };\n\n    var workAroundSafariSometimesNotShowingExternalResources = function (attributes) {\n        /* Let's hope that works some magic. The spec says SVGLoad only fires\n         * now when all externals are available.\n         * http://www.w3.org/TR/SVG/struct.html#ExternalResourcesRequired */\n        attributes.externalResourcesRequired = true;\n    };\n\n    var workAroundChromeShowingScrollbarsUnderLinuxIfHtmlIsOverflowScroll = function () {\n        return '<style scoped=\"\">html::-webkit-scrollbar { display: none; }</style>';\n    };\n\n    var serializeAttributes = function (attributes) {\n        var keys = Object.keys(attributes);\n        if (!keys.length) {\n            return '';\n        }\n\n        return ' ' + keys.map(function (key) {\n            return key + '=\"' + attributes[key] + '\"';\n        }).join(' ');\n    };\n\n    var convertElementToSvg = function (element, size, zoomFactor) {\n        var xhtml = xmlserializer.serializeToString(element);\n\n        browser.validateXHTML(xhtml);\n\n        var foreignObjectAttrs = foreignObjectAttributes(size);\n        workAroundCollapsingMarginsAcrossSVGElementInWebKitLike(foreignObjectAttrs);\n        workAroundSafariSometimesNotShowingExternalResources(foreignObjectAttrs);\n\n        return (\n            '<svg xmlns=\"http://www.w3.org/2000/svg\"' +\n                serializeAttributes(svgAttributes(size, zoomFactor)) +\n                '>' +\n                workAroundChromeShowingScrollbarsUnderLinuxIfHtmlIsOverflowScroll() +\n                '<foreignObject' + serializeAttributes(foreignObjectAttrs) + '>' +\n                xhtml +\n                '</foreignObject>' +\n                '</svg>'\n        );\n    };\n\n    module.getSvgForDocument = function (element, size, zoomFactor) {\n        documentHelper.rewriteTagNameSelectorsToLowerCase(element);\n\n        return mediaQueryHelper.needsEmWorkaround().then(function (needsWorkaround) {\n            if (needsWorkaround) {\n                mediaQueryHelper.workAroundWebKitEmSizeIssue(element);\n            }\n\n            return convertElementToSvg(element, size, zoomFactor);\n        });\n    };\n\n    module.drawDocumentAsSvg = function (element, options) {\n        ['hover', 'active', 'focus', 'target'].forEach(function (action) {\n            if (options[action]) {\n                documentHelper.fakeUserAction(element, options[action], action);\n            }\n        });\n\n        return browser.calculateDocumentContentSize(element, options)\n            .then(function (size) {\n                return module.getSvgForDocument(element, size, options.zoom);\n            });\n    };\n\n    return module;\n}(util, browser, documentHelper, mediaQueryHelper, xmlserializer));\n\nvar rasterize = (function (util, browser, documentHelper, document2svg, svg2image, inlineresources) {\n    \"use strict\";\n\n    var module = {};\n\n    var generalDrawError = function (e) {\n        return {\n            message: \"Error rendering page\",\n            originalError: e\n        };\n    };\n\n    var drawSvgAsImg = function (svg) {\n        return svg2image.renderSvg(svg)\n            .then(function (image) {\n                return {\n                    image: image,\n                    svg: svg\n                };\n            }, function (e) {\n                throw generalDrawError(e);\n            });\n    };\n\n    var drawImageOnCanvas = function (image, canvas) {\n        try {\n            canvas.getContext(\"2d\").drawImage(image, 0, 0);\n        } catch (e) {\n            // Firefox throws a 'NS_ERROR_NOT_AVAILABLE' if the SVG is faulty\n            throw generalDrawError(e);\n        }\n    };\n\n    var doDraw = function (element, canvas, options) {\n        return document2svg.drawDocumentAsSvg(element, options)\n            .then(drawSvgAsImg)\n            .then(function (result) {\n                if (canvas) {\n                    drawImageOnCanvas(result.image, canvas);\n                }\n\n                return result;\n            });\n    };\n\n    var operateJavaScriptOnDocument = function (element, options) {\n        return browser.executeJavascript(element, options)\n            .then(function (result) {\n                var document = result.document;\n                documentHelper.persistInputValues(document);\n\n                return {\n                    document: document,\n                    errors: result.errors\n                };\n            });\n    };\n\n    module.rasterize = function (element, canvas, options) {\n        var inlineOptions;\n\n        inlineOptions = util.clone(options);\n        inlineOptions.inlineScripts = options.executeJs === true;\n\n        return inlineresources.inlineReferences(element, inlineOptions)\n            .then(function (errors) {\n                if (options.executeJs) {\n                    return operateJavaScriptOnDocument(element, options)\n                        .then(function (result) {\n                            return {\n                                element: result.document.documentElement,\n                                errors: errors.concat(result.errors)\n                            };\n                        });\n                } else {\n                    return {\n                        element: element,\n                        errors: errors\n                    };\n                }\n            }).then(function (result) {\n                return doDraw(result.element, canvas, options)\n                    .then(function (drawResult) {\n                        return {\n                            image: drawResult.image,\n                            svg: drawResult.svg,\n                            errors: result.errors\n                        };\n                    });\n            });\n    };\n\n    return module;\n}(util, browser, documentHelper, document2svg, svg2image, inlineresources));\n\nvar rasterizeHTML = (function (util, browser, rasterize) {\n    \"use strict\";\n\n    var module = {};\n\n    var getViewportSize = function (canvas, options) {\n        var defaultWidth = 300,\n            defaultHeight = 200,\n            fallbackWidth = canvas ? canvas.width : defaultWidth,\n            fallbackHeight = canvas ? canvas.height : defaultHeight,\n            width = options.width !== undefined ? options.width : fallbackWidth,\n            height = options.height !== undefined ? options.height : fallbackHeight;\n\n        return {\n            width: width,\n            height: height\n        };\n    };\n\n    var constructOptions = function (params) {\n        var viewport = getViewportSize(params.canvas, params.options),\n            options;\n\n        options = util.clone(params.options);\n        options.width = viewport.width;\n        options.height = viewport.height;\n\n        return options;\n    };\n\n    /**\n     * Draws a Document to the canvas.\n     * rasterizeHTML.drawDocument( document [, canvas] [, options] ).then(function (result) { ... });\n     */\n    module.drawDocument = function () {\n        var doc = arguments[0],\n            optionalArguments = Array.prototype.slice.call(arguments, 1),\n            params = util.parseOptionalParameters(optionalArguments);\n\n        var element = doc.documentElement ? doc.documentElement : doc;\n\n        return rasterize.rasterize(element, params.canvas, constructOptions(params));\n    };\n\n    var drawHTML = function (html, canvas, options) {\n        var doc = browser.parseHTML(html);\n\n        return module.drawDocument(doc, canvas, options);\n    };\n\n    /**\n     * Draws a HTML string to the canvas.\n     * rasterizeHTML.drawHTML( html [, canvas] [, options] ).then(function (result) { ... });\n     */\n    module.drawHTML = function () {\n        var html = arguments[0],\n            optionalArguments = Array.prototype.slice.call(arguments, 1),\n            params = util.parseOptionalParameters(optionalArguments);\n\n        return drawHTML(html, params.canvas, params.options);\n    };\n\n    // work around https://bugzilla.mozilla.org/show_bug.cgi?id=925493\n    var workAroundFirefoxNotLoadingStylesheetStyles = function (doc, url, options) {\n        var d = document.implementation.createHTMLDocument('');\n        d.replaceChild(doc.documentElement, d.documentElement);\n\n        var extendedOptions = options ? util.clone(options) : {};\n\n        if (!options.baseUrl) {\n            extendedOptions.baseUrl = url;\n        }\n\n        return {\n            document: d,\n            options: extendedOptions\n        };\n    };\n\n    var drawURL = function (url, canvas, options) {\n        return browser.loadDocument(url, options)\n            .then(function (doc) {\n                var workaround = workAroundFirefoxNotLoadingStylesheetStyles(doc, url, options);\n                return module.drawDocument(workaround.document, canvas, workaround.options);\n            });\n    };\n\n    /**\n     * Draws a page to the canvas.\n     * rasterizeHTML.drawURL( url [, canvas] [, options] ).then(function (result) { ... });\n     */\n    module.drawURL = function () {\n        var url = arguments[0],\n            optionalArguments = Array.prototype.slice.call(arguments, 1),\n            params = util.parseOptionalParameters(optionalArguments);\n\n        return drawURL(url, params.canvas, params.options);\n    };\n\n    return module;\n}(util, browser, rasterize));\n\nreturn rasterizeHTML;\n\n}));\n\n},{\"ayepromise\":2,\"css-mediaquery\":8,\"inlineresources\":30,\"sane-domparser-error\":40,\"url\":3,\"xmlserializer\":41}],40:[function(require,module,exports){\n'use strict';\n\nvar innerXML = function (node) {\n    var s = new XMLSerializer();\n    return Array.prototype.map.call(node.childNodes, function (node) {\n        return s.serializeToString(node);\n    }).join('');\n};\n\nvar getParseError = function (doc) {\n    // Firefox\n    if (doc.documentElement.tagName === 'parsererror' &&\n        doc.documentElement.namespaceURI === 'http://www.mozilla.org/newlayout/xml/parsererror.xml') {\n        return doc.documentElement;\n    }\n\n    // Chrome, Safari\n    if ((doc.documentElement.tagName === 'xml' || doc.documentElement.tagName === 'html') &&\n        doc.documentElement.childNodes &&\n        doc.documentElement.childNodes.length > 0 &&\n        doc.documentElement.childNodes[0].nodeName === 'parsererror') {\n        return doc.documentElement.childNodes[0];\n    }\n\n    // PhantomJS\n    if (doc.documentElement.tagName === 'html' &&\n        doc.documentElement.childNodes &&\n        doc.documentElement.childNodes.length > 0 &&\n        doc.documentElement.childNodes[0].nodeName === 'body' &&\n        doc.documentElement.childNodes[0].childNodes &&\n        doc.documentElement.childNodes[0].childNodes.length &&\n        doc.documentElement.childNodes[0].childNodes[0].nodeName === 'parsererror') {\n        return doc.documentElement.childNodes[0].childNodes[0];\n    }\n\n    return undefined;\n};\n\nvar errorMessagePatterns = [\n    // Chrome, Safari, PhantomJS\n    new RegExp('^<h3[^>]*>This page contains the following errors:<\\/h3><div[^>]*>(.+?)\\n?<\\/div>'),\n    // Firefox\n    new RegExp('^(.+)\\n')\n];\n\nvar extractParseError = function (errorNode) {\n    var content = innerXML(errorNode);\n    var i, match;\n\n    for(i = 0; i < errorMessagePatterns.length; i++) {\n        match = errorMessagePatterns[i].exec(content);\n\n        if (match) {\n            return match[1];\n        }\n    }\n    return undefined;\n};\n\nvar failOnParseError = function (doc) {\n    var errorMessage;\n\n    if (doc === null) {\n        throw new Error('Parse error');\n    }\n\n    var parseError = getParseError(doc);\n    if (parseError !== undefined) {\n        errorMessage = extractParseError(parseError) || 'Parse error';\n        throw new Error(errorMessage);\n    }\n};\n\nexports.failOnParseError = function (doc) {\n    failOnParseError(doc);\n\n    return doc;\n};\n\n},{}],41:[function(require,module,exports){\nvar removeInvalidCharacters = function (content) {\n    // See http://www.w3.org/TR/xml/#NT-Char for valid XML 1.0 characters\n    return content.replace(/[\\x00-\\x08\\x0B\\x0C\\x0E-\\x1F]/g, '');\n};\n\nvar serializeAttributeValue = function (value) {\n    return value\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;')\n        .replace(/\"/g, '&quot;')\n        .replace(/'/g, '&apos;');\n};\n\nvar serializeTextContent = function (content) {\n    return content\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;');\n};\n\nvar serializeAttribute = function (attr) {\n    var value = attr.value;\n\n    return ' ' + attr.name + '=\"' + serializeAttributeValue(value) + '\"';\n};\n\nvar getTagName = function (node) {\n    var tagName = node.tagName;\n\n    // Aid in serializing of original HTML documents\n    if (node.namespaceURI === 'http://www.w3.org/1999/xhtml') {\n        tagName = tagName.toLowerCase();\n    }\n    return tagName;\n};\n\nvar serializeNamespace = function (node, isRootNode) {\n    var nodeHasXmlnsAttr = Array.prototype.map.call(node.attributes || node.attrs, function (attr) {\n            return attr.name;\n        })\n        .indexOf('xmlns') >= 0;\n    // Serialize the namespace as an xmlns attribute whenever the element\n    // doesn't already have one and the inherited namespace does not match\n    // the element's namespace.\n    if (!nodeHasXmlnsAttr &&\n        (isRootNode ||\n         node.namespaceURI !== node.parentNode.namespaceURI)) {\n         return ' xmlns=\"' + node.namespaceURI + '\"';\n    } else {\n        return '';\n    }\n};\n\nvar serializeChildren = function (node) {\n    return Array.prototype.map.call(node.childNodes, function (childNode) {\n        return nodeTreeToXHTML(childNode);\n    }).join('');\n};\n\nvar serializeTag = function (node, isRootNode) {\n    var output = '<' + getTagName(node);\n    output += serializeNamespace(node, isRootNode);\n\n    Array.prototype.forEach.call(node.attributes || node.attrs, function (attr) {\n        output += serializeAttribute(attr);\n    });\n\n    if (node.childNodes.length > 0) {\n        output += '>';\n        output += serializeChildren(node);\n        output += '</' + getTagName(node) + '>';\n    } else {\n        output += '/>';\n    }\n    return output;\n};\n\nvar serializeText = function (node) {\n    var text = node.nodeValue || node.value || '';\n    return serializeTextContent(text);\n};\n\nvar serializeComment = function (node) {\n    return '<!--' +\n        node.data\n            .replace(/-/g, '&#45;') +\n        '-->';\n};\n\nvar serializeCDATA = function (node) {\n    return '<![CDATA[' + node.nodeValue + ']]>';\n};\n\nvar nodeTreeToXHTML = function (node, options) {\n    var isRootNode = options && options.rootNode;\n\n    if (node.nodeName === '#document' ||\n        node.nodeName === '#document-fragment') {\n        return serializeChildren(node);\n    } else {\n        if (node.tagName) {\n            return serializeTag(node, isRootNode);\n        } else if (node.nodeName === '#text') {\n            return serializeText(node);\n        } else if (node.nodeName === '#comment') {\n            return serializeComment(node);\n        } else if (node.nodeName === '#cdata-section') {\n            return serializeCDATA(node);\n        }\n    }\n};\n\nexports.serializeToString = function (node) {\n    return removeInvalidCharacters(nodeTreeToXHTML(node, {rootNode: true}));\n};\n\n},{}]},{},[1]);\n"]}